/*! BARNES-BUILDER 2024-02-21 */
BN.Modal=BN.Modal||{},BN.Modal.SingleInstance=function(a,b,c,d){this.data=b,this.events={},this.closeEvents={back:[],button:[],method:[],all:[]},Modal.call(this,a,b,c,d)},BN.Modal.SingleInstance.prototype=Modal.prototype,BN.Modal.SingleInstance.prototype.isModalAlreadyOpen=function(){var a,b,c;if(this.openModals)for(var d in this.openModals)if(a=this.openModals[d],a&&a.data&&(this.data&&(b=this.data.target),a.data&&(c=a.data.target),b&&c&&$(b).is(c)))return!0;return!1},$.extend(!0,BN.Modal.SingleInstance,Modal),BN.Modal.Base=BN.Modal.Base||Extend(function(){var a=function(){this.__originalArguments=Array.prototype.slice.call(arguments,0);var a=this;"ontouchstart"in document.documentElement&&$("input[type=hidden]").focus(),consoleLog("Instantiating BN.Modal.Base"),this.on("display",function(){$("body").children().each(function(){0==$(this).hasClass("modal")&&$(this).attr("aria-hidden","true")}),window.html5.shivDocument(document);for(var a=["login","register","reset-password-email","reset-password","change-password","conflictingaccount"],b=!1,c=this.tplName,d=this.productName||BN.Modal.Base.prototype.getProductNameByModal(),e=this.data?this.data["work-id"]:"work-id unavailable",f=0;f<a.length;f++)this.tplName===a[f]&&(b=!0);b||"undefined"!=typeof s_setP&&updateAnalyticsPageName(c,d,e)}),$(document.body).addClass("modal-open"),this.closeEvents.back=this.closeEvents.back||[],this.closeEvents.back.push(function(){for(var a in Modal.openModals)if(Modal.openModals.hasOwnProperty(a)){var b=null!==Modal.openModals[a].options.tplParams?Modal.openModals[a].options.tplParams.tplName:Modal.openModals[a].tplName,c=Modal.openModals[a].productName||BN.Modal.Base.prototype.getProductNameByModal(),d=Modal.openModals[a].data?Modal.openModals[a].data["work-id"]:"work-id unavailable";"undefined"!=typeof s_setP&&updateAnalyticsPageName(b,c,d)}}),this.closeEvents.method=this.closeEvents.method||[],this.closeEvents.method.push(function(){var a=this.data;if(a&&"undefined"!=typeof a.frameUrl&&this.parent){var b=this.parent,c=null!==b.options.tplParams?b.options.tplParams.tplName:b.tplName;"undefined"!=typeof s_setP&&updateAnalyticsPageName(c)}}),this.closeEvents.all=this.closeEvents.all||[],this.closeEvents.all.push(function(){var b=!1;for(var c in Modal.openModals)if(Modal.openModals.hasOwnProperty(c)){b=!0;break}if(!b){a.productName="";var d=$(document.body);d.removeClass("modal-open"),d.hasClass("modal-position")&&d.removeClass("modal-position"),d.css("top","0"),"undefined"!=typeof s_setP&&updateAnalyticsPageName()}$("body").children().each(function(){0==$(this).hasClass("modal")&&$(this).removeAttr("aria-hidden")})}),this.closeEvents.all.push(function(){var b;if(a.data&&a.data.target)if(b=$(a.data.target),consoleLog("returning focus to ",b),this.data.qas&&$("#addPaymentErr").is(":visible"))$("#addPaymentErr").focus();else if(-1!=$.inArray("sign-into-account",a.data.target.classList))$("body").css({top:0});else{if(b.hasClass("btn-quick-add")&&(b.closest(".quick-add").addClass("quick-add-hover"),$('.product-shelf-image-cont:not(".plp-qa-img-cont"), .pb-content:not(".prd-img-cont")').off("mouseenter"),$(".plp-quick-add-cont").off("mouseover"),b.hide(),setTimeout(function(){$('.product-shelf-image-cont:not(".plp-qa-img-cont"), .pb-content:not(".prd-img-cont")').on("mouseenter",function(){$(this).find(".quick-add").hasClass("quick-add-hover")||$(".quick-add-hover").removeClass("quick-add-hover"),$(this).find(".quick-add").addClass("quick-add-hover")}),$(".plp-quick-add-cont").on("mouseover",function(){$(this).find(".quick-add").hasClass("quick-add-hover")||$(".quick-add-hover").removeClass("quick-add-hover"),$(this).find(".quick-add").addClass("quick-add-hover")}),$(".prd-img-cont").on("mouseover",function(){$(this).find(".quick-add").hasClass("quick-add-hover")||$(".quick-add-hover").removeClass("quick-add-hover"),$(this).find(".quick-add").addClass("quick-add-hover")}),b.show()},500)),b.parents("form").length>0){var c=b.parents("form")[0].getAttribute("name");"wishlistForm"==c&&-1!==window.location.pathname.indexOf("account/wishlist")&&($("#wlNotAddedError").addClass("d-none"),location.reload())}else window.location.pathname.indexOf("account/wishlist")>0&&$("#isLoginModalOpen").length>0&&"yes"===$("#isLoginModalOpen").val()&&(history.length<=2?window.location.href="/":history.back());b.focus()}else consoleLog("can't return focus to the modal-opening element, as it could not be found");$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")}),this.initFocus()};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/",tplExt:".jsp",overlayClose:"all",css:{position:"fixed"},modalIsScrollable:!0,useCache:!1},$spinner:null,invisibleOverlay:!1,__cycle:function(){var a=this.thisConstructor,b=a.prototype,c=Array.prototype.slice.call(this.__originalArguments,0),d=this;this.Close();for(var e in b)d[e]=b[e];a.apply(d,c)},initGenericView:function(){BN.Validate.Listen($(this.modal).find("form")),document.body.className.indexOf("lt-ie9")>-1&&!$(".tabgroup span[id]").length&&(consoleLog("IE8 Detected!"),consoleLog("Setting Timeout"),setTimeout(function(){consoleLog("Timeout Executing");var a=document.getElementById("selectivizrScript"),b=a.getAttribute("src");consoleLog("Executing selectivizr..."),consoleLog(jQuery.getScript(b))},500)),$("select").selectBox(),this.on("display",function(){consoleLog("Styling Select Boxes"),$("#state").length>0&&autofillStateFix(),$(this.modal).find("a.selectBox-dropdown").each(function(){var a=$(this),b=a.parent().parent(),c=b.find("label:first"),d=b.find("select"),e=b.find(".selectBox-dropdown-menu"),f=a.find(".selectBox-label"),g=d.attr("id");d.attr("aria-hidden","true"),f.attr("id",g+"-button-label"),e.attr({id:g+"-option-list",role:"listbox"}),e.find("li").each(function(a){$(this).attr("id",g+"-option-"+a)}),""!==g&&c.attr({"for":g+"-replacement",id:g+"-label"}),0===c.length?a.attr("aria-labelledby",g+"-button-label"):a.attr("aria-labelledby",g+"-label "+g+"-button-label"),a.attr({id:g+"-replacement","aria-expanded":"false"}).bind("keydown",function(b){switch(b.which){case 9:case 13:case 27:"true"==a.attr("aria-expanded")||e.not(":visible")?(a.attr("aria-expanded","false").removeAttr("aria-activedescendant"),e.attr("aria-hidden","true")):(e.attr("aria-hidden","false"),a.attr("aria-expanded","true").attr("aria-activedescendant",c));break;case 37:case 38:case 39:case 40:"false"==a.attr("aria-expanded")&&(a.attr("aria-expanded","true"),e.attr("aria-hidden","false"));var c=e.find(".selectBox-selected:first").attr("id");a.attr("aria-activedescendant",c)}})})}),$(this.modal).find(".styled-radio").attr("role","radio"),$(this.modal).find(".styled-checkbox").attr("role","checkbox")},initFocus:function(){var a=this;inputs1=null,this.on("display",function(){a.suppressAutoTabindex||(a.addTabIndex(),a.initTabIndex()),a.initFocusImmediately()})},initFocusInParent:function(){var a,b;if(this.parent&&this.parent.displayed)if(a=this.parent.modal,b=$(a).find("iframe"),b.length&&this.parent.data.frameUrl)try{$.postMessage({type:"initFocus",focusSelector:this.data&&this.data.targetSelector},this.parent.data.frameUrl,b.first().get(0).contentWindow)}catch(c){consoleLog("an error occurred trying to give focus to parent modal containing iframe",c),this.parent.initFocusImmediately()}else this.parent.initFocusImmediately()},__displayDom:function(){var a=this;Modal.prototype.__displayDom.apply(this,arguments),this.closeEvents.all.push(function(){a.initFocusInParent()}),$(".text-input input[type='text'], input[type='number'], input[type='password']").each(function(a,b){input_prefill.bind(b)()})},initOverlay:function(){var a=document.createElement("div");return 1==this.invisibleOverlay?(a.style.backgroundColor="#ffffff",a.style.opacity=0,a.style.filter="alpha(opacity=0);"):(a.style.backgroundColor="#000000",a.style.opacity=.5,a.style.filter="alpha(opacity=50);"),a.style.height="100%",a.style.width="100%",a.style.position="fixed",a.style.top="0px",a.style.left="0px",a},useInvisibleOverlay:function(){this.invisibleOverlay=!0},displaySpinner:function(){consoleLog("Displaying spinner...");var a=$(this.modal),b=a.find("header").first(),c={top:"0px","z-index":1,"background-color":"transparent"};return b.length>0&&(consoleLog("Adjusting top to compensate for header"),c.top=b.outerHeight()+"px"),consoleLog("Building spinner"),this.$spinner=$("<div/>").addClass("spinner spinner__large mini-cart-spinner").css(c).html('<img src="/static/redesign/srcs/images/spinner.svg">'),consoleLog("Appending spinner to modal DOM"),this.$spinner.appendTo(a),this.$spinner.focus(),this.$spinner},hideSpinner:function(){return $(this.modal).find(".spinner").remove()},initForm:function(a){var b=this,c=$(this.modal).find('form.uxhr,form[action*="xhr"]');consoleLog("Attaching uXHR to form",c),BN.uXHR.Form.apply(c),consoleLog("Listening for Errors"),c.on("amplifiFormError",function(a,c,d,e,f){var g=f.items;consoleError("Unsuccessful Form Submission: Server's response indicated errors occurred"),consoleLog(g),BN.Validate.DisplayErrors(this,g),b&&b.$spinner&&b.$spinner.remove()}).on("amplifiFormBeforeSubmit",function(){consoleLog("Calling displaySpinner"),b.hideSpinner(),b.displaySpinner()}).on("amplifiFormSuccess",function(d,e){b.hideSpinner();var f=b.data,g=window.location.toString().split("#")[0];if(a===!1||null!=f&&f.redirect===!1)return void consoleLog("Success!");null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl?g=e.redirectSuccessUrl:null!=f&&void 0!=f&&f instanceof Object&&f.redirectSuccessUrl&&""!=f.redirectSuccessUrl?g=f.redirectSuccessUrl:null!=e&&void 0!=e&&e instanceof Object&&null!=e.data&&e.data.brierleyLandingRedirect&&null!=e.data.brierleyLandingRedirectURL&&(g=e.data.brierleyLandingRedirectURL);var h=null,i=(h=c.find('input[name="modalRedirect"]')).length>0;if(i){consoleLog("Success! Redirecting modal to "+h.val());{var j=b.getContructorFromString(h.val());new j(null,null,null,b)}}else{consoleLog("Success! Redirecting page to "+g);var k=g;"undefined"!=typeof BN_EXTERNAL_DOMAIN_PREFIXED&&(k=BN_EXTERNAL_DOMAIN_PREFIXED+k),window.location=k}}).on("firstinvalid",function(){b.$spinner&&b.$spinner.remove()}),$(document).on("click","#guestCheckoutBtn",function(){$("#checkoutForm").submit()}),$(this.modal).find("select").selectBox()},clearForm:function(a){var b=$(a),c="input[type='text'],input[type='email'],input[type='tel'],input[type='password'],input[type='number'],input[type='file'],select,textarea";return b.find(c).val(""),b.find('input[type="radio"], input[type="checkbox"]').removeAttr("checked").removeAttr("selected"),b}},a}(),BN.Modal.SingleInstance,!0),BN.Modal.Base.prototype.tabbableSelector=":tabbable:not([tabindex=-1],:hidden),[data-icon=plus-expand],[data-rating=rate]",BN.Modal.Base.prototype.initTabIndex=function(a){var b=void 0==a||null==a?this:a;$contentContainer=$(b.modal),tabbableSelector="*[tabindex]:not([tabindex=-1],:hidden)",$allTabindexElements=$contentContainer.find(tabbableSelector),maxTabIndex=$allTabindexElements.length?parseInt($allTabindexElements.last().attr("tabindex")):-1;var c=$contentContainer.find("[class^='payPalButtonRenderer']").is(":visible")?!0:!1,d=$contentContainer.find("[class^='cqContentRenderer']").is(":visible")?!0:!1;c||d||$contentContainer.on("keydown",tabbableSelector,function(a){var b,c,d=$(this),e=d.attr("tabindex");9==a.keyCode?(a.preventDefault(),c=parseInt(e)+(a.shiftKey?-1:1),1>c&&(c=maxTabIndex),b=$contentContainer.find("*[tabindex="+c+"]"),b.length||(b=$contentContainer.find("*[tabindex=1]")),b.each(function(){return"none"!=$(this).css("display")?(this.focus(),!1):void 0})):27==a.keyCode&&$contentContainer.length>0&&$(".icon-close-modal").click()})},BN.Modal.Base.prototype.removeTabIndex=function(a){var b=a?a.$parent?a.$parent:a.selector?$(this.modal).find(a.selector):$(this.modal):$(this.modal);b.find("[tabindex]").removeAttr("tabindex")},BN.Modal.Base.prototype.addTabIndex=function(a){var b=void 0!=modalObjToReset&&null!=modalObjToReset?modalObjToReset:this,c=a?a.$parent?a.$parent:a.selector?$(b.modal).find(a.selector):$(b.modal):$(b.modal),d=a&&a.inputSelectors?a.inputSelectors:b.tabbableSelector+(b.addToTabindex?","+b.addToTabindex:""),e=c.find(d),f=1;inputs1=e[1],consoleLog("addTabIndex => $inputs = ",e),e.each(function(){var a=$(this);b.excludeFromTabindex&&a.is(b.excludeFromTabindex)||a.attr("tabindex",f++)})},BN.Modal.Base.prototype.initFocusImmediately=function(a,b){var c,d,e=a||$(this.modal),f=!1,g=$(inputs1).hasClass("selectBox")?["a.selectBox:first","input[autofocus]","input[type=text]:visible:first",this.tabbableSelector]:["input[autofocus]","input[type=text]:visible:first",this.tabbableSelector],h=function(b){if(b&&b.length>0){if(b.hasClass("egift-date"))return!1;consoleLog("bn.base.js: initFocusImmediately",b),consoleLog("bn.base.js: initFocusImmediately parent",a),setTimeout(function(){"icon-close-modal"!=b.first()[0].className&&"modal__banner"!=b.first()[0].className?(b.focus(),b.first()[0].focus()):setTimeout(function(){$(b.first()[0]).focus()},10)},0),consoleLog("modal opened.. giving focus to ",b.first()),f=!0}};b=b||this.initFocusSelector,b&&h(b instanceof jQuery?b:e.find(b)),f||$.each(g,function(a,b){return c=e.find(b),d=c.first(),h(d),f?(d.is("a.icon-close-modal")&&c.length>1&&(consoleLog(c.eq(1)),h(c.eq(1))),!1):void 0}),f||consoleLog("modal opened ... couldn't find focusable element");var i=e.attr("data-modal-name");e.children("div .spinner").attr("aria-label","Loading "+i+" modal.."),e.children("div .spinner").attr("role","alert"),e.children("div .spinner").attr("aria-busy","true")},BN.Modal.Base.prototype.getProductNameByURL=function(a){var b="undefined"!=typeof a?a.indexOf("/w/"):!1;if("undefined"==typeof a||-1===b)return!1;var c=a.substring(b+3),d=c.indexOf("/"),e=c.substring(0,d).replace(/-/g," ");this.productName=e},BN.Modal.Base.prototype.getProductNameByModal=function(){for(var a in Modal.openModals)if(Modal.openModals.hasOwnProperty(a)){if("undefined"==typeof Modal.openModals[a].productName)continue;return Modal.openModals[a].productName}},BN.Modal=BN.Modal||{},BN.Modal.Confirm=BN.Modal.Confirm||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Confirm"),consoleLog("Using "+(a||this.tplName)+" template")};return a.prototype={tplName:"confirm",initView:function(){var a=this.data,b=this,c=$(this.modal);if(a&&(a.title&&"string"==typeof a.title&&c.find("#dialog-title").text(a.title),a.message)){var d=c.find("ul").first(),e=d.find("li").first().clone().html("");d.find("li").remove(),e.append(a.message),d.append(e),c.on("click","#confirmTextbookAction",function(c){var d=a.parent,e=d.find(".confirm-action");c.preventDefault(),b.Close(),e.prop("disabled")||(d.submit(),e.attr("disabled",!0))})}}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.educatorProgram=BN.Modal.educatorProgram||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.educatorProgram")};return a.prototype={tplName:"m-educator-program-modal",initView:function(){var a=this,b=$(this.modal),c=window.location;this.initGenericView(),this.initForm(!1);var d=$("#rhf_header_element .rhf-utility-bar li:first.nav-item > a").attr("href");b.find(".icon-close-modal").on("click",function(){b.find(".icon-close-modal").click()}),this.on("display",function(){sessionStorage.removeItem("login-status-check"),$(".bn-membership-link").on("click",function(){a.Close(),c.href="/membership/"}),$(".find-your-store-button").on("click",function(){a.Close(),c.href=d}),$(".free-premium-membership-button").on("click",function(){1==$(".educator-free-member-enroll-section input.educator-free-member-enroll-section-input").prop("checked")?$(".premium-membership-button-educator").click():0==$(".educator-free-member-enroll-section input.educator-free-member-enroll-section-input").prop("checked")&&($(".educator-modal-error-checkbox").removeClass("d-none"),$(".educator-free-member-enroll-section .checkbox__box").css("border-color","#dd2612"))}),$("#freeYearPremiumMembership").on("amplifiFormSuccess",function(b,c){a.Close(),c&&c.membershipOrderNumber&&new BN.Modal.FreeYearPremiumEnrollSuccess(null,{target:this},{useCache:!1,tplParams:{confirmationNumber:c.membershipOrderNumber}})}).on("amplifiFormError",function(a,b){$(".educator-modal-error-vfill").removeClass("d-none"),$(".educator-modal-error-vfill").html(b.response.items)}),setTimeout(function(){$(".educator-modal-main").removeClass("d-none")},1e3)})}},a}(),BN.Modal.Base,!0),BN.Modal.External=BN.Modal.External||{};var externalHref="";BN.Modal.External.Link=BN.Modal.External.Link||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.External.Link")};return a.prototype={tplName:"external-link",defaultOptions:{tplDir:SITE_ROOT+"/modals/",useCache:!1},initView:function(){var a=this,b=this.data,c=$(this.modal),d=$(b.target),e=d.attr("href")||"";"desktop"!=detectHandHeld()||$("body").hasClass("desktop-modal")||$("body").addClass("desktop-modal"),this.on("display",function(){(""!=b["modal-title"]||"undefined"!=b["modal-title"])&&c.find("#dialog-title").text(b["modal-title"]),""!=b["modal-width"]&&"undefined"!=b["modal-width"]&&c.find("iframe").attr("width",b["modal-width"]),""!=b["modal-height"]&&"undefined"!=b["modal-height"]&&c.find("iframe").attr("height",b["modal-height"]),""!=b["modal-scrolling"]&&"undefined"!=b["modal-scrolling"]&&c.find("iframe").attr("scrolling",b["modal-scrolling"]),c.find("iframe").attr({src:e,title:b["modal-title"]}),modalObjToReset=a,resetModalTabbing(modalObjToReset,!0),c.find(".icon-close-modal").focus()})}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.FreeYearPremiumEnrollSuccess=BN.Modal.FreeYearPremiumEnrollSuccess||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.FreeYearPremiumEnrollSuccess")};return a.prototype={tplName:"m-free-year-premium-enroll-success",initView:function(){var a=this,b=$(this.modal),c=window.location;this.initGenericView(),this.initForm(!1);var d=a.userOptions.tplParams.confirmationNumber,e="/account/orders/order-details.jsp?orderId="+d+"&page=thankYou";b.find(".icon-close-modal").on("click",function(){b.find(".icon-close-modal").click(),c.reload()}),this.on("display",function(){$(".order-confirmation-detail__value").attr("href",e),$(".order-confirmation-detail__value").text(d),$("#shopAtBnBtn").on("click",function(){a.Close(),c.reload()}),setTimeout(function(){$(".m-free-year-premium-enroll-modal").removeClass("d-none")},1500)})}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.ShellAccountCreation=BN.Modal.ShellAccountCreation||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.ShellAccountCreation")};return a.prototype={tplName:"m-shell-account-creation",initView:function(){var a=this,b=$(this.modal);this.initGenericView(),this.initForm(!1),b.find(".icon-close-modal").on("click",function(){b.find(".icon-close-modal").click()}),this.on("display",function(){$("#completeAccount").on("click",function(){a.Close()}),$(".finish-later-link").on("click",function(){a.Close(),location.href="/"})})}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.Success=BN.Modal.Success||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Success")};return a.prototype={tplName:"success-ra",defaultOptions:{tplParams:window.location.href.indexOf("order-details")>-1?{postOrderEditRequest:"true"}:null},initView:function(){var a=this.data,b=$(this.modal),c=this,d=!1;if(a&&(a.title&&"string"==typeof a.title&&b.find("#dialog-title").html(a.title).attr("aria-label",a.title),a.messages)){var e=b.find("p"),f=$("<span/>");e.html(""),e.parent().addClass("modal-success-message");for(var g in a.messages)if(a.messages.hasOwnProperty(g)){var h=a.messages[g];switch(h.type){case"success":e.append(f.clone())}0==g&&e.addClass("success-first"),e.append(h.message),"You have successfully changed your password!"===h.message&&(d=!0)}a.onclose&&this.closeEvents.all.push(a.onclose),a.target&&a.target.blur(),this.on("display",function(){d&&$(".modal__content").addClass("modal-password-assistant")}),this.closeEvents.all.push(function(){var a;c.data&&c.data.target?(a=$(c.data.target),consoleLog("returning focus to ",a.find("[type=submit]")),a.find("[type=submit]").focus(),"true"==$("#PhoneNumberUpdated").val()&&location.reload()):consoleLog("can't return focus to the modal-opening element, as it could not be found"),$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")})}}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.SweepStakeTerms=BN.Modal.SweepStakeTerms||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.SweepStakeTerms")};return a.prototype={tplName:"m-sweep-stake-terms",initView:function(){var a=this,b=($(this.modal),a.data.target,$("#cqTermsModalContent").val());consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){$(".sweepStake-terms-modal").attr("src",b)})}},a}(),BN.Modal.Base,!0),BN.Modal=BN.Modal||{},BN.Modal.updateConversion=BN.Modal.updateConversion||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.updateConversion")};return a.prototype={tplName:"m-update-conversion-modal",initView:function(){var a=this,b=$(this.modal),c=window.location;this.initGenericView(),this.initForm(!1),b.find(".icon-close-modal").on("click",function(){b.find(".icon-close-modal").click()}),this.on("display",function(){sessionStorage.removeItem("login-status-check"),$(".update-conversion-modal-button").on("click",function(){a.Close(),c.href="/membership/"})})}},a}(),BN.Modal.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
BN.Modal.QAS=BN.Modal.QAS||{},BN.Modal.QAS.Base=BN.Modal.QAS.Base||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.QAS.Base"),this.data=b};return a.prototype={data:null,excludeFromTabindex:"input[type=radio][name=address]",addToTabindex:"button.btn--green, button.btn--large",defaultOptions:{tplDir:SITE_ROOT+"/modals/qas/",useCache:!1},initView:function(){var a=this,b=this.tplName,c=(this.data,$(this.modal));return a.parent&&a.parent.pureModal&&a.parent.hideSpinner(),this.initAddrEntered(),c.find("select").selectBox(),"partial-ra"==b?this.initPartialView():this.initStandardView()},initAddrEntered:function(){var a=this,b=this.data,c=$(this.modal),d=c.find("[id^=addrEntered]");$(b.qas.form).on("amplifiFormError amplifiFormSuccess",function(){a.Close()}),c.find("[id^=asEntered]").on("click",function(){consoleLog("Using As Entered"),a.parent&&a.parent.pureModal?a.Close():a.displaySpinner(),b.selectAddress(-1),a.displaySpinner()}),d.find("address").children().first().html(b.address.address1+(""==b.address.address2?"":"<br>"+b.address.address2)+"<br>"+(""==b.address.city?"":b.address.city+", ")+(""==b.address.state?"":b.address.state)+"<br>"+(""==b.address.postalCode?"":b.address.postalCode+"<br>")+b.address.country)},initStandardView:function(){{var a=(this.tplName,this.data);a.suggestions,$(this.modal)}this.addAddressSuggestions()},initPartialView:function(){var a=this,b=(this.tplName,this.data),c=(b.suggestions,{}),d="",e=$(this.modal);switch(BN.QAS.CountryHelperFactory.Bind(e.find("[id^=addAddress]")),b.verificationType){case"PremisesPartial":d="address2",e.find("#qas_address2").parent(".text-input").addClass("invalid");break;case"StreetPartial":default:d="address1",e.find("#qas_address1").parent(".text-input").addClass("invalid")}for(var f in b.address){var g=e.find("#qas_"+f);g.length<0||(c[f]=g,g.val(b.address[f]),"state"==f&&($state=this.$state=e.find("select.address-state-selecter"),$state.selectBox("value",b.address[f])))}f=g=void 0,"PremisesPartial"===b.verificationType&&""!==b.address.address2?(e.find(".alert--error").show(),e.find("#experianPrompt").text()):b.prompt&&(e.find(".alert--error").show(),e.find("#experianPrompt").text(b.prompt)),"StreetPartial"===b.verificationType&&e.find("#SuggestedOption").hide(),e.find(".partial-matches-done").on("click",function(){var d=e.find(".address-list").find(".radio-wrapper [name=addressOptions]:checked").val();if("edit"===d){var f={};for(var g in c)f[g]=c[g].val();b.replaceAddress(f)}else if("entered"===d)b.selectAddress(-1);else{var h=$(".suggested-address-details").find("input[type=radio]:checked").val();b.selectAddress(h)}a.parent&&a.parent.pureModal?a.Close():a.displaySpinner()}),this.addAddressSuggestions()},addAddressSuggestions:function(){var a=this,b=this.tplName,c=this.data,d=c.suggestions,e=$(this.modal);if("nomatches"!=b){var f=e.find("[id^=addrMatches]"),g=f.find(".suggested-addresses").first().clone();f.empty();for(var h=0;h<d.length;h++){var i=d[h],j=g.clone(),k=j.find('input[type="radio"]');k.val(h).prop("checked",!1),j.find("address").attr("id","selectOptionEdit_"+h),j.find('input[type="radio"]').attr("aria-describedby","selectOptionEdit_"+h),j.find("address").children().first().html(i.address1+(""==i.address2?"":"<br>"+i.address2)+"<br>"+(""==i.city?"":i.city+", ")+(""==i.state?"":i.state)+"<br>"+(""==i.postalCode?"":i.postalCode+"<br>")+i.country),j.appendTo(f)}}e.find(".matches-done").on("click",function(){var b=$(".modal-matches-address .radio-wrapper").find("input[type=radio]:checked").val();1===a.data.suggestions.length&&(b="single-match"===b?0:-1),a.parent&&a.parent.pureModal?a.Close():a.displaySpinner(),c.selectAddress(b)}),this.closeEvents.all.push(function(){$("#orderSummary").find(".spinner").is(":visible")&&$("#orderSummary").find(".mini-cart-spinner").remove()}),e.find(".continue").hide(),this.on("display",function(){if("matches-ra"===this.tplName&&$('.suggested-addresses input[type="radio"]').first().attr("checked","checked").prop("checked","checked"),"partial-ra"===this.tplName){if("PremisesPartial"===this.data.verificationType&&""!==this.data.address.address2){var a=$("#qas_address2").data("aptError");$(this.modal).find("#experianPrompt").text(a)}var b=$("[name=addressOptions]:checked");b&&$(b).parents(".address-list").find(".address-info").show(),$(this.modal).find('.suggested-addresses [data-match-height="items"]').matchHeight();var c=1,d=e.find(":visible:tabbable");d.each(function(){$(this).attr("tabindex",c++)});var f=function(){var a=1,b=e.find(":visible:tabbable");b.each(function(){$(this).attr("tabindex",a++)})};$("[name=addressOptions]").click(function(){e.find(":visible:tabbable").each(function(){$(this).removeAttr("tabindex")}),$(".address-info").hide(250),$("."+$(this).val()+"Address").show(250,f)})}e.find(".icon-close-modal").on("keydown",function(a){a.shiftKey&&9===a.keyCode&&(a.preventDefault(),a.stopPropagation(),e.find(":visible:tabbable:last").focus())}),$(this.modal).find("a.selectBox-dropdown").each(function(){var a=$(this),b=a.parent().parent(),c=b.find("label:first"),d=b.find("select"),e=b.find(".selectBox-dropdown-menu"),f=a.find(".selectBox-label"),g=d.attr("id");a.attr("href","javascript:void(0)"),d.attr("aria-hidden","true"),f.attr("id",g+"-button-label"),e.attr({id:g+"-option-list",role:"listbox"}),e.find("li").each(function(a){$(this).attr("id",g+"-option-"+a),$(this).attr("role","option")}),""!==g&&c.attr({"for":g+"-replacement",id:g+"-label"}),a.attr({id:g+"-replacement",role:"combobox","aria-labelledby":g+"-button-label","aria-expanded":"false"}).bind("keydown",function(b){switch(b.which){case 9:case 13:case 27:"true"==a.attr("aria-expanded")||e.not(":visible")?(a.attr("aria-expanded","false").removeAttr("aria-activedescendant"),e.attr("aria-hidden","true")):(e.attr("aria-hidden","false"),a.attr("aria-expanded","true").attr("aria-activedescendant",c));break;case 37:case 38:case 39:case 40:"false"==a.attr("aria-expanded")&&(a.attr("aria-expanded","true"),e.attr("aria-hidden","false"));var c=e.find(".selectBox-selected:first").attr("id");a.attr("aria-activedescendant",c)}})})})}},a}(),BN.Modal.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
function refreshEditModal(a,b){var c=$(a.modal).data("modal-name");a.Close(),window.location.href.indexOf("checkout")>-1&&"m-paypal-use-saved-billing"===c?new BN.Modal.Checkout.PaypalUseSavedBillingAddr(null,{target:this},{useCache:!1,tplParams:{paymentgrouptypesavebilling:b.data.data.paymentgrouptypesavebilling.value}}):window.location.href.indexOf("checkout")>-1?new BN.Modal.Checkout.UseSavedAddress(null,{target:b},null,b):window.location.href.indexOf("order-details")>-1&&new BN.Modal.Checkout.UseSavedAddressForPostOrderEdit(null,a.data,null,b)}function updateIndexes(){$(".kids-container ul:first li").each(function(a){var b=$(this);b.attr("id","item_"+a);var c=b.find("a").attr("href"),d=c.split("?")[0],e=c.split("?")[1];b.find("a").attr("href",d+"?"+e.split("&")[0]+"&index="+a)})}function refreshPaymentEditModal(a,b){a.Close(),window.location.href.indexOf("checkout")>-1?new BN.Modal.Checkout.UseSavedCC(null,{target:b},null,b):window.location.href.indexOf("order-details")>-1&&new BN.Modal.Checkout.PostUseSavedCC(null,{target:b},null,b)}function toggleShippingAddress(){var a=$("#addressInputs").find("input, .selectBox-dropdown").not("input[type='hidden']");if($("#useShippingAddress").prop("checked")){$(".address").show(),$("#addressInputs").hide(),$("#firstName,#lastName,#streetAddress,#city,#state,#zipCode,#phoneNumber").removeAttr("required");for(var b=0;b<a.length;b++)$(a[b]).attr("tabindex",-1);$("#addAddressSubmit").attr("tabindex",Number($("#emailAddress").attr("tabindex"))+1),$("#addPaymentCancel").attr("tabindex",Number($("#emailAddress").attr("tabindex"))+2)}else{var c=1;$(".address").hide(),$("#addressInputs").show(),$("#firstName,#lastName,#streetAddress,#city,#state,#zipCode,#phoneNumber").attr("required","required");for(var b=0;b<a.length;b++)$(a[b]).attr("tabindex",Number($("#emailAddress").attr("tabindex"))+c),c++;$("#addAddressSubmit").attr("tabindex",Number($("#emailAddress").attr("tabindex"))+c),$("#addPaymentCancel").attr("tabindex",Number($("#emailAddress").attr("tabindex"))+(c+1))}}function searchStore(){var a=$("#searchString").val();if(new RegExp($("#searchString").attr("pattern")).test(a)){$("#searchString").parent(".zipcode-input").removeClass("invalid"),$(".search-invalid").addClass("hidden").attr("aria-hidden",!0);var b=$("#radius option:selected").val();$("body").hasClass("shopping-bag")&&(page="cart"),getStoreDetails("?action=fromSearch&radius="+b+"&searchString="+a+"&myBn="+myBN+"&page="+page)}else{var c="valid ";""==a&&($("#searchString").val(""),c=""),$(".search-invalid").html("Please enter "+c+$("#searchString").attr("aria-label")),$("#searchString").parent(".zipcode-input").addClass("invalid"),$(".search-invalid").removeClass("hidden").attr("aria-hidden",!1),$("#searchString").focus()}}function getStoreDetails(a){var b=2e3,c="store-list-item.jsp";($("body").hasClass("pdpPage")||$("body").hasClass("shopping-bag"))&&""!==skuId&&(b=$("[name='dslSocketTimeOut']").val(),c="storeList-with-prodAvailability.jsp",""==a?a="?skuId="+skuId:a+="&skuId="+skuId),(void 0===b||null===b)&&(b=2e3);var d=webContextRoot+"/xhr/"+c+a;$.ajax({url:d,cache:!1,timeout:b,type:"get"}).done(function(b){if($(".storeList").html(b),searchModalInvoked&&a.indexOf("fromSearch")<0&&(s_setP("digitalData.event["+searchModalInvokedEventIndex+"].attributes.page.attributes.searchResults",$("#noOfStores").val()),_satellite.track("onPageView")),a.indexOf("fromGeo")>-1&&parentModal.closeEvents.button.push(function(){window.location.reload(!0)}),$("#bopisException").length>0&&openStoreUnavailableModal(),a.indexOf("fromSearch")>-1&&"undefined"!=typeof s_setP){var c=getAnalyticsEventCount();s_setP("digitalData.event["+c+"].eventInfo.eventName","Find My Store Search Click"),s_setP("digitalData.event["+c+"].eventInfo.eventAction","findMyStoreSearchClick"),s_setP("digitalData.event["+c+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+c+"].category.primaryCategory","Modals"),s_setP("digitalData.event["+c+"].attributes.page.attributes.searchType","keyword"),s_setP("digitalData.event["+c+"].attributes.page.attributes.searchTerm",$("#searchString").val()),s_setP("digitalData.event["+c+"].attributes.page.attributes.searchResults",$("#noOfStores").val()),_satellite.track("onFindMyStoreSearchClick")}if("undefined"!=typeof s_setP){var d=$(".storeAvailable").length>0?$("#storeName").val():$("#currStoreName").val(),e=$(".storeAvailable").length>0?$("#storeID").val():$("#currStoreID").val();s_setP("digitalData.user[0].profile[0].profileInfo.storeName",d),s_setP("digitalData.user[0].profile[0].profileInfo.storeID",e)}var f=$("#searchString");f.attr("data-selected-id",""),$(".default-selected-store").is(":visible")&&0==$(".modal__content").hasClass("modal-height")&&$(".modal-find-my-store").addClass("selected-store-list__content");var g=$("#modalContainer").find(".selectBox-dropdown-menu").attr("id");$("#modalContainer").find(".selectBox-container").find(".selectBox-dropdown").attr("aria-owns",g),$("#modalContainer").find(".selectBox-dropdown-menu").find("li").attr("role","option");var h=$("#modalContainer").children(".search-section").find(":tabbable:last").attr("tabindex");$("#modalContainer").find(".storeList").find(":tabbable").each(function(){$(this).attr("tabindex",++h)}),$(".modal__header").find(".icon-close-modal").on("keydown",function(a){a.shiftKey&&9==a.keyCode&&($("#modalContainer").find(".storeList").length>0?($("#modalContainer").find(".storeList").find(":tabbable:last").focus(),a.stopPropagation(),a.preventDefault()):($("#modalContainer").find(".search-section").find(":tabbable:last").focus(),a.stopPropagation(),a.preventDefault()))});var i=$("#changeStoreBtnPosition");$("form[id^=storeSelectorForm]").each(function(){i.length>0&&"modal"==i.val()&&$("form[id^=storeSelectorForm] input[name=xhrRedirect]").val(""),BN.uXHR.Form.apply($(this)),$(this).on("amplifiFormBeforeSubmit",function(){BN.uXHR.Form.apply($(this))}).on("amplifiFormSuccess",function(a,b){var c=$(".open-ss-modal").siblings(".storeAvailable").length>0?"storeUpdated":"storeSelected",d=b.storeId+"-"+c;setCustomCookie("selected-storeId",d),i.length>0&&"modal"==i.val()?($("#eligibleMessageUpdated").val(b.bopisEligibleMessage),$("#currStoreID").val(b.storeId),$("#currStoreName").val(b.storeName),parentModal.Close()):window.location.reload(!0)}).on("amplifiFormError",function(){})})}).fail(function(a,b){"timeout"===b&&openStoreUnavailableModal()})}function openStoreUnavailableModal(){parentModal.Close();var a="",b=[];a="myBN"===myBN?"#MyBarnesAndNoble is Currently Unavailable":"Buy Online, Pick up in Store is Currently Unavailable",b.push({type:"success",message:"We're sorry for the inconvenience. Please try again later."}),new BN.Modal.Account.StoreUnavailable(null,{title:a,messages:b,target:parentModal.data.target},{css:{position:"fixed"}})}function showStoreTiming(a){"false"===$(a).attr("aria-expanded")?($(a).next().show(),$(a).attr("aria-expanded",!0)):($(a).next().hide(),$(a).attr("aria-expanded",!1))}BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Base=BN.Modal.Account.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/account/"},initFrameForm:function(a){var b=this;$(window).on("amplifiFrameFormSuccess",function(c,d){var e=b.data,f=window.location.toString().split("#")[0];if(a===!1||e.redirect===!1)return loadDynamicHeaderElements(),void consoleLog("Success!");null!=d&&void 0!=d&&d instanceof Object&&d.redirectSuccessUrl&&""!=d.redirectSuccessUrl?f=d.redirectSuccessUrl:null!=d&&void 0!=d&&d instanceof Object&&d.redirect&&""!=d.redirect?f=d.redirect:null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl&&(f=e.redirectSuccessUrl),consoleLog("Success! Redirecting page to "+f);var g=f;"undefined"!=typeof BN_EXTERNAL_DOMAIN_PREFIXED&&(g=BN_EXTERNAL_DOMAIN_PREFIXED+g),"true"==d.captureTeleNo&&-1==window.location.href.indexOf("/membership")?(b.Close(),new BN.Modal.Account.AddPhoneNumber(null,{target:this})):window.location=g})}},a}(),BN.Modal.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.AddNewCC=BN.Modal.Account.AddNewCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.AddNewCC")},b="m-add-new-cc",c={};return"true"==$("#isEgiftLogin").val()&&(c={tplParams:{isEgift:"true"},useCache:!1}),a.prototype={tplName:b,defaultOptions:c,initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=this,e=(this.payment,$(this.modal)),f=e.find("#payWCCLink"),g=e.find("#payWPPLink"),h=e.find("form");f.on("keydown",function(a){13===a.keyCode&&setTimeout(function(){$(a.target).focus(),$(a.target).addClass("focus")},500)}),g.on("keydown",function(a){13===a.keyCode&&setTimeout(function(){$(a.target).focus(),$(a.target).addClass("focus")},500)}),f.on("click",function(){$(".add-credit-card-form").show(),$(".add-credit-card-form").attr("aria-hidden",!1),$(".other-payment-mode").hide(),$(".other-payment-mode").attr("aria-hidden",!0),resetModalTabbing(d,!1)}),g.on("click",function(){$(".add-credit-card-form").hide(),$(".add-credit-card-form").attr("aria-hidden",!0),$(".other-payment-mode").show(),$(".other-payment-mode").attr("aria-hidden",!1),resetModalTabbing(d,!0)}),!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),e.find("#addAddress a.link-with-arrow, #existingAddress a.link-with-arrow").on("click",function(a){a.preventDefault();var b=$(this).parents(".addressSection").first().attr("id"),c=e.find("#addAddress"),f=c.find("input, select"),g=e.find("#existingAddress"),h=e.find("#useNewAddress");if("addAddress"==b){c.hide();for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&(j.removeAttr("required"),$("#formSubmitValue").val("exsistAddress"))}g.show(),d.clearForm(c)}else{c.show();for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&"country"!=j.attr("id")&&(j.attr("required","required"),$("#formSubmitValue").val("addAddress"))}g.hide(),h.click()}d.RefreshPosition()}),e.find(".expand-cvv-container").hide(),e.find(".expand-cvv").on("click",function(){e.find(".expand-cvv-container").toggle(),e.find(".expand-cvv").toggleClass("expandicon-change")}),this.initGenericView(),this.initForm();var e=$(this.modal),h=$(this.modal).find("#addPaymentSavedAddress");BN.uXHR.Form.apply(h),h.on("amplifiFormSuccess",function(){window.location.reload(!0)}),this.on("display",function(){var a=h.find("input[autofocus]");a.length&&a.focus()}),this.on("display",function(){var a=this,b="true"==$("#masterpassUpgradedNewLogic").val();loadADIScript("paymentMethod2"),masterPassConfigure(b),$("body").hasClass("lt-ie9")&&initPaymentTabs(),$("#addPaymentSavedAddress").find("#ccMonth~div ul").removeAttr("role"),$("#addPaymentSavedAddress").find("#ccYear~div ul").removeAttr("role"),$("#useShippingAddress").on("change",function(){togglePaymentBillingAddressForm()}),$("[data-tabs]").tabs(),updateNookForwardUrl(),$("body").hasClass("nook-login-page")&&$("select").selectBox(),$('li[role="presentation"]:last').on("click",function(){$(".modal-add-credit-card").length>1?($(".modal-add-credit-card .payPalButtonRenderer").last().addClass("payPalButtonRendererLast"+$(".modal-add-credit-card").length),!$(".modal-add-credit-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length).children().length>0&&(initPaypalExpress(".modal-add-credit-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length),modalObjToReset=a)):(!$(".modal-add-credit-card .payPalButtonRenderer").children().length>0&&initPaypalExpress(".modal-add-credit-card .payPalButtonRenderer"),modalObjToReset=a)}),$("#paymentOptions").find(".tab").removeAttr("aria-controls"),$(".add-cc-tooltip").tooltip(),$(".tooltip-icon-info").on("keypress",function(a){var b=a.which;13==b&&$(".tooltip-icon-info").click()}),$(".tooltip a").keydown(function(a){a.shiftKey&&9===a.keyCode||!a.shiftKey&&9===a.keyCode?($(this).focus(),$(this).addClass("focus")):13===a.keyCode&&$(this).click(),a.preventDefault(),a.stopPropagation()}),$("#emailAddress").on("keydown",function(a){focusInGuestAdd(a)}),$("#addAddressSubmit").on("keydown",function(a){focusInGuestAdd(a)}),h.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){$("aside#payPalShipingAddressError").hide(),BN.Validate.HasErrors(h)?(consoleLog("in display spin"),d.displaySpinner()):(consoleLog("in hide "),d.hideSpinner())});var c=$("form#addPaymentSavedAddress").find("#paymentBillingAddress");$("#addAddressSubmit").on("click",function(){$("#useShippingAddress").is(":checked")&&c.length>0&&c.clearForm(c)}),$("form#audiobookForm--new").on("amplifiFormError",function(a,b){var c=$(this),d=c.find("input[type='submit']"),e=c.attr("id"),f=b.adiRecomendationCode;if("2FAREQUIRED"==b.response.items[0].toUpperCase())new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:c,formBtn:d,formId:e,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}});else if(f&&"DENY"===f.toUpperCase()){var g=c.find("#addNewPaymentDetails");g&&g.length>0&&(g.prop("disabled",!0),g.addClass("adi-deny-button"))}})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.HelpShippingPreferences=BN.Modal.Account.HelpShippingPreferences||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.HelpShippingPreferences")};return a.prototype={tplName:"m-help-shipping-preferences",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.AudiobookCreditsInfo=BN.Modal.Account.AudiobookCreditsInfo||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.AudiobookCreditsInfo")};return a.prototype={tplName:"m-audiobook-credits-info",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);{var b=a.userOptions.tplParams.noOfCredits;a.userOptions.tplParams.subscriptionPlan}this.on("display",function(){$("#title").append("You Still have "+b+" Credit(s)"),$("#cancelSubscription").on("click",function(){cancelSubscriptionModalAnalytics(),a.Close()})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.AudioPlayerFeatureTour=BN.Modal.Account.AudioPlayerFeatureTour||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.AudioPlayerFeatureTour")};return a.prototype={tplName:"m-audioplayer-feature-tour",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){$(".product-shelf-ab").slick({dots:!0,arrows:!0,infinite:!1,slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,accessibility:!1});var a=1;$("#audioplayerCarousel").find(".slick-active").length>0&&($(".slick-next").on("click",function(){a+=1,audioplayerFeatureTourAnalytics(a)}),$(".slick-prev").on("click",function(){a-=1,audioplayerFeatureTourAnalytics(a)})),audioplayerFeatureTourAnalytics(a)})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmCreditPurchase=BN.Modal.Account.ConfirmCreditPurchase||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmCreditPurchase")};return a.prototype={tplName:"m-confirm-credit-purchase",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.buttonText,c=a.userOptions.tplParams.pdpUrl,d=a.userOptions.tplParams.productName,e=a.userOptions.tplParams.pImageUrl,f=a.userOptions.tplParams.preorderAvailableDate,g=a.userOptions.tplParams.authorURL,h=a.userOptions.tplParams.author,i=a.userOptions.tplParams.skuId,j=$("#subscriptionPlan_"+i).val(),k=a.userOptions.tplParams.productId,l=a.userOptions.tplParams.giftlistId,m=a.userOptions.tplParams.giftItemId,n=a.userOptions.tplParams.ABFormat;if($("#listView").is(":visible"))var o=$("#totalAvailableCredits_"+i).val(),p=$("#nextBillDate_"+i).val();else var o=a.userOptions.tplParams.totalAvailableCredits,p=a.userOptions.tplParams.nextBillDate;"undefined"==typeof j&&(j=a.userOptions.tplParams.subscriptionPlan),this.on("display",function(){$("#skuID").val(i),$("#productID").val(k),$("#giftlistID").val(l),$("#giftItemID").val(m),"buyNow"==b?$(".heading").append("Confirm Credit Purchase"):"preOrder"==b&&($(".heading").append("Confirm Credit Pre-Order Purchase"),$("#preorderMsg").removeClass("d-none").addClass("d-sm-block d-md-flex align-items-center")),$("#creditsYouGet").text("1 Credit"==j?"1 credit":"2 credits"),$("#creditDate").text(p),$("#creditsAvl").text(o),$("#format").text(n),$("#preorderDate").text(f),$("#imgDiv").append("<a href="+c+"><img src="+e+' class="full-shadow" alt='+d+" /></a>"),$("#abAuthor").append('by <a href="'+g+'">'+h+"</a>"),$(".abTitle").append('<h3 itemprop="name"><a href="'+c+'" aria-label="'+d+'">'+d+"&nbsp; </a></h3>"),$("#cancelPurchase").on("click",function(){a.Close()});var q=$(".ip-form-ab");BN.uXHR.Form.apply(q),q.on("amplifiFormSuccess",function(){console.log("success"),window.location=SITE_DOMAIN_URL+"/checkout/thank-you.jsp"}).on("amplifiFormError",function(){})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmDelete=BN.Modal.Account.ConfirmDelete||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Account.ConfirmDelete"),consoleLog("Using "+(a||this.tplName)+" template"),b&&b.data&&b.data.id&&(this.payment=b)};return a.prototype={tplName:null,tplDir:SITE_ROOT+"/modals/account/",initView:function(){var a=this,b=this.payment,c=$(this.modal);b.fillEditor(c);var d=parseInt(c.find('[data-editprop="expirationMonth"]').text(),10);10>d&&(d="0"+d),c.find('[data-editprop="expirationMonth"]').text(d),this.on("display",function(){addCreditCardImage(b.data.creditCardType.value)}),c.find("form").on("submit",function(){a.displaySpinner()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmEmailChange=BN.Modal.Account.ConfirmEmailChange||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmEmailChange")};return a.prototype={tplName:"m-confirm-email-change-ra",initView:function(){var a=$(this.modal);this.initGenericView(),this.initForm(!1),a.find("#emailChangeSubmit").on("click",function(){a.find(".btn-cancel").click(),$("#changeEmailForm .btn-submit").click()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmMembershipInstantPurchase=BN.Modal.Account.ConfirmMembershipInstantPurchase||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmMembershipInstantPurchase")};return a.prototype={tplName:"m-confirm-instant-purchase",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form",a.userOptions.tplParams),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.confirmationType,c=a.userOptions.tplParams.confirmationNumber,d=a.userOptions.tplParams.confirmationTotal,e=(a.userOptions.tplParams.expiryDate,a.userOptions.tplParams.expiredLegacy),f=a.userOptions.tplParams.legacygreater,g="/account/orders/order-details.jsp?page=thankYou&orderId="+c;this.on("display",function(){document.body.appendChild(document.createElement("script")).src="/static/redesign/srcs/js/carousels.js",$(".instant-value").attr("href",g),$(".orderno.instant-value.confirmation-no").text(c),$(".orderno.total.instant-value .instant-amount").text(d),reqOnPurchaseMembershipAnalytics(),"purchase"==b?($(".membershipModal-1").removeClass("d-none"),$(".instant-texts-upgrade").removeClass("d-none"),$(".tote-bag-icon").removeClass("d-none"),membershipConfirmInstantPurchaseModalAnalytics("join")):"upgrade"==b?($(".membershipModal-2").removeClass("d-none"),$(".instant-texts-upgrade").removeClass("d-none"),$(".instant-detail.membershipModal-2").removeClass("d-none"),membershipConfirmInstantPurchaseModalAnalytics("upgrade"),instancePurchaseMembershipUpgradeToPremiumAnalytics("Upgrade")):"renew"==b&&($(".membershipModal-5").removeClass("d-none"),$(".instant-texts-renew").removeClass("d-none"),$(".tote-bag-icon").removeClass("d-none"),membershipConfirmInstantPurchaseModalAnalytics("renew")),"true"==e&&instancePurchaseMembershipUpgradeToPremiumAnalytics("Join"),"true"==f?($(".membershipModal-4").removeClass("d-none"),$(".store-icon").removeClass("d-none"),$(".orderno.total.instant-value .legacy-amount-value").removeClass("d-none")):"renew"==b?$(".membershipModal-6").removeClass("d-none"):($(".membershipModal-3").removeClass("d-none"),$(".orderno.total.instant-value .legacy-amount-value").addClass("d-none"),$(".tote-bag-icon").removeClass("d-none")),$(".icon-close-modal").on("click",function(){location.reload()})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmPhoneChange=BN.Modal.Account.ConfirmPhoneChange||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmPhoneChange")};return a.prototype={tplName:"m-confirm-phone-change-ra",initView:function(){var a=$(this.modal);this.initGenericView(),this.initForm(!1),a.find("#phoneChangeSubmit").on("click",function(){a.find(".btn-cancel").click(),$("#changePhoneForm .btn-submit").click()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmPlanChange=BN.Modal.Account.ConfirmPlanChange||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmPlanChange")};return a.prototype={tplName:"m-confirm-plan-change",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.currentSubscriptionPlan,c=a.userOptions.tplParams.newSubscriptionPlan,d=a.userOptions.tplParams.newSubscriptionPrice,e=a.userOptions.tplParams.currentDate,f=(a.userOptions.tplParams.nextBillDate,a.userOptions.tplParams.effectiveBillDate);this.on("display",function(){$("#changePlanMsg").append("You are about to change your NOOK Audiobook Subscription plan from "+b+" / Month to <strong>"+c+" / Month.</strong>"),$("#priceDateText").append(bodyClass.indexOf("pdpPage")>-1||bodyClass.indexOf("landingPage")>-1?"Your new monthly charge will be <strong>$"+d+"</strong> (+ tax) and will start <strong>today ("+e+").</strong>":f==e?"Your new monthly charge will be <strong>$"+d+"</strong> (+ tax) and will start <strong>today ("+f+").</strong>":"Your new monthly charge will be <strong>$"+d+"</strong> (+ tax) and will start <strong>on next billing date ("+f+").</strong>"),$("#selectedSubscriptionPlan").val(c),$("#confirmBtn").on("click",function(){$(this).prop("disabled",!0),bodyClass.indexOf("pdpPage")>-1||bodyClass.indexOf("landingPage")>-1?($("#upgradePlanForm").find("input[type=submit]").click(),$("form[id^=upgradePlanForm]").on("amplifiFormSuccess",function(b,c){var d=c.subscriptionOperationType,e=c.audiobookSubscriptionOrderNumber,f=c.audiobookSubscriptionOrderTotal,g=c.newPlan,h=c.newPlanPrice,i=c.nextRenewDate,j=c.previousPlan,k=c.previousPlanPrice,l="notMyAccount";"changeSubscriptionPlan"==c.subscriptionOperationType?new BN.Modal.Account.SubscriptionConfirmation(null,{target:this},{useCache:!1,tplParams:{subscriptionOperationType:d,audiobookSubscriptionOrderNumber:e,audiobookSubscriptionOrderTotal:f,newPlan:g,newPlanPrice:h,nextRenewDate:i,previousPlan:j,previousPlanPrice:k,fromPage:l}}):window.location.href="/account/audiobook/manage-audiobook-subscription.jsp",a.Close()}).on("amplifiFormError",function(){$("#confirmBtn").prop("disabled",!1)})):($("form[id^=audiobookForm]:visible").find("input[type=submit]").click(),a.Close())}),$(".cancel-text").on("click",function(){a.Close()})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.DiscardMemberShipDetails=BN.Modal.Account.DiscardMemberShipDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.DiscardMemberShipDetails")};return a.prototype={tplName:"m-discard-membership-details",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.autoRenewParam,c=a.userOptions.tplParams.actPremiumParam,d=a.userOptions.tplParams.expPremiumParam;this.on("display",function(){("true"==c||"true"==d)&&("true"==b&&$(".error1").removeClass("d-none"),"false"==b&&$(".error2").removeClass("d-none")),$(".membership-botton-modal, .icon-close-modal").on("click",function(){window.location.href="/account/manage/memberships/associate-membership.jsp"}),$(".member-modal-close").on("click",function(){a.Close()})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditAddress=BN.Modal.Account.EditAddress||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Account.EditAddress"),consoleLog("Received address data:",b),consoleLog("Getting address ID..."),b&&b.data&&b.data.id&&(this.address=b),consoleLog("Retrieved Address ID: "+this.address.data.id),this.Display()};return a.prototype={address:null,tplName:"editaddress",defaultVal:null,defaultOptions:{autoDisplay:!1,tplParams:window.location.href.indexOf("order-details")>-1?{postOrderEditRequest:"true"}:null,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){consoleLog("Initializing view...");var b=this,c=this.address,d=this.parent,e=$(this.modal),f=e.find("form");this.defaultVal=c.getDataValue("default"),this.excludeUPSVal=c.getDataValue("excludeUPS"),b.on("display",function(){this.defaultVal&&e.find("#setDefaultShipping").click(),$("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)})}),e.find("#addAddressCancel").on("click",function(a){a.preventDefault(),b.Close()}),consoleLog("Attaching success listener"),f.on("amplifiFormSuccess",function(e,f){consoleLog("Updating address using values stored in editor",f),c.setValues(f.data),b.defaultVal!=c.getDataValue("default")?window.location=window.location:(consoleLog(c),new a.prototype.initEditAddressSuccessModal(d,b),b.Close())}).on("amplifiFormError",function(a,b){formName=$("#addAddress"),formBtn=$("#addAddress").find("#addAddressSubmit"),"2FAREQUIRED"==b.response.items[0].toUpperCase()&&($("#editAddressErr").hide(),new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:formName,formBtn:formBtn,formId:"addAddress",from:"editAddress",captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}}))}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(f)?b.displaySpinner():b.hideSpinner()}),consoleLog("Attempting to add values to editor"),c.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),this.__displayDom();var g=$("#state");g.val(b.address.getDataValue("addressRegion")),modalDisableUsTerritories(e)},initEditAddressSuccessModal:function(a,b){var c=[];c.push({type:"success",message:"We have successfully updated your Address!"}),new BN.Modal.Success(null,{title:"We&#8217;ve Updated Your Address Book",messages:c,onclose:function(){if(window.location.href.indexOf("review")>-1){var c=location.href;c=c.split("#"),location.href=c[0]}else(window.location.href.indexOf("checkout")>-1||window.location.href.indexOf("order-details")>-1)&&refreshEditModal(a,b)}},{css:{position:"fixed"}})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditKid=BN.Modal.Account.EditKid||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.EditKid")},b=($("#bannerTrigger"),"sdsfssfd/Gender/04/2013"),c=0;return a.prototype={tplDir:SITE_ROOT+"/modals/membership/",tplName:"m-edit-kid-in-member",defaultOptions:{tplParams:{props:b,index:c}},initView:function(){var a=$(this.modal),b=this;this.initGenericView(),this.initForm(),a.find(".btn-submit").on("click",function(c){if(c.preventDefault(),$form=$(this).closest("form"),BN.Validate.HasErrors($form)){var d=$(this).data("index"),e=(a.find("#childsBirthSet").find(".kidval:visible"),$(".kids-container")),f=e.find("ul").first();"remove"==$(this).data("click")?b.deleteRow(d,f):b.updateRowSimple(d,f),b.Close()}})},updateRowSimple:function(a,b){var c=b.find("#item_"+a),d=$("#editKidForm #fName").val()+"/"+$("#editKidForm #gender option:selected").text()+"/"+$("#editKidForm #kidMonth").val()+"/"+$("#editKidForm #kidYear").val(),e=$("#editKidForm #fName").val()+"/"+$("#editKidForm #gender option:selected").text()+"/"+$("#editKidForm #kidMonth option:selected").text()+"-"+$("#editKidForm #kidYear").val();c.find("span").html(e),c.attr("data-val",d);var f=c.find("a").attr("href").split("?")[0];c.find("a").attr("href",f+"?props="+d+"&index="+a)},updateRow:function(a,b,c){var d=c.find("#item_"+a),e="",f="";b.each(function(a){var b=$(this),c=b.val();""==c&&(c=b.text()),e+=c,f+=c,2==a?(e+="-",f+="/"):2>a&&(e+="/",f+="/")}),d.find("span").html(e),d.find("span").data("val",f);var g=d.find("a").attr("href").split("?")[0];d.find("a").attr("href",g+"?props="+f+"&index="+a)},deleteRow:function(a,b){var c=b.find("#item_"+a);c.remove(),updateIndexes()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.EditPayment=BN.Modal.Account.EditPayment||Extend(function(){var a=function(a,b,c,d){consoleLog("Instantiating BN.Modal.Account.EditPayment"),consoleLog("Received payment data:",b),consoleLog("Getting payment ID..."),b&&b.data&&b.data.id&&(this.payment=b),d&&d.data&&(this.parent=d),consoleLog("Retrieved Payment ID: "+this.payment.data.id),this.Display()},b="editpayment-ra";return $("body").hasClass("checkout-member")&&(b="editpaymentorder"),$("body").hasClass("anonymous-order-review")&&(b="editpaymentanonorder"),a.prototype={payment:null,tplName:b,defaultVal:null,defaultOptions:{autoDisplay:!1,tplParams:window.location.href.indexOf("order-details")>-1?{postOrderEditRequest:"true"}:null,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){consoleLog("Initializing view...");var c=this,d=this.payment,e=this.parent,f=$(this.modal),g=f.find("form"),h=g.find("#addressInputs");this.defaultVal=d.getDataValue("default"),f.find("#addPaymentCancel").on("click",function(a){a.preventDefault(),c.Close()}),this.on("display",function(){window.location.href.indexOf("audiobook")>-1&&$("#fromAudiobook").prop("value",new Boolean(!0)),$("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)}),("editpayment-ra"===b||"editpaymentorder"===b)&&loadADIScript("paymentMethod2")}),consoleLog("Attaching success listener"),g.on("amplifiFormSuccess",function(b,f){consoleLog("Updating payment using values stored in editor",f),void 0!=f.data.creditCardNumber&&(f.data.creditCardNumber=f.data.creditCardNumber.slice(-4)),d.setValues(f.data),$("body").hasClass("anonymous-order-review")?(new a.prototype.initEditPaymentSuccessModal(e,c),c.Close()):$("body").hasClass("checkout-member")?location.reload(!0):(new a.prototype.initEditPaymentSuccessModal(e,c),c.Close())}).on("amplifiFormError",function(a,b){formName=g,formBtn=g.find("input[type='submit']"),formId=g.attr("id");var c=b.adiRecomendationCode;"2FAREQUIRED"==b.response.items[0].toUpperCase()?($("#editPaymentErrors").hide(),new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:formName,formBtn:formBtn,formId:formId,from:"editPayment",captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}})):c&&"DENY"===c.toUpperCase()&&formBtn&&formBtn.length>0&&(formBtn.prop("disabled",!0),formBtn.addClass("adi-deny-button"))}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){return $("#addAddress").is(":visible")&&($("#existingAddress").find("input[id^=nickName_]:checked").prop("checked",!1),$("#existingAddress").find("input[id^=nickName_]:checked").attr("aria-checked","false")),$("#useShippingAddress").is(":checked")&&h.length>0&&(h.clearForm(h),$("#firstName,#lastName,#streetAddress,#city,#state,#zipCode,#phoneNumber").removeAttr("required")),BN.Validate.HasErrors(g)?void c.displaySpinner():(c.hideSpinner(),!1)
}),d.config.properties.initialErrors&&(BN.Validate.DisplayErrors(g,d.config.properties.initialErrors),delete d.config.properties.initialErrors),consoleLog("Attempting to add values to editor"),d.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),f.find('[data-editprop="creditCardIcon"]').attr("data-icon",d.getDataValue("creditCardIcon")),f.find("#useShippingAddress").on("click",function(){toggleShippingAddress()}),g.find("#addAddress a.link-with-arrow, #existingAddress a.link-with-arrow").on("click",function(a){a.preventDefault();var b=$(this).parents(".payment-address").first().attr("id"),d=f.find("#addAddress"),e=f.find("#existingAddress");"addAddress"==b?(d.hide(),d.attr({"aria-hidden":"true"}),e.show(),e.attr({"aria-hidden":"false"}),c.clearForm(d),$("#firstName,#lastName,#streetAddress,#city,#state,#zipCode,#phoneNumber").removeAttr("required"),e.find("a.link-with-arrow").focus(),$("#year").find(".selectBox-container").on("keydown",function(a){a.shiftKey||9!=a.keyCode||e.find("a.link-with-arrow").focus()}),e.find("a.link-with-arrow").on("keydown",function(a){a.shiftKey&&9==a.keyCode&&$("#year").find(".selectBox-container a").focus()}),$("#formSubmitValue").val("exsistAddress")):(e.hide(),e.attr({"aria-hidden":"true"}),d.show(),d.attr({"aria-hidden":"false"}),$("#firstName,#lastName,#streetAddress,#city,#state,#zipCode,#phoneNumber").attr("required","required"),d.find("a.link-with-arrow").focus(),$("#formSubmitValue").val("addAddress"),$("#state-button-label").empty(),$(".address-state-selecter").removeClass("selectBox--filled"),$("input[type='text']").parents(".text-input").removeClass("filled")),$(".addressSection .row").on("keydown",function(a){13==a.keyCode&&$(this).hasClass("focus")&&(a.preventDefault(),$(this).find("input[id^=nickName_]").attr("checked",!0),$(this).find("input[id^=nickName_]").attr("aria-checked",!0)),!a.shiftKey&&9==a.keyCode&&$(this).hasClass("focus")&&($("#addAddressSubmit").focus(),$("#addAddressSubmit").addClass("focus"),a.preventDefault(),a.stopPropagation()),a.shiftKey&&9==a.keyCode&&$(this).hasClass("focus")&&(a.preventDefault(),a.stopPropagation(),e.find("a.link-with-arrow").focus())}),$("#addAddressSubmit").on("keydown",function(a){a.shiftKey&&9==a.keyCode&&$(".addressSection .row").is(":visible")&&(a.preventDefault(),$(".addressSection .row :tabbable:last").focus(),a.stopPropagation())}),c.RefreshPosition()}),this.__displayDom(),$("#existingAddress").hide(),toggleShippingAddress(),addCreditCardImage(d.data.creditCardType.value);var i=$("#state");address=c.payment.getDataValue("$PostalAddress"),state=address.getDataValue("addressRegion"),i.val(state),modalDisableUsTerritories(f),f.find("#expirationMonth~div ul").removeAttr("role"),f.find("#expirationYear~div ul").removeAttr("role")},initEditPaymentSuccessModal:function(a,b){var c=[];c.push({type:"success",message:"We have successfully updated your Payment method!"}),new BN.Modal.Success(null,{title:"We've Updated Your Payment Methods",messages:c,onclose:function(){if(window.location.href.indexOf("review")>-1){var c=location.href;c=c.split("#"),location.href=c[0]}else(window.location.href.indexOf("checkout")>-1||window.location.href.indexOf("order-details")>-1)&&refreshPaymentEditModal(a,b)}},{css:{position:"fixed"}})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ErrorCreateAccount=BN.Modal.Account.ErrorCreateAccount||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ErrorCreateAccount")};return a.prototype={tplName:"m-error-create-account",initView:function(){var a=this,b=($(this.modal),a.data.target,a.userOptions.tplParams.errorType);consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){if(sessionStorage.removeItem("login-status-check"),"unification"==b)$("#rewardError").addClass("d-none"),$("#joinBNRewardLink").addClass("d-none");else{var c=[];c.optsIntoPromotional=$(".modal-error-create-account .marketing-mail-value").val(),c.customerID=$(".modal-error-create-account .customer-key").val(),onCreateAccountCompleteAnalytics(c),$("#unificationError").addClass("d-none")}$(".member-rewrd-error-create-link").on("click",function(){"BN.Modal.Account.LoginNew"==$(".join-premium-btn").attr("data-modal-class")||$("#hidden-join-rewards-form-submit-input").click()}),$("#hidden-join-rewards-form-submit").on("amplifiFormSuccess",function(){new BN.Modal.Account.ConfirmMembershipReward(null,{target:this},{useCache:!1,tplParams:{confirmationType:"rewards"}}),a.Close()}).on("amplifiFormError",function(){})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{};var autosuggest=!1,typeaheadResult="",ulContainer="",hiddenOnlyList=!1,skuId="",parentModal="",myBN="",page="";BN.Modal.Account.Findstore=BN.Modal.Account.Findstore||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Findstore.Base")};return a.prototype={tplName:"find-my-store",initView:function(){parentModal=this;this.data;void 0!==this.data&&(skuId=this.data.target.attr("data-skuId"),$("body").hasClass("homepage")&&(myBN=this.data.target.attr("data-myBN"))),$("body").hasClass("shopping-bag")&&(page="cart"),this.closeEvents.all.push(function(){var a=$("#changeStoreBtnPosition").val();"modal"==a&&$("#openReserveModal")[0].click()}),hiddenOnlyList=!1,autosuggest=!1,searchModalInvoked=!1,searchModalInvokedEventIndex=0,this.on("display",function(){if(0==$('script[src="'+$("#jsHostPath").val()+'"]').length){var a=document.createElement("script");a.setAttribute("src",$("#jsHostPath").val()),document.body.appendChild(a)}$(".store-change-notification").length>0&&$(".modal__content").addClass("modal-height"),$(".search-button").on("click",function(){var a=$("#searchString").val(),b=/^\d+$/;b.test(a)&&a.length<5?($(".available-stores").addClass("hidden"),$(".nearby-stores").addClass("hidden"),$(".if-no-store-found").addClass("hidden"),$(".default-selected-store").addClass("hidden"),$("#searchString").parent(".zipcode-input").removeClass("invalid"),$(".search-invalid").addClass("hidden").attr("aria-hidden",!0),$(".invalid-zip-code").removeClass("hidden").addClass("if-no-store-found")):searchStore(),$("#searchString").attr("aria-describedby","searchError")}),$(".search-button-full-width").on("click",function(){$(".search-button").click()}),$(".icon-icon-geolocation").on("click",function(){getUserLocation(!0,!0),$("#searchString").parent(".zipcode-input").hasClass("invalid")&&($("#searchString").val(""),$("#searchString").parent(".zipcode-input").removeClass("invalid filled"),$(".search-invalid").addClass("hidden").attr("aria-hidden",!0))});var b=$("#radius option:selected").val(),c=$(".storeAvailable").length>0?$("#storeName").val():$("#currStoreName").val(),d=$(".storeAvailable").length>0?$("#storeID").val():$("#currStoreID").val();getStoreDetails($(".storeAvailable").length>0||$("#isRopisEnabled").length>0?"?action=fromDefault&radius="+b+"&query="+d+"&storeName="+c+"&myBn="+myBN+"&page="+page:""!==myBN?c&&d?"?action=fromDefault&radius="+b+"&query="+d+"&storeName="+c+"&myBn="+myBN+"&page="+page:"?myBn="+myBN+"&page="+page:""),$("#searchString").on("keyup focus click",function(a){$.fn.bnAutoSuggestBopis({searchInputSelector:$(this),event:a})}),$("#searchString").on("focusout",function(a){$.fn.bnAutoSuggestBopisFocusOut(a)})}),this.initGenericView(),this.initForm();var a=$(this.modal).attr("data-modal-name");if("undefined"!=typeof s_setP){var b=getAnalyticsEventCount();if(s_setP("digitalData.event["+b+"].eventInfo.eventName","Page View"),s_setP("digitalData.event["+b+"].eventInfo.eventAction","pageView"),s_setP("digitalData.event["+b+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+b+"].category.primaryCategory","Modals"),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.pageType","buy online pickup in store"),"Change My Store"===$(this.modal).find("#dialog-title").text()){if(a="change-my-store",s_setP("digitalData.event["+b+"].attributes.page.pageInfo.pageName","store locator:change my store"),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.pageType","buy online pickup in store"),null==sessionStorage.getItem("previousPageName")){var c=$("body").hasClass("homepage")?"Home Page":window.location.href.indexOf("/s/")>-1?"Search Results Page":$(".topXList").length>0?"TopX List Page":"Product Detail Page";s_setP("digitalData.event["+b+"].attributes.page.pageInfo.previousPageName",c),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.destinationURL",window.location.href+"/"+a),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.referringURL",window.location.href)}else s_setP("digitalData.event["+b+"].attributes.page.pageInfo.previousPageName",sessionStorage.getItem("previousPageName")),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.destinationURL",sessionStorage.getItem("destinationURL")+"/"+a),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.referringURL",sessionStorage.getItem("referringURL")),sessionStorage.removeItem("previousPageName"),sessionStorage.removeItem("destinationURL"),sessionStorage.removeItem("referringURL");s_setP("digitalData.event["+b+"].attributes.page.attributes.searchType","fromDefault"),s_setP("digitalData.event["+b+"].attributes.page.attributes.searchTerm",""),searchModalInvoked=!0,searchModalInvokedEventIndex=b}else{var c=$("body").hasClass("homepage")?"Home Page":window.location.href.indexOf("/s/")>-1?"Search Results Page":$(".topXList").length>0?"TopX List Page":"Product Detail Page";s_setP("digitalData.event["+b+"].attributes.page.attributes.searchType",""),s_setP("digitalData.event["+b+"].attributes.page.attributes.searchTerm",""),s_setP("digitalData.event["+b+"].attributes.page.attributes.searchResults","0"),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.previousPageName",c),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.pageName","store locator:find my store"),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.destinationURL",window.location.href+"/"+a),s_setP("digitalData.event["+b+"].attributes.page.pageInfo.referringURL",window.location.href),_satellite.track("onPageView")}}}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.FreeShippingDetails=BN.Modal.Account.FreeShippingDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.FreeShippingDetails")};return a.prototype={tplName:"m-free-shipping-details-ra",initFocusSelector:"h1#dialog-title",initView:function(){var a=this.data,b=$(a.target),c=($(this.modal),b.attr("href")||"");!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),"desktop"!=detectHandHeld()||$("body").hasClass("desktop-modal")||$("body").addClass("desktop-modal"),this.initGenericView(),this.initForm(),this.on("display",function(){$(".icon-close-modal").focus()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ValidateEmailMembership=BN.Modal.Account.ValidateEmailMembership||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ValidateEmailMembership")};return a.prototype={tplName:"m-validate-email-membership",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){validatEmailMembershipModalAnalytics()})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.MembershipInstantPurchase=BN.Modal.Account.MembershipInstantPurchase||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.MembershipInstantPurchase")};return a.prototype={tplName:"m-instant-purchase",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){function b(){$("#addAddress #state.address-state-selecter").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #firstName").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #lastName").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #streetAddress").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #zipCode").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #phoneNumber").removeAttr("required").removeClass("user-error").val(""),$("#addAddress #city").removeAttr("required").removeClass("user-error").val("")}sessionStorage.removeItem("login-membership-check"),$(".hidden-instant-modal-saved-address").removeAttr("value"),newUpgradeRenewalDate();var c=$(".instant-renew-msg .text-dark:nth-child(2), #radio_2").attr("tabindex");c++,$(document).ready(function(){loadADIScript("paymentMethod"),window.innerWidth<651&&($("#collapsePerks").removeClass("show"),$("#accordionPerks .btn").addClass("closed")),$(window).resize(function(){window.innerWidth>650&&!$("#collapsePerks").hasClass("show")?($("#collapsePerks").addClass("show"),$("#accordionPerks .btn").removeClass("closed")):window.innerWidth<651&&$("#collapsePerks").hasClass("show")&&($("#collapsePerks").removeClass("show"),$("#accordionPerks .btn").addClass("closed"))}),$(".membershipSubmitButton").hasClass("disabledbutton")?$(".MainsubmitBtn").attr("type","text"):$(".MainsubmitBtn").attr("type","submit"),$(".instant-purchase-saved-cvv").bind("keyup",function(a){13==a.keyCode&&($(".checkbox-section #tnc").prop("checked")||(a.preventDefault(),$("#editMembershipErrorBlock").removeAttr("style"),$("#editMembershipErrorBlock").html('<em class="emphasis emphasis--alert"> To continue, you must check the box to indicate that you have read and agree to the Terms & Conditions.</em>'),$(".terms-checkbox .checkbox__box").css("border-color","#dd2612")))}),$(document).on("click","#membershipPerks",function(){"true"==$("#membership-perks").attr("aria-expanded")?($("#membership-perks").addClass("d-none").removeClass("d-block"),$("#membership-perks").attr("aria-expanded","false"),$(".show-items").addClass("icon-add").removeClass("icon-remove")):($("#membership-perks").removeClass("d-none").addClass("d-block"),$("#membership-perks").attr("aria-expanded","true"),$(".show-items").addClass("icon-remove").removeClass("icon-add"))})}),$("#accordionPerks .btn").on("click",function(){$("#collapsePerks").hasClass("show")?($("#collapsePerks").removeClass("show"),$("#accordionPerks .btn").addClass("closed")):($("#collapsePerks").addClass("show"),$("#accordionPerks .btn").removeClass("closed"))});var d=$(".Payment-member-term-type-selected").val();"purchase"==!$(".programeTypeConfirm").val()&&instancePurchaseMembershipModalAnalytics(d),bnMembershipInstancePurchasePDPAnalytics(),"false"==$(".Payment-form-default-card").val()?($("#payment2").removeClass("d-none"),$("#new").removeClass("d-none"),$(".membershipSubmitButtonTo").removeClass("d-none"),$(".Payment-form-new-card-added").val("true"),$(".membershipSubmitButton").attr("id","addNewPaymentDetails"),"false"==$(".Payment-form-default-address").val()?($("#addAddress").removeClass("d-none"),$("#addressType").val("addAddress"),$("#instant-bill-address-text").addClass("d-none")):$("#savedAddress").removeClass("d-none"),$("#saved").length>0&&!$("#saved").hasClass("d-none")?($(".changepayment-header").removeClass("d-none").addClass("d-flex"),$("#new").addClass("d-none"),$("#savedAddress").addClass("d-none"),$(".Payment-form-new-card-added").val("false"),$("#state.address-state-selecter").removeAttr("required"),$(".membershipSubmitButton").attr("id","confirmSecurityCodeDisplayBtn"),$(".membershipSubmitButtonTo").addClass("d-none")):($(".changepayment-header").removeClass("d-flex").addClass("d-none"),$(".Payment-form-new-card-added").val("true"),$("#new input:visible").attr("required","required").val(""),$("#ccMonth").attr("required","required"),$("#ccYear").attr("required","required"),$("#companyName").removeAttr("required"),$("#aptSuite").removeAttr("required"))):($("#state.address-state-selecter").removeAttr("required"),$("#payment1 .instant-purchase-saved-cvv").attr("required","required"),taxCalculation($("#savedCardsParentsDefault2"),"premium")),$(".instant-purchase-saved-cvv-input input.instant-purchase-saved-cvv").on("focus",function(){{var a=this.value,b=this;$(".instant-purchase-saved-cvv-input input.instant-purchase-saved-cvv").filter(function(){return $(this).parent().removeClass("filled"),$(this).removeClass("user-success").val("")})}this.value=a,$(b).addClass("user-success")}),$(".instant-purchase-saved-cvv-input .instant-purchase-saved-cvv").on("click focus keyup",function(){var a=$(this).parents(".radio.focus").find("input.d-none").val();$("#new").hasClass("d-none")?$(".newPayment-detail #csv_new").removeAttr("required"):$(".newPayment-detail #csv_new").attr("required","required"),$("#payment2").hasClass("d-none")?($(".hidden-instant-modal-saved-card").val($("#savedCardsDefault2").val()),$(".membershipSubmitButton").attr("id","confirmSecurityCodeDisplayBtn"),$("#state.address-state-selecter").removeAttr("required")):($(".hidden-instant-modal-saved-card").val(a),$(".membershipSubmitButton").attr("id","confirmSecurityCodeDisplayBtn"),$("#state.address-state-selecter").removeAttr("required"))}),$(".instant-purchase-saved-cvv-input").focus().addClass("focus"),$("#savedAddress .payment-card-detail").on("click",function(){var a=$(this).find("input").val();0==$("#savedAddress").hasClass("d-none")&&$(".hidden-instant-modal-saved-address").val($(".saved-pay.selected-pay .payment-element .user-success").val()),0==$("#new").hasClass("d-none")&&$(".hidden-instant-modal-saved-address").val(a),b()}),$("#tnc-renew").on("click",function(){1==$("#tnc-renew").prop("checked")?$(".Payment-form-premium-renew-id").val("9780594080893"):0==$("#tnc-renew").prop("checked")&&$(".Payment-form-premium-renew-id").val("9780594080886")}),$("#radio_2").on("click",function(){$("#payment2").removeClass("d-none"),$("#payment1").addClass("d-none"),$("#payment1 .instant-purchase-saved-cvv").removeAttr("required"),$("#saved").length>0?($("#saved-tab").click(),$(".changeSavedPayment-detail #csv_1").attr("tabindex",c+6),1==$(".changeSavedPayment-detail .instant-purchase-saved-cvv").length&&$(".terms-checkbox #tnc").attr("tabindex",c+7)):($("#saved-tab").addClass("d-none"),$("#new-tab").click(),$("#payment2 .pipe").addClass("d-none"))}),$("#radio_1").on("click",function(){$("#defaultSaved").length>0&&($("#new input:visible").removeAttr("required").val(""),$(".Payment-form-new-card-added").val("false"),$("#payment1").removeClass("d-none"),$("#payment2").addClass("d-none"),$("#ccMonth").removeAttr("required"),$("#ccYear").removeAttr("required"),b(),$(".membershipSubmitButton").attr("id","confirmSecurityCodeDisplayBtn"),$(".saved-pay.selected-pay").removeClass("selected-pay"),$("#payment1 .instant-purchase-saved-cvv").attr("required","required"),$(".instant-purchase-saved-cvv-input input.instant-purchase-saved-cvv").filter(function(){return $(this).parent().removeClass("filled").removeClass("focus"),$(this).removeClass("user-success").val("")}),taxCalculation($("#savedCardsParentsDefault2"),"premium"))}),$("#new-tab").on("click",function(){$("#new").removeClass("d-none"),$(".membershipSubmitButtonTo").removeClass("d-none"),$("#saved").addClass("d-none"),$(this).addClass("active"),$("#newCardNumber").attr("tabindex",c),$("#nameOnCard").attr("tabindex",c+1),$("#ccMonth-replacement").attr("tabindex",c+2),$("#ccYear-replacement").attr("tabindex",c+3),$(".instant-bill-address").attr("tabindex",c+5),$(".membershipSubmitButtonTo").attr("tabindex",c+6),$(".terms-checkbox #tnc").attr("tabindex",c+7),$("#saved-tab").removeClass("active"),$("#savedAddress").removeClass("d-none"),$(".Payment-form-new-card-added").val("true"),$(".hidden-instant-modal-saved-card").removeAttr("value"),$(".membershipSubmitButton").attr("id","addNewPaymentDetails"),$("#new input:visible").attr("required","required").val(""),$("#addAddress").hasClass("d-none")&&b(),$(".instant-purchase-saved-cvv-input input.instant-purchase-saved-cvv").filter(function(){return $(this).parent().removeClass("filled").removeClass("focus"),$(this).removeClass("user-success").val("")}),$("#ccMonth").attr("required","required"),$("#ccYear").attr("required","required"),$("#companyName").removeAttr("required"),$("#aptSuite").removeAttr("required"),$(".saved-pay.selected-pay").removeClass("selected-pay")}),$("#saved-tab").on("click",function(){$(".Payment-form-new-card-added").val("false"),$("#saved").removeClass("d-none"),$("#new").addClass("d-none"),$(".membershipSubmitButtonTo").addClass("d-none"),$(this).addClass("active"),$("#new-tab").removeClass("active"),$("#savedAddress").addClass("d-none"),$(".membershipSubmitButton").attr("id","confirmSecurityCodeDisplayBtn"),$("#nameOnCard").removeAttr("required").removeClass("user-error").val(""),$("#newCardNumber").removeAttr("required").removeClass("user-error").val(""),$("#ccMonth").removeAttr("required").removeClass("user-error").val(""),$("#ccYear").removeAttr("required").removeClass("user-error").val(""),b(),$("#addressType").val("exsistAddress"),$(".newPayment-detail #csv_new").removeAttr("required").removeClass("user-error").val(""),$(".newPayment-detail #csv_new").parent().removeClass("invalid").removeClass("focus"),$("#nameOnCard").parent().removeClass("invalid").removeClass("focus"),$("#newCardNumber").parent().removeClass("invalid").removeClass("focus"),$("#ccMonth").parent().find(".selectBox-container").removeClass("invalid"),$("#ccYear").parent().find(".selectBox-container").removeClass("invalid")}),$(".instant-bill-address").on("click",function(){"true"==$(".Payment-form-default-address").val()&&($("#savedAddress").toggleClass("d-none"),$("#addAddress").toggleClass("d-none"),$(".membershipSubmitButton").attr("id","addNewPaymentDetails"),$("#savedAddress").hasClass("d-none")?($(".hidden-instant-modal-saved-address").removeAttr("value"),$("#addAddress #country-replacement").attr("tabindex",c+6),$("#addAddress #firstName").attr("tabindex",c+7),$("#addAddress #lastName").attr("tabindex",c+8),$("#addAddress #streetAddress").attr("tabindex",c+9),$("#addAddress #aptSuite").attr("tabindex",c+10),$("#addAddress #city").attr("tabindex",c+11),$("#addAddress #state-replacement").attr("tabindex",c+12),$("#addAddress #zipCode").attr("tabindex",c+13),$("#addAddress #phoneNumber").attr("tabindex",c+14),$("#addAddress #companyName").attr("tabindex",c+15),$(".membershipSubmitButtonTo").attr("tabindex",c+16),$(".terms-checkbox #tnc").attr("tabindex",c+17),$("#addressType").val("addAddress"),$("a.instant-bill-address").text("Select a Saved Billing Address"),$("#savedAddress .saved-pay").removeClass("selected-pay")):($("#addressType").val("exsistAddress"),b(),$("a.instant-bill-address").text("Enter a New Billing Address")))}),$(".saved-pay").on("click",function(a){a.preventDefault(),$(".saved-pay").removeClass("selected-pay"),$(this).find("input.d-none").prop("checked",!0),$(this).find(".radio input.d-none").is(":checked")?$(this).addClass("selected-pay"):$(".saved-pay").removeClass("selected-pay"),taxCalculation($(this).find(".radio"),"premium")}),$("#tnc").on("click",function(){if($("#tnc").prop("checked")){var a=$("#membershipEANPurchasedId").val();"false"!=a||$("#newCardNumber")&&$("#newCardNumber").length>0&&$("#newCardNumber")[0].required||($(".membershipSubmitButton").removeAttr("disabled"),$(".membershipSubmitButton").removeClass("disabledbutton"),$(".MainsubmitBtn").attr("type","submit")),$(".terms-checkbox .checkbox__box").css("border-color","#21282d")}else $(".membershipSubmitButton").attr("disabled","disabled"),$(".membershipSubmitButton").addClass("disabledbutton"),$(".MainsubmitBtn").attr("type","text")}),$(".membershipSubmitButton").on("click",function(){$("#payment1").hasClass("d-none")||"true"!=$(".Payment-form-default-card").val()||$("#payment1 .instant-purchase-saved-cvv").focus(),setTimeout(function(){$("#editMembershipErrorBlock").hasClass("d-none")||document.querySelector("#editMembershipErrorBlock").scrollIntoView()},1e3)}),$(".check-instant-collapse").on("click",function(){$(".check-instant-total").toggleClass("d-none"),$(".member-price").toggleClass("check-inst-final-price"),$(".inst-order-sum").toggleClass("pt-4")}),$(document).on("click",".membershipSubmitButtonTo",function(){$(".MainsubmitBtn").removeAttr("id"),$(".MainsubmitBtn").removeAttr("value"),$(".saveNewPaymentAddress").attr("id","saveNewPayment"),$(".saveNewPaymentAddress").attr("type","submit"),$(".saveNewPaymentAddress").attr("value","submit"),$(".membershipSubmitButton").removeAttr("id"),$(".instant-purchase-btn #handlerField").attr("value","/atg/userprofiling/ProfileFormHandler.createNewCreditCardAndAddress"),$(".membershipSubmitButtonDummy").attr("id","addNewPaymentDetails"),$("#paymentFormContainerId").removeAttr("id"),$(".membershipSubmitButtonDummy").click()}),$("#addPremiumMembershipProgramme").on("amplifiFormSuccess",function(b,c){var d=$(".programeTypeConfirm").val(),e=$("#upgradeMoreThanThirty").val(),f=$("#expirationDateUpgrade").val(),g=$(".memberExpiredLegacy").val();c&&c.newCreditCardSaved?(sessionStorage.setItem("new-creditCard-saved","true"),location.reload()):c&&c.membershipOrderTotal&&c.membershipOrderNumber?(new BN.Modal.Account.ConfirmMembershipInstantPurchase(null,{target:this},{useCache:!1,tplParams:{confirmationType:d,confirmationNumber:c.membershipOrderNumber,confirmationTotal:parseFloat(c.membershipOrderTotal).toFixed(2),legacygreater:e,expiryDate:f,expiredLegacy:g}}),a.Close()):($("#editMembershipErrorBlock").removeAttr("style"),$("#newCardNumber").addClasss,$("#editMembershipErrorBlock").html('<em class="emphasis emphasis--alert">Sorry! An error occurred while processing your request. Please reload and try again later!</em>'))}).on("amplifiFormError",function(a,b,c,d,e){var f=e.items,g=$(this),h=g.find(".membershipSubmitButtonTo"),i=g.attr("id"),j=b.adiRecomendationCode;f.length>0&&("2FAREQUIRED"==f[0].toUpperCase()?new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:g,formBtn:h,formId:i,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}}):j&&"DENY"===j.toUpperCase()&&(h.prop("disabled",!0),h.addClass("adi-deny-button")))}),$(".instant_purchase_modal_heading").hasClass("premium_member_instant_modal")&&$(".mbs-modal-promo h2").html("Renew Now and Never Miss a Day of Savings"),$(window).width()<=480&&$(".os-show-details-link").text("(Show Details)"),$("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.AddPhoneNumber=BN.Modal.Account.AddPhoneNumber||Extend(function(){var a=function(){};return a.prototype={tplName:"m-add-phone-number",initView:function(){{var a=this;$(this.modal),a.data.target}if(this.initGenericView(),this.initForm(!1),"undefined"==typeof grecaptcha){captchaV3ApiKey=globalCaptchaV3ApiKey;var b="https://www.google.com/recaptcha/api.js?render="+captchaV3ApiKey,c=document.createElement("script");c.async=!0,c.type="text/javascript",c.src=b,$("head").append(c)}loadADIScript(),this.on("display",function(){{var b=$("#addPhoneNumberForm"),c=$("#addPhoneNumberForm").attr("id");$("#addPhoneNumberForm").find("#savePhoneNumber")}$("#phoneNumber, #confirmPhoneNumber").on("focusout blur",function(){$(".mobile-number-input").addClass("focus"),$(".mobile-number-input").addClass("filled")}),$("#phoneNumber, #confirmPhoneNumber").keydown(function(a){var b=a.charCode||a.keyCode||0;return $text=$(this),8!==b&&9!==b&&(3===$(this).val().length&&$(this).val($text.val()+"-"),7===$(this).val().length&&$(this).val($text.val()+"-")),8==b||9==b||46==b||b>=48&&57>=b||b>=96&&105>=b}),$(".btn-cancel, .icon-close-modal").on("click",function(){a.Close(),window.location.href="/checkout/checkout.jsp"}),intiateRecaptchaVthree("#addPhoneNumberForm"),$("#addPhoneNumberForm").on("amplifiFormSuccess",function(){var a=!1;$("#"+c).find("#frmTokenVerified").length>0&&(a=!0),a||location.reload()}).on("amplifiFormError",function(d,e){var f=e.adiRecomendationCode;if($this=$(this),"2FAREQUIRED"==e.response.items[0].toUpperCase())$("#phoneErrors").hide(),a.hide(),h&&h.length>0||(h=$("#addPhoneNumberForm").find("#savePhoneNumber")),new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formBtn:h,formName:b,formId:c,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}});else{var g=$("[data-modal-name='two-step-verification'] .icon-close-modal");if(g&&g.length>0&&(g[0].click(),a.show()),f&&"DENY"===f.toUpperCase()){var h=$this.find("#savePhoneNumber");h&&h.length>0&&h.prop("disabled",!0)}}})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Login=BN.Modal.Account.Login||Extend(function(){var a=function(){};return a.prototype={tplName:"login",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";BN.ModalTarget=a.target,BN.loginRedirectTo=b.length&&""!=c&&"#"!=c&&c.indexOf("/modal")<0?c:"",this.data.redirectSuccessUrl=BN.loginRedirectTo,this.initGenericView(),this.initFrameForm(),a.onclose&&this.closeEvents.all.push(a.onclose)}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginNew=BN.Modal.Account.LoginNew||Extend(function(){var a=function(){};return a.prototype={tplName:"login",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login",isNew:"true"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";BN.ModalTarget=a.target;var d=$("#skuId").val();a.target.classList&&a.target.classList.length>0&&a.target.classList.contains("signin-membership-modal")?sessionStorage.setItem("login-membership-check","premium"):a.target&&a.target.id&&a.target.id==="creditPurchaseAB_"+d?sessionStorage.setItem("login-purpose-check","audiobook-order"):("premium"===sessionStorage.getItem("login-membership-check")&&sessionStorage.removeItem("login-membership-check"),"audiobook-order"===sessionStorage.getItem("login-purpose-check")&&sessionStorage.removeItem("login-purpose-check")),BN.loginRedirectTo=b.length&&""!=c&&"#"!=c&&c.indexOf("/modal")<0?c:"",this.data.redirectSuccessUrl=BN.loginRedirectTo,this.initGenericView(),this.initFrameForm(),a.onclose&&this.closeEvents.all.push(a.onclose)}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginMembership=BN.Modal.Account.LoginMembership||Extend(function(){var a=function(){};return a.prototype={tplName:"login-membership",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login-membership"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";b.length&&""!=c&&"#"!=c&&c.indexOf("/modal")<0?(BN.loginRedirectTo=a.redirectSuccessUrl=c,a.redirect=!0):(BN.loginRedirectTo=a.redirectSuccessUrl="",a.redirect=!1),this.initGenericView(),this.initFrameForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginCheckout=BN.Modal.Account.LoginCheckout||Extend(function(){var a=function(){};return a.prototype={tplName:"login",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login",isCheckout:"true"},useCache:!1},initView:function(){{var a=this.data,b=$(a.target);b.attr("href")||""}this.initGenericView(),this.initFrameForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.LoginCheckoutMembership=BN.Modal.Account.LoginCheckoutMembership||Extend(function(){var a=function(){};return a.prototype={tplName:"login-membership",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"login-membership",isCheckout:"true"},useCache:!1},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||$(a).attr("data-href")||"";""!=c&&"#"!=c&&c.indexOf("/modal")<0?(BN.loginRedirectTo=a.redirectSuccessUrl=c,a.redirect=!0):(BN.loginRedirectTo=a.redirectSuccessUrl="",a.redirect=!1),this.initGenericView(),this.initFrameForm(),$(this.modal).find(".error-msg").show()
}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPassword=BN.Modal.Account.ForgotPassword||Extend(function(){var a=function(){};return a.prototype={tplName:"reset-password",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPasswordNew=BN.Modal.Account.ForgotPasswordNew||Extend(function(){var a=function(){};return a.prototype={tplName:"reset-password",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"reset-password",isNew:"true"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ChangePassword=BN.Modal.Account.ChangePassword||Extend(function(){var a=function(){};return a.prototype={tplName:"change-password",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ChangePasswordNew=BN.Modal.Account.ChangePasswordNew||Extend(function(){var a=function(){};return a.prototype={tplName:"change-password",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"change-password",isNew:"true"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPasswordEmail=BN.Modal.Account.ForgotPasswordEmail||Extend(function(){var a=function(){};return a.prototype={tplName:"reset-password-email",initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ForgotPasswordEmailNew=BN.Modal.Account.ForgotPasswordEmailNew||Extend(function(){var a=function(){};return a.prototype={tplName:"reset-password-email",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"reset-password-email",isNew:"true"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.ChooseSignInPath=BN.Modal.Account.ChooseSignInPath||Extend(function(){var a=function(){};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/account/"},tplName:"m-choose-signin-path",initView:function(){this.initGenericView(),this.initForm();var a=this.data,b=this,c=$(this.modal),d=(c.find("form"),a.tplParams.conflictingProvider.split(",")),e=a.tplParams.autoGenerated;c.find("form#conflictingAccountforgotPasswordForm input#email").val(a.tplParams.login);var f="We found your email in our system. Please provide your site password to link to your existing account.",g="Please authenticate your existing social network to link your accounts. You'll only need to do this once.",h="Your email:",i="Link using your B&N credentials. Your email:",j=f;linkingText2=h;for(var k=0;k<d.length;k++)"facebook"==d[k].trim()&&(c.find("form#conflictingAccountFormFacebook").removeClass("hidden"),j=g,linkingText2=i),"googleplus"==d[k].trim()&&(c.find("form#conflictingAccountFormGoogleplus").removeClass("hidden"),j=g,linkingText2=i);c.find(".modal__header p").text(j),c.find(".user-email p").text(linkingText2+" "+a.tplParams.login),c.find("form#conflictingAccountFormFacebook button").on("click",function(c){c.preventDefault(),b.Close();var d=a.tplParams.previousUID,e={provider:"facebook",callback:linkAccountsWithExisting,previousUID:d};gigya.socialize.login(e)}),c.find("form#conflictingAccountFormGoogleplus button").on("click",function(c){c.preventDefault(),b.Close();var d=a.tplParams.previousUID,e={provider:"googleplus",callback:linkAccountsWithExisting,previousUID:d};gigya.socialize.login(e)}),c.find("form#conflictingAccountFormBN #forgotPasswordConflictingAccount").on("click",function(){e?new BN.Modal.Account.SocialLoginResetPassword(null,null,{target:this,tplParams:{email:a.tplParams.login,provider:""}},null):(BN.uXHR.Form.apply(c.find("form#conflictingAccountforgotPasswordForm")),c.find("form#conflictingAccountforgotPasswordForm").submit())}),c.find("form#conflictingAccountforgotPasswordForm").on("amplifiFormSuccess",function(a,b){{var c=$("#parentUrl").val(),d=$("#tplName").val();$("body")}dataObj={type:"",redirect:"",modal:d,height:"",uxhr:{}},dataObj.uxhr=b,dataObj.type="frameResetPwFormSuccess","undefined"!=typeof b.redirect&&""!=b.redirect&&(dataObj.redirect=b.redirect),"undefined"!=typeof b.email&&""!=b.email&&(dataObj.email=b.email),$.postMessage(dataObj,c,window.parent)}),c.find("form#conflictingAccountFormBN").on("submit",function(d){d.preventDefault(),showSpinner(),$.ajax({url:"/gigya/socialLoginHandler.jsp",data:{login:a.tplParams.login,password:c.find("form#conflictingAccountFormBN").find("input#password").val(),loginMode:"link",previousUID:a.tplParams.previousUID,UID:a.tplParams.UID,UIDTimestamp:a.tplParams.UIDTimestamp,UIDSignature:a.tplParams.UIDSignature},cache:!1,type:"post"}).done(function(d){var e=0,f=0,g=d.code;switch(hideSpinner(),g){case"BN002":e=1,b.Close();break;case"BN005":e=1,b.Close();break;case"BN006":f=1;break;case"BN012":f=1}if(1==e){var h={success:!0,data:{uid:a.tplParams.login,confirmEmail:"false",isWelcomeGiftUsed:""}},i={type:"frameFormSuccess",redirect:"",modal:"login",height:"",uxhr:h,formId:"loginForm"},j=$("#parentUrl").val();$.postMessage(i,j,window.parent)}1==f&&(BN.Validate.ClearErrors(c.find("form#conflictingAccountFormBN")),errorStatement="Your email and password combination does not match our records. Please try again.",BN.Validate.DisplayErrors(c.find("form#conflictingAccountFormBN"),errorStatement))})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.SocialLoginResetPassword=BN.Modal.Account.SocialLoginResetPassword||Extend(function(){var a=function(){};return a.prototype={tplName:"reset-password",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"reset-password",isNew:"true",isRemovedLastLogin:"true"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.SocialLoginMissingData=BN.Modal.Account.SocialLoginMissingData||Extend(function(){var a=function(){};return a.prototype={tplName:"sociallogin-missingparam",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"sociallogin-missingparam",isNew:"true",provider:"facebook"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account.SocialLoginConflictingAccount=BN.Modal.Account.SocialLoginConflictingAccount||Extend(function(){var a=function(){};return a.prototype={tplName:"conflictingaccount",defaultOptions:{tplParams:{parentUrl:encodeURIComponent(location.href),tplName:"conflictingaccount"},useCache:!1},initView:function(){}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.MemberShippingDetails=BN.Modal.Account.MemberShippingDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.MemberShippingDetails")};return a.prototype={tplName:"m-member-shipping-details",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.OptionalPickup=BN.Modal.Account.OptionalPickup||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.OptionalPickup")};return a.prototype={tplName:"optional-pickup-modal",initView:function(){if(this.initGenericView(),this.initForm(),this.on("display",function(){valiadteFocusInProxyForm("#ProxyDetailsForm"),"selfPickup"==$("input[type=radio][name=proxyPickup]:checked").attr("id")&&($("#proxyName").removeAttr("required"),$("#proxyEmail").removeAttr("required")),$("input[type=radio][name=proxyPickup]").on("change",function(){if($("#someoneElsePickup").is(":checked")){$("#proxyName").attr("required","true"),$("#proxyEmail").attr("required","true"),$(".someone-else-pickup").removeClass("hidden"),$(".someone-else-pickup").attr("aria-hidden","false");var a=Number($("#someoneElsePickup").attr("tabindex"));$("#someoneElsePickup").parents(".row").next().find(":visible:tabbable").each(function(){$(this).attr("tabindex",++a)});var b=Number($("#someoneElsePickup").parents(".row").next().find(":visible:tabbable:last").attr("tabindex"));$(".modal__footer").find(":visible:tabbable").each(function(){$(this).attr("tabindex",++b)}),$(".icon-close-modal").on("keydown",function(a){a.shiftKey&&9==a.keyCode&&(a.preventDefault(),a.stopPropagation(),$(".modal__footer").find(":tabbable:last").focus())})}else{$("#proxyName").removeAttr("required"),$("#proxyEmail").removeAttr("required"),$(".someone-else-pickup").addClass("hidden"),$(".someone-else-pickup").attr("aria-hidden","true");var a=Number($("#someoneElsePickup").attr("tabindex"));$("#someoneElsePickup").parents(".row").next().find("[tabindex]").removeAttr("tabindex"),$(".modal__footer").find(":visible:tabbable").each(function(){$(this).attr("tabindex",++a)})}})}),"undefined"!=typeof s_setP){var a=$(this.modal).attr("data-modal-name"),b=$("body").hasClass("checkout-review")?"Checkout Review Guest":"Checkout Review Member",c=getAnalyticsEventCount();s_setP("digitalData.event["+c+"].eventInfo.eventName","Page View"),s_setP("digitalData.event["+c+"].eventInfo.eventAction","pageView"),s_setP("digitalData.event["+c+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+c+"].category.primaryCategory","Modals"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.previousPageName",b),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.pageName","buy online pickup store:pickup order contact info"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.pageType","buy online pickup in store"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.destinationURL",window.location.href+"/"+a),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.referringURL",window.location.href),_satellite.track("onPageView")}}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.PurchaseAudiobookSubscription=BN.Modal.Account.PurchaseAudiobookSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.PurchaseAudiobookSubscription")};return a.prototype={tplName:"m-purchase-audiobook-subscription",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){if(purchaseSubscriptionModal(),loadADIScript("paymentMethod"),$(".hero-legal").addClass("d-none"),$("#howitworks-acc").on("click",function(){"true"===$("#howitworks-acc .btn-link").attr("aria-expanded")?($("#howitworks-acc .btn-link").attr("aria-expanded",!1),$(".hero-legal").addClass("d-none")):($("#howitworks-acc .btn-link").attr("aria-expanded",!0),$(".hero-legal").removeClass("d-none")),$("#howitworks-acc #collapseOne").toggle()}),$("#keepDefaultBilling").click(function(){$(".changepayment-container form:visible").addClass("to-be-visible"),$(".changepayment-container").addClass("d-none"),$(".changepayment-container form").addClass("d-none"),$(".ab-default-payment").removeClass("d-none"),$(".ab-default-payment").closest("form").removeClass("d-none"),$(this).parents().find(".use-saved-cc").removeClass("d-none"),$(this).parents().find(".add-new-cc").addClass("d-none"),$("#audiobookForm").attr("data-qas")&&$("#audiobookForm").removeAttr("data-qas"),$(".defaultPaymentCheckbox").addClass("d-none"),$("#audiobookForm--new").find("input, select").removeAttr("required")}),$("#changeDefaultBilling").click(function(){if($(".ab-default-payment").addClass("d-none"),$(".ab-default-payment").closest("form").addClass("d-none"),$(".changepayment-container").removeClass("d-none"),$(".defaultPaymentCheckbox").removeClass("d-none"),$(".changepayment-container form.to-be-visible").removeClass("to-be-visible").removeClass("d-none"),"true"==$("#savedCreditCardPresent").val()?($("#audiobookForm--saved").removeClass("d-none"),$("#audiobookForm--new").addClass("d-none")):$("#audiobookForm--saved").addClass("d-none"),0==$(this).parents().find("#new").hasClass("d-none"))if($(this).parents().find(".add-new-cc").removeClass("d-none").addClass("d-flex"),$("#audiobookForm--new").removeClass("d-none"),$("#audiobookForm--new").is(":visible"))for(var a,b=$("#audiobookForm--new").find("input, select"),c=0;c<b.length;c++)a=$(b[c]),"aptSuite"!=a.attr("id")&&"companyName"!=a.attr("id")&&"fromPage"!=a.attr("id")&&"fromModal"!=a.attr("id")&&a.attr("required","required");else $("#audiobookForm--new").find("input, select").removeAttr("required");$("#audiobookForm--saved").is(":visible")&&(0==$("[name=savedCards]:checked").length&&$("[name=savedCards]:first").click(),$("#audiobookForm--new").addClass("d-none"))}),$("#audiobookForm--new").is(":visible")){"true"==$("#fromModal").val()&&($("#newCardNumber").siblings("label").attr("for","ccNumber"),$("#newCardNumber").attr("id","ccNumber"));for(var b,c=$("#audiobookForm--new").find("input, select"),d=0;d<c.length;d++)b=$(c[d]),"aptSuite"!=b.attr("id")&&"companyName"!=b.attr("id")&&"fromPage"!=b.attr("id")&&"fromModal"!=b.attr("id")&&b.attr("required","required");$(".defaultPaymentCheckbox").removeClass("d-none")}else $("#audiobookForm--new").find("input, select").removeAttr("required"),$(".defaultPaymentCheckbox").addClass("d-none");$("[id^=savedCardsParent]").on("click",function(){$("[id^=savedCardsParent]").removeClass("card-focus-state"),$("#audiobookForm--saved input[id^=csv]").removeAttr("required"),$(".saved-cards-cvv").hasClass("invalid")&&$(".saved-cards-cvv").removeClass("invalid");var a=$(this).find("input[name=savedCards][type=radio]");a.prop("checked",!0);var b=a.val();$(this).addClass("card-focus-state"),$(this).find("input[id^=csv]").attr("required","required"),$("#audiobookForm--saved input[id^=csv]").off("change"),$(this).find("input[id^=csv]").on("change",function(){$("#audiobookForm--saved #submitCSV").val($(this).val())}),$("#audiobookForm--saved #submitCSV").val($(this).find("input[id^=csv]").val()),$("#audiobookForm--saved #submitCCType").val($(this).find("input[id^=savedCardType]").val()),$("#audiobookForm--saved #submitDefaultCC").val(b),$("#audiobookForm--new").find("input, select").removeAttr("required")}),$("#audiobookForm--saved").is(":visible")&&(0==$("[name=savedCards]:checked").length&&$("[name=savedCards]:first").click(),$("#audiobookForm--new").addClass("d-none")),$("input[name=creditType][type=radio]").on("change",function(){var a=$(this).val(),b=$(this).parents().find("[id^=selectedSubscriptionPlan]");b.each(function(){$(this).val(a)}),$("form[id^=audiobookForm]").each(function(){if($(this).find("input[name=creditType]").val($("input[name=creditType]:checked").val()),"1 Credit"==$(this).find("input[name=creditType]").val()){var a=$(this).parents().find("#oneCreditPrice").val();$(this).parents().find("#price").text("$"+a)}else{var b=$(this).parents().find("#twoCreditPrice").val();$(this).parents().find("#price").text("$"+b)}})}),$("form[id^=audiobookForm]:visible").off("amplifiFormBeforeSubmit").on("amplifiFormBeforeSubmit",function(){var a=document.getElementById("billingCheckbox"),b=document.getElementById("tnc"),c=document.getElementById("defaultPaymentCheckbox");if($(".defaultPaymentCheckbox").is(":visible")){if(0==a.checked||0==b.checked||0==c.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}else if(0==a.checked||0==b.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}),$(".audiobook-tab a").click(function(a){a.preventDefault(),$(this).parent().addClass("active"),$(this).parent().siblings().removeClass("active");var b=$(this).attr("href");if($(".tabcontent").not(b).addClass("d-none"),$(b).removeClass("d-none"),"#new"==b){$("#audiobookForm--saved").addClass("d-none"),$("#audiobookForm--new").removeClass("d-none"),$(this).parents().find(".billing-msg").empty().append("The payment method you use for your audiobooks subscription will become the default payment method for your barnesandnoble.com account."),$(this).parents().find(".defaultPaymentCheckbox").removeClass("d-none");for(var c,d=$("#audiobookForm--new").find("input, select"),e=0;e<d.length;e++)c=$(d[e]),"aptSuite"!=c.attr("id")&&"companyName"!=c.attr("id")&&c.attr("required","required")}else $("#audiobookForm--new").addClass("d-none"),$("#audiobookForm--new").find("input, select").removeAttr("required"),$("#state").removeAttr("required"),$("#audiobookForm--new").find("input, select").removeAttr("required"),$("#audiobookForm--saved").removeClass("d-none"),$(this).parents().find(".billing-msg").empty().append("Your subscription will be billed to the default payment method for your barnesandnoble.com account."),$(this).parents().find(".defaultPaymentCheckbox").removeClass("d-none"),$(this).parents().find(".use-saved-cc").removeClass("d-none").addClass("d-flex")}),$("#purchasePlanBtn").on("click",function(a){showSpinner(".checkbox-section");var b=$("#billingCheckbox"),c=$("#tnc"),d=$("#defaultPaymentCheckbox");if(b.length>0&&!b.is(":checked")||c.length>0&&!c.is(":checked")||d.length>0&&d.is(":visible")&&!d.is(":checked"))a.preventDefault(),$("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1);else if($(".ab-default-payment").is(":visible")){if(""==$("form[id^=audiobookForm]:visible").find("#csv").val())return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),!1;$("form[id^=audiobookForm]:visible").find("input[type=submit]").click(),$("#audiobookError").is(":visible")&&(hideSpinner(".checkbox-section"),$(this).prop("disabled",!1))}else if($(".changepayment-container").is(":visible")){if(""==$("form[id^=audiobookForm]:visible").find("[id^=savedCardsParent].card-focus-state input[id^=csv]").val())return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),!1;if($("#audiobookForm--new").is(":visible")){"true"==$("#fromModal").val()&&($("#newCardNumber").siblings("label").attr("for","ccNumber"),$("#newCardNumber").attr("id","ccNumber"));for(var e,f=$("#audiobookForm--new").find("input, select"),g=0;g<f.length;g++)if(e=$(f[g]),"aptSuite"!=e.attr("id")&&"country"!=e.attr("id")&&"companyName"!=e.attr("id")&&"fromPage"!=e.attr("id")&&"fromModal"!=e.attr("id")&&("newCardNumber"==e.attr("id")||"nameOnCard"==e.attr("id")||"ccMonth"==e.attr("id")||"ccYear"==e.attr("id")||"csv"==e.attr("id")||"firstName"==e.attr("id")||"lastName"==e.attr("id")||"streetAddress"==e.attr("id")||"city"==e.attr("id")||"state"==e.attr("id")||"zipCode"==e.attr("id")||"phoneNumber"==e.attr("id"))&&(e.attr("required","required"),!e.hasClass("user-success")))return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),!1}$("form[id^=audiobookForm]:visible").find("button[id=addNewPaymentDetails]").length>0?($("form[id^=audiobookForm]:visible").find("button[id=addNewPaymentDetails]").click(),setTimeout(function(){""!=$("#audiobookError").text(),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),"Sorry! We were unable to process your credit card. Please enter a valid card number and try again."===$("#audiobookError").text()&&$("form[id^=audiobookForm]:visible").find("#ccNumber").parent().addClass("invalid").removeClass("valid")},500)):($("form[id^=audiobookForm]:visible").find("input[type=submit]").click(),$("#audiobookError").is(":visible")&&$(this).prop("disabled",!1))}}),$("form[id^=audiobookForm]:visible").off("amplifiFormBeforeSubmit").on("amplifiFormBeforeSubmit",function(){var a=document.getElementById("billingCheckbox"),b=document.getElementById("tnc"),c=document.getElementById("defaultPaymentCheckbox");if($(".defaultPaymentCheckbox").is(":visible")){if(0==a.checked||0==b.checked||0==c.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}else if(0==a.checked||0==b.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}),$("form[id^=audiobookForm]").on("amplifiFormSuccess",function(b,c){var d=c.subscriptionOperationType,e=c.audiobookSubscriptionOrderNumber,f=c.audiobookSubscriptionOrderTotal,g=c.newPlan,h=c.newPlanPrice,i=c.nextRenewDate,j=c.previousPlan,k=c.previousPlanPrice,l=c.subscribeDate,m=c.totalAvailableCredits,n="notMyAccount",o=[];o.basePrice=f,o.transactionID=e,o.audiobookID="",o.audiobookPlanCredits=m,o.audiobookPlanSchedule=g,o.audiobookPlanCost=f,o.audiobookPlanStartDate=l,"purchaseSubscriptionPlan"==c.subscriptionOperationType&&purchaseSubscriptionPlanAnalytics(o),"purchaseSubscriptionPlan"==c.subscriptionOperationType?(a.Close(),hideSpinner(".checkbox-section"),new BN.Modal.Account.SubscriptionConfirmation(null,{target:this},{useCache:!1,tplParams:{subscriptionOperationType:d,audiobookSubscriptionOrderNumber:e,audiobookSubscriptionOrderTotal:f,newPlan:g,newPlanPrice:h,nextRenewDate:i,previousPlan:j,previousPlanPrice:k,fromPage:n}})):window.location.href="/account/audiobook/manage-audiobook-subscription.jsp"}).on("amplifiFormError",function(a,b){hideSpinner(".checkbox-section"),$("#purchasePlanBtn").is(":visible")&&$("form[id^=audiobookForm]:visible").parents().find("#purchasePlanBtn").prop("disabled",!1);var c=$(this),d=c.find("input[type='submit']"),e=c.attr("id"),f=b.adiRecomendationCode;"2FAREQUIRED"==b.response.items[0].toUpperCase()?new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:c,formBtn:d,formId:e,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}}):f&&"DENY"===f.toUpperCase()&&($("form[id^=audiobookForm]:visible").parents().find("#purchasePlanBtn").prop("disabled",!0),$("form[id^=audiobookForm]:visible").parents().find("#purchasePlanBtn").addClass("adi-deny-button"))})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.PurchaseNotCompleted=BN.Modal.Account.PurchaseNotCompleted||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.PurchaseNotCompleted")};return a.prototype={tplName:"m-purchase-not-completed",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.subscriptionPlan,c=a.userOptions.tplParams.totalAvailableCredits,d=a.userOptions.tplParams.newSubscriptionPlan,e=a.userOptions.tplParams.newSubscriptionPrice,f=a.userOptions.tplParams.currentDate,g=a.userOptions.tplParams.nextBillDate;this.on("display",function(){analyticsPurchaseNotComplete();var h=$("#displayTwoCreditSubscription").val();"1 Credit"==b?($("#creditsYouGet").text("1 credit"),h&&($("#upgradePlanText").removeClass("d-none"),$(".upgrade-confirm-btn").removeClass("d-none"),$(".cancelPurchase").removeClass("d-none"),$("#confirm").addClass("d-none"))):$("#creditsYouGet").text("2 credits"),$("#creditDate").text(g),$("#creditsAvl").text(c),$(".cancelPurchase, #confirm").on("click",function(){a.Close()}),$("#upgradePlanBtn").on("click",function(){a.Close();var c=b,h=d,i=e,j=f,k=g;new BN.Modal.Account.ConfirmPlanChange(null,{target:this},{useCache:!1,tplParams:{currentSubscriptionPlan:c,newSubscriptionPlan:h,newSubscriptionPrice:i,currentDate:j,nextBillDate:k}})})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ReactivateAudiobookSubscription=BN.Modal.Account.ReactivateAudiobookSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ReactivateAudiobookSubscription")};return a.prototype={tplName:"m-reactivate-audiobook-subscription",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){if(audiobookReactivateSubscriptionModalAnalytics(),taxCalculation($("#csv").parents(".payment-element"),"audiobook"),$("fieldset[id^=savedCardsParent]").on("click",function(){taxCalculation($(this),"audiobook")}),$(document).on("click",".benefit-box-subscription-button-modal",function(){audiobookBenifitClick()}),loadADIScript("paymentMethod"),$("#keepDefaultBilling").click(function(){taxCalculation($("#csv").parents(".payment-element"),"audiobook"),$("[id^=savedCardsParent]").removeClass("card-focus-state"),$(".changepayment-container form:visible").addClass("to-be-visible"),$(".changepayment-container").addClass("d-none"),$(".changepayment-container form").addClass("d-none"),$(".ab-default-payment").removeClass("d-none"),$(".ab-default-payment").closest("form").removeClass("d-none"),$(this).parents().find(".use-saved-cc").removeClass("d-none"),$(this).parents().find(".add-new-cc").addClass("d-none"),$(this).parents().find("#addCCHandler").remove(),$("#audiobookForm").attr("data-qas")&&$("#audiobookForm").removeAttr("data-qas"),$(".defaultPaymentCheckbox").addClass("d-none"),$("#audiobookForm--new").find("input, select").removeAttr("required"),$("#reactivatePlanBtn").removeAttr("disabled")}),$("#changeDefaultBilling").click(function(){if($(".ab-default-payment").addClass("d-none"),$(".ab-default-payment").closest("form").addClass("d-none"),$(".changepayment-container").removeClass("d-none"),$(".defaultPaymentCheckbox").removeClass("d-none"),$(".changepayment-container form.to-be-visible").removeClass("to-be-visible").removeClass("d-none"),"true"==$("#savedCreditCardPresent").val()?($("#audiobookForm--saved").removeClass("d-none"),$("#audiobookForm--new").addClass("d-none")):$("#audiobookForm--saved").addClass("d-none"),0==$(this).parents().find("#new").hasClass("d-none"))if($(this).parents().find(".add-new-cc").removeClass("d-none").addClass("d-flex"),$(this).parents().find("#handlerField").remove(),$("#audiobookForm--new").is(":visible")){"true"==$("#fromModal").val()&&($("#newCardNumber").siblings("label").attr("for","ccNumber"),$("#newCardNumber").attr("id","ccNumber"));for(var a,b=$("#audiobookForm--new").find("input, select"),c=0;c<b.length;c++)a=$(b[c]),"aptSuite"!=a.attr("id")&&"companyName"!=a.attr("id")&&"fromPage"!=a.attr("id")&&"fromModal"!=a.attr("id")&&a.attr("required","required");$("#reactivatePlanBtn").attr("disabled",!0)}else $("#audiobookForm--new").find("input, select").removeAttr("required")}),$(".show-details-collapse").on("click",function(){$(".check-audiobook-total").toggleClass("d-none"),$(".audiobook-total-price").toggleClass("check-inst-final-price"),$(".use-saved-cc").toggleClass("mt-5")}),$("#audiobookForm--new").is(":visible")){"true"==$("#fromModal").val()&&($("#newCardNumber").siblings("label").attr("for","ccNumber"),$("#newCardNumber").attr("id","ccNumber"));for(var b,c=$("#audiobookForm--new").find("input, select"),d=0;d<c.length;d++)b=$(c[d]),"aptSuite"!=b.attr("id")&&"companyName"!=b.attr("id")&&"fromPage"!=b.attr("id")&&"fromModal"!=b.attr("id")&&b.attr("required","required");$(".defaultPaymentCheckbox").removeClass("d-none"),$("#reactivatePlanBtn").attr("disabled",!0)}else $("#audiobookForm--new").find("input, select").removeAttr("required"),$(".defaultPaymentCheckbox").addClass("d-none");$("[id^=savedCardsParent]").on("click",function(){$("[id^=savedCardsParent]").removeClass("card-focus-state"),$("#audiobookForm--saved input[id^=csv]").removeAttr("required"),$(".saved-cards-cvv").hasClass("invalid")&&$(".saved-cards-cvv").removeClass("invalid");var a=$(this).find("input[name=savedCards][type=radio]");a.prop("checked",!0);var b=a.val();$(this).addClass("card-focus-state"),$(this).find("input[id^=csv]").attr("required","required"),$("#audiobookForm--saved input[id^=csv]").off("change"),$(this).find("input[id^=csv]").on("change",function(){$("#audiobookForm--saved #submitCSV").val($(this).val())}),$("#audiobookForm--saved #submitCSV").val($(this).find("input[id^=csv]").val()),$("#audiobookForm--saved #submitCCType").val($(this).find("input[id^=savedCardType]").val()),$("#audiobookForm--saved #submitDefaultCC").val(b)}),$("input[name=creditType][type=radio]").on("change",function(){var a=$(this).val(),b=$(this).parents().find("[id^=selectedSubscriptionPlan]");b.each(function(){$(this).val(a)}),$("form[id^=audiobookForm]").each(function(){if($(this).find("input[name=creditType]").val($("input[name=creditType]:checked").val()),"1 Credit"==$(this).find("input[name=creditType]").val()){var a=$(this).parents().find("#oneCreditPrice").val();$(this).parents().find("#price").text("$"+a)}else{var b=$(this).parents().find("#twoCreditPrice").val();$(this).parents().find("#price").text("$"+b)}})}),$("form[id^=audiobookForm]:visible").off("amplifiFormBeforeSubmit").on("amplifiFormBeforeSubmit",function(){var a=document.getElementById("billingCheckbox"),b=document.getElementById("tnc"),c=document.getElementById("defaultPaymentCheckbox");if($(".defaultPaymentCheckbox").is(":visible")){if(0==a.checked||0==b.checked||0==c.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}else if(0==a.checked||0==b.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}),$(".audiobook-tab a").click(function(a){a.preventDefault(),$(this).parent().addClass("active"),$(this).parent().siblings().removeClass("active");var b=$(this).attr("href");if($(".tabcontent").not(b).addClass("d-none"),$(b).removeClass("d-none"),"#new"==b){$("#audiobookForm--saved").addClass("d-none"),$("#audiobookForm--new").removeClass("d-none"),$(this).parents().find(".billing-msg").empty().append("The payment method you use for your audiobooks subscription will become the default payment method for your barnesandnoble.com account."),$(this).parents().find(".defaultPaymentCheckbox").removeClass("d-none"),$(this).parents().find("#handlerField").remove();for(var c,d=$("#audiobookForm--new").find("input, select"),e=0;e<d.length;e++)c=$(d[e]),"aptSuite"!=c.attr("id")&&"companyName"!=c.attr("id")&&"fromPage"!=c.attr("id")&&"fromModal"!=c.attr("id")&&c.attr("required","required");$("#reactivatePlanBtn").attr("disabled",!0)}else $("#audiobookForm--new").addClass("d-none"),$("#audiobookForm--new").find("input, select").removeAttr("required"),$("#state").removeAttr("required"),$("#audiobookForm--new").find("input, select").removeAttr("required"),$("#audiobookForm--saved").removeClass("d-none"),$(this).parents().find(".billing-msg").empty().append("Your subscription will be billed to the default payment method for your barnesandnoble.com account."),$(this).parents().find(".defaultPaymentCheckbox").removeClass("d-none"),$(this).parents().find(".use-saved-cc").removeClass("d-none").addClass("d-flex"),$(this).parents().find("#addCCHandler").remove(),$("#reactivatePlanBtn").removeAttr("disabled")}),$("#audiobookForm--saved").is(":visible")&&(0==$("[name=savedCards]:checked").length&&$("[name=savedCards]:first").click(),$("#audiobookForm--new").addClass("d-none")),$("#reactivatePlanBtn").on("click",function(a){showSpinner(".checkbox-section");var b=$("#displayTwoCreditSubscription").val();"reactivatePlanBtn"==$(this).attr("id")&&"true"==b&&$("form[id^=audiobookForm]:visible").find("[id^=selectedSubscriptionPlan]").val($("input[name=creditType]:checked").val());var c=$("#billingCheckbox"),d=$("#tnc"),e=$("#defaultPaymentCheckbox");if(c.length>0&&!c.is(":checked")||d.length>0&&!d.is(":checked")||e.length>0&&e.is(":visible")&&!e.is(":checked"))a.preventDefault(),$("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1);else if($(".ab-default-payment").is(":visible")){if(""==$("form[id^=audiobookForm]:visible").find("#csv").val())return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),!1;$("form[id^=audiobookForm]:visible").find("input[type=submit]").click(),$("#audiobookError").is(":visible")&&(hideSpinner(".checkbox-section"),$(this).prop("disabled",!1))}else if($(".changepayment-container").is(":visible")){if(""==$("form[id^=audiobookForm]:visible").find("[id^=savedCardsParent].card-focus-state input[id^=csv]").val())return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),$(this).prop("disabled",!1),!1;if($("#audiobookForm--new").is(":visible")){"true"==$("#fromModal").val()&&($("#newCardNumber").siblings("label").attr("for","ccNumber"),$("#newCardNumber").attr("id","ccNumber"));
for(var f,g=$("#audiobookForm--new").find("input, select"),h=0;h<g.length;h++)if(f=$(g[h]),"aptSuite"!=f.attr("id")&&"country"!=f.attr("id")&&"companyName"!=f.attr("id")&&"fromPage"!=f.attr("id")&&"fromModal"!=f.attr("id")&&("newCardNumber"==f.attr("id")||"nameOnCard"==f.attr("id")||"ccMonth"==f.attr("id")||"ccYear"==f.attr("id")||"csv"==f.attr("id")||"firstName"==f.attr("id")||"lastName"==f.attr("id")||"streetAddress"==f.attr("id")||"city"==f.attr("id")||"state"==f.attr("id")||"zipCode"==f.attr("id")||"phoneNumber"==f.attr("id"))&&(f.attr("required","required"),!f.hasClass("user-success")))return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),!1}$("form[id^=audiobookForm]:visible").find("button[id=addNewPaymentDetails]").length>0?($("form[id^=audiobookForm]:visible").find("button[id=addNewPaymentDetails]").click(),setTimeout(function(){""!=$("#audiobookError").text(),hideSpinner(".checkbox-section"),$(this).prop("disabled",!1),"Sorry! We were unable to process your credit card. Please enter a valid card number and try again."===$("#audiobookError").text()&&$("form[id^=audiobookForm]:visible").find("#ccNumber").parent().addClass("invalid").removeClass("valid")},500)):($("form[id^=audiobookForm]:visible").find("input[type=submit]").click(),$("#audiobookError").is(":visible")&&$(this).prop("disabled",!1))}}),$("form[id^=audiobookForm]:visible").off("amplifiFormBeforeSubmit").on("amplifiFormBeforeSubmit",function(){var a=document.getElementById("billingCheckbox"),b=document.getElementById("tnc"),c=document.getElementById("defaultPaymentCheckbox");if($(".defaultPaymentCheckbox").is(":visible")){if(0==a.checked||0==b.checked||0==c.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}else if(0==a.checked||0==b.checked)return $("form[id^=audiobookForm]:visible").trigger("firstinvalid"),!1}),$("form[id^=audiobookForm]").on("amplifiFormSuccess",function(b,c){var d=c.subscriptionOperationType,e=c.audiobookSubscriptionOrderNumber,f=c.audiobookSubscriptionOrderTotal,g=c.newPlan,h=c.newPlanPrice,i=c.nextRenewDate,j=c.previousPlan,k=c.previousPlanPrice,l=c.totalAvailableCredits,m=c.subscribeDate,n="notMyAccount",o=[];o.basePrice=f,o.transactionID=e,o.audiobookID="",o.audiobookPlanCredits=l,o.audiobookPlanSchedule=g,o.audiobookPlanCost=f,o.audiobookPlanStartDate=m,"reactivateSubscriptionPlan"==c.subscriptionOperationType&&onAudiobookSubscriptionReactivateSuccessAnalytics(o),"reactivateSubscriptionPlan"==c.subscriptionOperationType&&(hideSpinner(".checkbox-section"),a.Close(),new BN.Modal.Account.SubscriptionConfirmation(null,{target:this},{useCache:!1,tplParams:{subscriptionOperationType:d,audiobookSubscriptionOrderNumber:e,audiobookSubscriptionOrderTotal:f,newPlan:g,newPlanPrice:h,nextRenewDate:i,previousPlan:j,previousPlanPrice:k,fromPage:n}})),$("#audiobookForm--new").is(":visible")&&$(".modal-reactivate-subscription").length>0?(sessionStorage.setItem("audioBookSaved","NewlyAdded"),location.reload()):window.location.href="/account/audiobook/manage-audiobook-subscription.jsp"}).on("amplifiFormError",function(a,b){hideSpinner(".checkbox-section"),$("#reactivatePlanBtn").is(":visible")&&$("form[id^=audiobookForm]:visible").parents().find("#reactivatePlanBtn").prop("disabled",!1);var c=$(this),d=c.find("input[type='submit']"),e=c.attr("id"),f=b.adiRecomendationCode;if("2FAREQUIRED"==b.response.items[0].toUpperCase())new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:c,formBtn:d,formId:e,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}});else if(f&&"DENY"===f.toUpperCase()){var g=$("form[id^=audiobookForm]:visible").parents().find(".audiobookSubmitButtonTo");g&&g.length>0&&(g.prop("disabled",!0),g.addClass("adi-deny-button"))}}),$(".benefit-box-mobile .collapsed").on("click",function(){$(".mobile-hero-banner .credit-value-msg").hasClass("d-none")?($(".benefit-box-mobile .collapsed").attr("aria-expanded","true"),$(".benefit-box-mobile .collapsed").parents().find("#benefitBoxData.collapse").addClass("show"),$(".mobile-hero-banner .credit-value-msg").removeClass("d-none")):($(".benefit-box-mobile .collapsed").attr("aria-expanded","false"),$(".benefit-box-mobile .collapsed").parents().find("#benefitBoxData.collapse").removeClass("show"),$(".mobile-hero-banner .credit-value-msg").addClass("d-none"))})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.OrderReady=BN.Modal.Account.OrderReady||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.OrderReady")};return a.prototype={tplName:"order-ready-notification",initView:function(){if(this.initGenericView(),this.initForm(),this.on("display",function(){valiadteFocusInProxyForm("#bopisPhoneForm")}),"undefined"!=typeof s_setP){var a=$(this.modal).attr("data-modal-name"),b=$("body").hasClass("checkout-review")?"Checkout Review Guest":"Checkout Review Member",c=getAnalyticsEventCount();s_setP("digitalData.event["+c+"].eventInfo.eventName","Page View"),s_setP("digitalData.event["+c+"].eventInfo.eventAction","pageView"),s_setP("digitalData.event["+c+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+c+"].category.primaryCategory","Modals"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.previousPageName",b),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.pageName","buy online pickup store:text when ready"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.pageType","buy online pickup in store"),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.destinationURL",window.location.href+"/"+a),s_setP("digitalData.event["+c+"].attributes.page.pageInfo.referringURL",window.location.href),_satellite.track("onPageView")}}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ReasonsForCancellation=BN.Modal.Account.ReasonsForCancellation||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ReasonsForCancellation")};return a.prototype={tplName:"m-reasons-for-cancellation",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){$("input[type=radio][name=cancellationReason]").change(function(){"C99"==this.value?$("#messageWrapper").removeClass("d-none"):$("#messageWrapper").addClass("d-none")}),$("#keepSubscription").on("click",function(){a.Close()}),$("#reasonsForCancellationForm").on("amplifiFormSuccess",function(){var a=[];a.audiobookPlanCost=$(this).attr("data-audiobook-planCost"),a.audiobookPlanCredits=$(this).attr("data-audiobook-planCredits"),a.audiobookPlanEndDate=$(this).attr("data-audiobook-planEndDate"),a.audiobookPlanSchedule=$(this).attr("data-audiobook-planSchedule"),a.audiobookPlanStatus=$(this).attr("data-audiobook-planStatus"),a.isAudiobook=$(this).attr("data-is-audiobook"),a.isDigitalProduct=$(this).attr("data-is-digitalProduct"),a.isPhysicalProduct=$(this).attr("data-is-physicalProduct"),a.primaryCategory=$(this).attr("data-primary-category"),a.productType=$(this).attr("data-product-type"),a.subCategory=$(this).attr("data-sub-category"),a.basePrice=$(this).attr("data-base-price"),a.audiobookID=$(this).attr("data-audiobook-ID"),a.availability=$(this).attr("data-availability"),a.productID=$(this).attr("data-product-ID"),a.productName=$(this).attr("data-product-name"),a.productURL=$(this).attr("data-product-URL"),a.ratings=$(this).attr("data-rate"),a.reviews=$(this).attr("data-reviews"),a.sku=$(this).attr("data-sku"),a.newPlanSchedule=$(this).attr("data-audiobook-newPlanSchedule"),onAudiobookSubscriptionCancellationAnalytics(a),window.location.href="/account/audiobook/manage-audiobook-subscription.jsp"})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.Register=BN.Modal.Account.Register||Extend(function(){var a=function(a,b,c,d){consoleLog("Instantiating BN.Modal.Account.Register"),this.data=this.data||b||{},d&&d.pureModal&&"object"==typeof d.data&&(consoleLog("SET DATA TARGET: "+d.data.target),this.data.target=d.data.target)};return a.prototype={tplName:"register",defaultOptions:{tplParams:{tplName:"register"}},initView:function(){this.on("display",function(){if("undefined"!=typeof s_setP){var a=new Date,b=getAnalyticsEventCount();s_setP("digitalData.event["+b+"].eventInfo.eventName","Create Account Start"),s_setP("digitalData.event["+b+"].eventInfo.eventAction","createAccountStart"),s_setP("digitalData.event["+b+"].eventInfo.timeStamp",""+a),s_setP("digitalData.event["+b+"].category.primaryCategory","User"),_satellite.track("onCreateAccountStart")}}),this.initFrameForm()}},a}(),BN.Modal.Account.Login,!0),BN.Modal.Account.RegisterNew=BN.Modal.Account.RegisterNew||Extend(function(){var a=function(a,b,c,d){consoleLog("Instantiating BN.Modal.Account.Register"),this.data=this.data||b||{},d&&d.pureModal&&"object"==typeof d.data&&(consoleLog("SET DATA TARGET: "+d.data.target),this.data.target=d.data.target)};return a.prototype={tplName:"register",defaultOptions:{tplParams:{tplName:"register",isNew:"true"}},initView:function(){var a=this.data,b=$(a.target);"join-premium"==b[0].id?("true"===sessionStorage.getItem("notMembershipCreateAccount")&&sessionStorage.removeItem("notMembershipCreateAccount"),sessionStorage.setItem("membershipCreateAccount","true")):("true"===sessionStorage.getItem("membershipCreateAccount")&&sessionStorage.removeItem("membershipCreateAccount"),sessionStorage.setItem("notMembershipCreateAccount","true")),this.on("display",function(){if("undefined"!=typeof s_setP){var a=new Date,b=getAnalyticsEventCount();s_setP("digitalData.event["+b+"].eventInfo.eventName","Create Account Start"),s_setP("digitalData.event["+b+"].eventInfo.eventAction","createAccountStart"),s_setP("digitalData.event["+b+"].eventInfo.timeStamp",""+a),s_setP("digitalData.event["+b+"].category.primaryCategory","User"),_satellite.track("onCreateAccountStart")}}),this.initFrameForm()}},a}(),BN.Modal.Account.Login,!0),BN.Modal.Account.RegisterCheckout=BN.Modal.Account.RegisterCheckout||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.RegisterCheckout")};return a.prototype={tplName:"register-checkout"},a}(),BN.Modal.Account.Login,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.RentalShippingLabel=BN.Modal.Account.RentalShippingLabel||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.RentalShippingLabel")};return a.prototype={tplName:"shipping-label",initView:function(){this.initGenericView()}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.ConfirmMembershipReward=BN.Modal.Account.ConfirmMembershipReward||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ConfirmMembershipReward")};return a.prototype={tplName:"m-reward-confirmation",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){document.body.appendChild(document.createElement("script")).src="/static/redesign/srcs/js/carousels.js",sessionStorage.removeItem("login-status-check"),onMembershipRewardsSignUpSuccessAnalytics("false"),$(".icon-close-modal").on("click",function(){location.reload()})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.SaveMemberShipDetails=BN.Modal.Account.SaveMemberShipDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.SaveMemberShipDetails")};return a.prototype={tplName:"m-save-membership-details",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){$(".member-modal-close, .icon-close-modal").on("click",function(){window.location.href="/account/manage/memberships/associate-membership.jsp"})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.showscannableCard=BN.Modal.Account.showscannableCard||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.showscannableCard")};return a.prototype={tplName:"m-show-scannable-card",initView:function(){var a=this,b=($(this.modal),a.data.target,$("#scannable-memberId").val()),c=$("#scannable-memberType").val(),d=$("#BNKidsMembershipTile .small-heading").text();consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),this.on("display",function(){"legacy_without_rewards"==c?$(".member-type-title").html("<i>Your B&N Membership</i>"):"legacy_with_rewards"==c?$(".member-type-title").html("<i>Your B&N Membership & Rewards</i>"):"active-premium"==c?$(".member-type-title").html("<i>Your Premium Membership</i>"):"B&N Bookseller"==d?($(".member-type-title").addClass("bookseller"),$(".member-type-title").html("B&N Bookseller")):$(".member-type-title").html("<i>Your Membership Number</i>"),$(".barcode").append("*"+b+"*"),$(".barcode-number").append(b)})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.StoreUnavailable=BN.Modal.Account.StoreUnavailable||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.StoreUnavailable")};return a.prototype={tplName:"/account/store-pickup-unavailable",initView:function(){var a=this.data,b=$(this.modal),c=this;if(a&&(a.title&&"string"==typeof a.title&&b.find("#dialog-title").html(a.title).attr("aria-label",a.title),a.messages)){var d=b.find("p"),e=$("<span/>");d.html(""),d.parent().addClass("modal-unavailable-message");for(var f in a.messages)if(a.messages.hasOwnProperty(f)){var g=a.messages[f];switch(g.type){case"success":d.append(e.clone())}0==f&&d.addClass("store-unavailable-first"),d.append(g.message)}a.onclose&&this.closeEvents.all.push(a.onclose),a.target&&a.target.blur(),this.on("display",function(){}),this.closeEvents.all.push(function(){var a;c.data&&c.data.target?(a=$(c.data.target),consoleLog("returning focus to ",a.find("[type=submit]")),a.find("[type=submit]").focus()):consoleLog("can't return focus to the modal-opening element, as it could not be found"),$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")})}}},a}(),BN.Modal.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.SubscriptionCancellation=BN.Modal.Account.SubscriptionCancellation||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.SubscriptionCancellation")};return a.prototype={tplName:"m-subscription-cancellation",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.noOfCredits,c=a.userOptions.tplParams.subscriptionPlan;this.on("display",function(){$("#creditsRremaining").empty().append(1==b?"Your remaining "+b+" credit will expire in 30 days.":"Your remaining "+b+" credits will expire in 30 days."),"2 Credits"==c&&$("#reminderMsg").removeClass("d-none"),$("#keepSubscription").on("click",function(){a.Close()}),$("#cancelSubscription").on("click",function(){cancelSubscriptionModalAnalytics(),a.Close(),b>=1?new BN.Modal.Account.AudiobookCreditsInfo(null,{target:this},{useCache:!1,tplParams:{noOfCredits:b,subscriptionPlan:c}}):new BN.Modal.Account.ReasonsForCancellation(null,{target:this})})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.SubscriptionConfirmation=BN.Modal.Account.SubscriptionConfirmation||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.SubscriptionConfirmation")};return a.prototype={tplName:"m-subscription-confirmation",initView:function(){var a=this,b=($(this.modal),a.data.target);consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var c=a.userOptions.tplParams.subscriptionOperationType,d=a.userOptions.tplParams.audiobookSubscriptionOrderNumber,e=a.userOptions.tplParams.audiobookSubscriptionOrderTotal,f=a.userOptions.tplParams.newPlan,g=a.userOptions.tplParams.newPlanPrice,h=a.userOptions.tplParams.nextRenewDate,i=a.userOptions.tplParams.subscribeDate,j=a.userOptions.tplParams.previousPlan,k=a.userOptions.tplParams.previousPlanPrice,l=a.userOptions.tplParams.fromPage;this.on("display",function(){$("#orderno_href").attr("href",$("#orderno_href").attr("href")+d),$("#orderNo").text(d),$("#orderTotal").append("$"+e),"changeSubscriptionPlan"==c?($(".heading").append("Welcome to your new B&N Audiobooks Subscription Plan!"),$(".confirm-text").append("We'll send you an email confirming the details of your plan change shortly."),$("#previousPlan").append(j+" / Month - $"+k+" + tax"),$("#newPlanDate").append(""!=h?"Your New Plan <i>(Effective "+h+")</i>":"Your New Plan <i>(Effective "+i+")</i>"),$("#newPlan").append(f+" / Month - $"+g+" + tax"),$(".change-plan-details").removeClass("d-none")):"purchaseSubscriptionPlan"==c?($(".heading").append("Thanks for joining the B&N Audiobooks Subscription Program!"),$(".confirm-text").append("We'll send you an email confirming the details of your order shortly."),$("#newPlanText").append("Your next monthly charge of <strong>$"+g+" (+ tax) will begin on "+h+".</strong>"),$(".purchase-plan-details").removeClass("d-none")):"reactivateSubscriptionPlan"==c&&($(".heading").append("Your B&N Audiobooks Subscription has been reactivated!"),$(".confirm-text").append("We'll send you an email confirming the details of your plan shortly."),$("#yourPlanText").append(f+" / Month - $"+g+" + tax"),$(".reactivate-plan-details").removeClass("d-none")),$(".continue-shopping-button, .icon-close-modal").on("click",function(){"myAccount"==l?window.location.href="/account/audiobook/manage-audiobook-subscription.jsp":location.reload()})}),this.closeEvents.all.push(function(){a&&b&&"m-subscription-confirmation"==this.modal.dataset.modalName&&("myAccount"==l?window.location.href="/account/audiobook/manage-audiobook-subscription.jsp":location.reload())})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.TwoStepVerification=BN.Modal.Account.TwoStepVerification||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.TwoStepVerification")};return a.prototype={tplName:"two-step-verification",initView:function(){{var a=this;$(this.modal),a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1);var b=a.userOptions.tplParams.formBtn,c=a.userOptions.tplParams.formName,d=a.userOptions.tplParams.formId,e=a.userOptions.tplParams.from,f=0,g=!1,h=!1;this.on("display",function(){var i=$("#isLoggedIn").val(),j=$("#mobile").val(),k=$("#emailId").val(),l=($("#smsAvailable").val(),$("#emailAvailable").val());if($(".spinner").hide(),"editPayment"==e?$("#editPaymentErrors").hide():"editAddress"==e?$("#editAddressErr").hide():"confirmCvv"==e&&$("#cvvErr").hide(),"changeEmailForm"==e){var m=$("#emailChangeClearPayment").val();"true"==m&&$(".confirm-email.info-message").removeClass("d-none")}if("changePhoneForm"==e){var n=$("#phoneNoChangeClearPayment").val();"true"==n&&$(".confirm-email.info-message").removeClass("d-none")}$("#TextCodeEmail").prop("checked",!0),$(".email-address-input").removeClass("hidden"),$("#newEmailInput").prop("required",!0),$("#TextCodeEmail").attr("selected",!0),"false"===l&&($("#textCodePhoneNumber").prop("checked",!0),$(".mobile-number-input").removeClass("hidden"),$("#phoneNumber").prop("required",!0),$("#smsCheck").prop("required",!0),$("#textCodePhoneNumber").attr("selected",!0),$(".sms-to-send").removeClass("hidden"),$("#TextCodeEmail").prop("checked",!1),$(".email-address-input").addClass("hidden"),$("#newEmailInput").prop("required",!1),$("#TextCodeEmail").attr("selected",!1)),d&&("true"===i&&""===j&&""!=k&&"true"===l&&($("#twoStepVerificationSection").hide(),$("#addPhoneCodeForm").show(),""!=$("#verificationCodewithPhone").val()&&$("#verificationCodewithPhone").val(""),"addPhoneNumberForm"===d||"changePhoneForm"==d?$("#addPhnWithToken").hide():$("#addPhnWithToken").show()),""===j&&""!=k&&"false"===l&&"addPhoneNumberForm"===d&&($(".phone-no-not-saved").removeClass("hidden"),$("#twoStepVerificationSection").hide(),$(".modal-two-step-verification .modal__header h2").html("Phone Number Not Saved")),"submitOrder"==d||"memberOrder"==d?($("#verificationCodewithPhone").val(""),$(".verify-submit-btn").removeClass("strict-hidden"),$(".icon-close-modal").on("click",function(){a.Close(),location.reload()})):$(".verify-btn").removeClass("strict-hidden")),$("#textCodePhoneNumber").change(function(){$("#TextCodeEmail").prop("checked",!1),$(".mobile-number-input").removeClass("hidden"),$("#phoneNumber").prop("required",!0),$("#smsCheck").prop("required",!0),$("#textCodePhoneNumber").attr("selected",!0),$("#TextCodeEmail").attr("selected",!1),$("#newEmailInput").prop("required",!1),$(".sms-to-send").removeClass("hidden"),$(".email-address-input").addClass("hidden"),$("#newEmailInput").val(""),$(".email-address-input").removeClass("filled"),$("#verificationErrors").html(""),$("#verificationErrors").hide(),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden")}),$("#TextCodeEmail").change(function(){$("#textCodePhoneNumber").prop("checked",!1),$(".email-address-input").removeClass("hidden"),$("#newEmailInput").prop("required",!0),$("#TextCodeEmail").attr("selected",!0),$("#textCodePhoneNumber").attr("selected",!1),$("#phoneNumber").prop("required",!1),$("#smsCheck").prop("required",!1),$(".mobile-number-input").addClass("hidden"),$(".sms-to-send").addClass("hidden"),$("#phoneNumber").val(""),$("#verificationErrors").html(""),$("#verificationErrors").hide(),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden")}),$(".no-code-link-Email-only").on("click",function(){$("#tokenVerificationWithEmailOnly").submit()}),$(".no-code-link, .new-code-link").on("click",function(){h?($("#twoStepVerificationCodeSection").hide(),$(".max-resend-attempts").removeClass("hidden")):($("#twoStepVerificationCodeSection").hide(),$("#twoStepVerificationSection").show(),$(".otp-not-recieved").removeClass("hidden"),$(".verification-msg").addClass("hidden"),$(".no-code-link").addClass("hidden"),$("#otpSentMsg").removeClass("hidden"),$(".list-reason").removeClass("hidden"),$(".new-code-link").removeClass("hidden"),$("#addPhoneCodeForm").hide(),$("#verificationCode").val("")),$("#verificationErrors").is(":visible")&&$("#verificationErrors").hide(),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden"),$("#tokenVerificationWithEmailOnly").submit()}),$(".close-button").on("click",function(){a.Close()}),$("#phoneNumber").on("focusout blur",function(){$(".mobile-number-input").addClass("focus"),$(".mobile-number-input").addClass("filled")}),$("#addPhoneNumber").on("focusout blur",function(){$(".add-mobile-number-input").addClass("focus"),$(".add-mobile-number-input").addClass("filled")}),$("#phoneNumber, #addPhoneNumber").keydown(function(a){var b=a.charCode||a.keyCode||0;return $text=$(this),8!==b&&9!==b&&(3===$(this).val().length&&$(this).val($text.val()+"-"),7===$(this).val().length&&$(this).val($text.val()+"-")),8==b||9==b||46==b||b>=48&&57>=b||b>=96&&105>=b}),$("#verificationCode, #verificationCodewithPhone").keypress(function(a){8!=a.which&&isNaN(String.fromCharCode(a.which))&&a.preventDefault()}),$("#addPhoneCheckbox").on("change",function(){$("#addPhoneCheckbox").is(":checked")?($(".add-mobile-number-input").show(),$("#addPhoneNumber").prop("required",!0)):($(".add-mobile-number-input").hide(),$("#addPhoneNumber").prop("required",!1))}),$(".continue-button").on("click",function(a){$(this).hasClass("disabled")&&a.preventDefault(),$(this).addClass("disabled"),$("#twoStepVerificationSection #textCodePhoneNumber").is(":checked")&&$("#smsCheck").is(":not(:checked")&&$(".sms-checkbox .checkbox").addClass("checkbox--error"),$("#verificationCode").val(""),$(".verification-code-input").removeClass("filled")}),$(".continue-button").on("keypress",function(a){13===a.keyCode&&($(this).hasClass("disabled")&&a.preventDefault(),$(this).addClass("disabled"))}),$("#emailPhoneVerification").on("amplifiFormSuccess",function(a,b){"true"==b.isRetryMaxOut&&(h=!0),$("#twoStepVerificationSection").hide(),$("#twoStepVerificationCodeSection").show(),$(".continue-button").removeClass("disabled"),$("#emailOrPhone").html("sms"==b.channel?"phone":"email"),$("#maxInvalidCodeAttempts").is(":visible")&&$("#maxInvalidCodeAttempts").addClass("hidden"),""!=$("#verificationCode").val()?$("#verificationCode").val(""):""!=$("#verificationCodewithPhone").val()&&$("#verificationCodewithPhone").val("")}).on("amplifiFormError",function(a,b){$(".continue-button").removeClass("disabled"),("RETRY_MAX_OUT"==b.response.items[0].toUpperCase()||"You are currently blocked. Please call customer care for help."==b.response.items[0])&&($("#maxInvalidCodeAttempts").is(":visible")&&$("#maxInvalidCodeAttempts").addClass("hidden"),$("#verificationErrors").hide(),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden"),$("#twoStepVerificationSection").hide(),$(".max-resend-attempts").removeClass("hidden"))}).on("invalid",function(){$(this).find(".continue-button").hasClass("disabled")&&$(this).find(".continue-button").removeClass("disabled")}),$(".verify-btn").on("click",function(a){$(this).hasClass("disabled")&&a.preventDefault(),$(this).addClass("disabled"),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden")}),$(".verify-btn").on("keypress",function(a){13===a.keyCode&&($(this).hasClass("disabled")&&a.preventDefault(),$(this).addClass("disabled"),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden"))}),$("#tokenVerification, #tokenVerificationWithPhone").on("amplifiFormSuccess",function(){$("#isWPApiAlreadyCalled").val("true"),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden"),b&&(void 0!=$("#"+d).attr("data-qas")?$("#"+d).trigger("success"+BN.QAS.Service.Configuration.eventNamespace):(("changeEmailForm"==d||"changePasswordForm"==d||"changeSecurityForm"==d||"addPhoneNumberForm"==d||"changePhoneForm"==d)&&$("#"+d).append('<input type="hidden" id="frmTokenVerified" value="true">'),b.click())),"instant-purchase"==d&&(c.append('<input type="hidden" id="frmTokenVerified" value="true">'),$("#isWPApiAlreadyCalled").val("false"),c.find("input[type=submit]").click()),"changeEmailForm"==d||"changePasswordForm"==d||"changeSecurityForm"==d||"addPhoneNumberForm"==d||"changePhoneForm"==d?"true"==$("#frmTokenVerified").val()&&c.on("amplifiFormSuccess",function(a,b){$(".continue-btn").hide(),$("#successMsg").removeClass("hidden"),"changeEmailForm"==d?"true"==b.ShowPendingMsg?$("#pendingemailUpdated").removeClass("hidden"):$("#emailUpdated").removeClass("hidden"):"changePasswordForm"==d?$("#passwordUpdated").removeClass("hidden"):"changeSecurityForm"==d?$("#securityQuesUpdated").removeClass("hidden"):("addPhoneNumberForm"==d||"changePhoneForm"==d)&&$("#phoneNumberUpdated").removeClass("hidden"),setTimeout(function(){$(".close-button").click()},5e3),"addPhoneNumberForm"==d&&window.location.reload()}):($(".verify-btn").removeClass("disabled"),$(".close-button").click())}).on("amplifiFormError",function(a,b){$(".verify-btn").removeClass("disabled"),"INCORRECT VALUE"==b.response.items[0].toUpperCase()&&(f++,$("#verificationErrors").hide(),$("#customVerificationErrors").removeClass("strict-hidden")),3==f&&(f=0,$("#twoStepVerificationCodeSection").hide(),$("#addPhoneCodeForm").hide(),$("#verificationErrors").hide(),$("#customVerificationErrors").is(":visible")&&$("#customVerificationErrors").addClass("strict-hidden"),$(".one-time-msg").addClass("hidden"),$("#twoStepVerificationSection").show(),$("#maxInvalidCodeAttempts").removeClass("hidden"))}).on("invalid",function(){$(this).find(".verify-btn").hasClass("disabled")&&$(this).find(".verify-btn").removeClass("disabled")}),$("#tokenVerificationWithEmailOnly").on("amplifiFormSuccess",function(a,b){"true"==b.isRetryMaxOut&&(g=!0)}).on("amplifiFormError",function(a,b){(1==g||"RETRY_MAX_OUT"==b.response.items[0].toUpperCase())&&($("#twoStepVerificationSection").hide(),$("#verificationErrors").hide(),$(".max-resend-attempts").removeClass("hidden"))})}),consoleLog("closeEvents for Two Step Verification = ",this.closeEvents),this.data.onClose&&this.closeEvents.all.push(this.data.onClose)}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.UpgradeLegacyMembership=BN.Modal.Account.UpgradeLegacyMembership||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.UpgradeLegacyMembership")};return a.prototype={tplName:"m-upgrade-legacy",initView:function(){{var a=this,b=$(this.modal),c=window.location;a.data.target}consoleLog("Initializing Modal Form"),this.initGenericView(),this.initForm(!1),b.find(".icon-close-modal").on("click",function(){b.find(".icon-close-modal").click()}),this.on("display",function(){bnPremiumMembershipUpgradeAnalytics(),$(".upgrade-legacy-account-member").on("click",function(){a.Close(),sessionStorage.setItem("upgrade-legacy-account",!0),c.href="/membership/"}),$(".bn-membership-link").on("click",function(){a.Close(),c.href="/membership/"})})}},a}(),BN.Modal.Account.Base,!0),BN.Modal.Account=BN.Modal.Account||{},BN.Modal.Account.LinkMembership=BN.Modal.Account.LinkMembership||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.LinkMembership")};return a.prototype={tplName:"link-membership",initView:function(){this.initGenericView(),this.initForm(),this.on("display",function(){})}},a}(),BN.Modal.Account.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.Base=BN.Modal.Membership.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/membership/"}},a}(),BN.Modal.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyUpgrade=BN.Modal.Membership.BrierleyUpgrade||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyUpgrade")},b=$("#bannerTrigger"),c=b.data("banner-type"),d=b.data("pilotid"),e=b.data("conversionid");return a.prototype={tplName:"brierley-upgrade",defaultOptions:{tplParams:{bannerType:c,pilotId:d,conversionId:e}},initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyJoin=BN.Modal.Membership.BrierleyJoin||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyJoin")},b=$("#bannerTrigger"),c=b.data("banner-type"),d=b.data("pilotid"),e=b.data("conversionid");return a.prototype={tplName:"brierley-join",defaultOptions:{tplParams:{bannerType:c,pilotId:d,conversionId:e}},initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyOptOut=BN.Modal.Membership.BrierleyOptOut||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyOptOut")},b=$("#bannerTrigger"),c=b.data("banner-type"),d=b.data("pilotid"),e=b.data("conversionid");return a.prototype={tplName:"brierley-opt-out",defaultOptions:{tplParams:{bannerType:c,pilotId:d,conversionId:e}},initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyRejoin=BN.Modal.Membership.BrierleyRejoin||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyRejoin")},b=$("#bannerTrigger"),c=b.data("banner-type"),d=b.data("pilotid"),e=b.data("conversionid");return a.prototype={tplName:"brierley-rejoin",defaultOptions:{tplParams:{bannerType:c,pilotId:d,conversionId:e}},initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyRenew=BN.Modal.Membership.BrierleyRenew||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyRenew")},b=$("#bannerTrigger"),c=b.data("banner-type"),d=b.data("pilotid"),e=b.data("conversionid");return a.prototype={tplName:"brierley-renew",defaultOptions:{tplParams:{bannerType:c,pilotId:d,conversionId:e}},initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.BrierleyZipCode=BN.Modal.Membership.BrierleyZipCode||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.BrierleyZipCode")};return a.prototype={tplName:"brierley-zip-code",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.CancelFree=BN.Modal.Membership.CancelFree||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.CancelFree")};return a.prototype={tplName:"cancel-free-membership",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.Benefits=BN.Modal.Membership.Benefits||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Membership.Benefits")};return a.prototype={tplName:"membership-benefits-ra",initView:function(){this.findAlwaysVisibleTarget()},findAlwaysVisibleTarget:function(){var a,b=this.data.target&&$(this.data.target);b&&b.length&&(b.hasClass("see-all-benefits")||(a=$(b).closest("main").find(".see-all-benefits"),a.length&&(this.data.target=a.first().get(0))))}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.NookOffer=BN.Modal.Membership.NookOffer||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.NookOffer")};return a.prototype={tplName:"member-nook-offer",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.Renew=BN.Modal.Membership.Renew||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.Renew")};return a.prototype={tplName:"member-renew-ra",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.SignUp=BN.Modal.Membership.SignUp||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.SignUp")};return a.prototype={tplName:"member-sign-up",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Membership.Base,!0),BN.Modal.Membership=BN.Modal.Membership||{},BN.Modal.Membership.UseSavedCC=BN.Modal.Membership.UseSavedCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Membership.UseSavedCC")};return a.prototype={tplName:"renewal-membership-manage-card",defaultOptions:{tplDir:SITE_ROOT+"/modals/membership/"},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=$(this.modal);d.find(".membership-id").val(a["membership-id"]),!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Account.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
function submitOrderAfterCVV(a,b,c){c.clientProfile=checkDeviceType(),c.marketingEmailOptIn=$("#promotionalEmailCheck").length>0?$("#promotionalEmailCheck").attr("aria-checked"):"false",BN.uXHR.getService("submit-order",c,function(c){if(0==c.service.success){{var d=c.service.response.items,e=d.length,f=b.find("#cvvErr");f.find("em").length}if(f.empty(),"The Security Code you entered is incorrect.</br>Please try again."==d){for(var g=0;e>g;g++)f.append($('<em class="emphasis emphasis--alert"></em>').html(d[g]));b.find("form#checkCVV").find("input[type=submit]").removeClass("disabled"),f.show(),f.length>0&&a.hideSpinner(),e>0&&b.find("form#checkCVV").find("#csv").parent().removeClass("valid").addClass("invalid"),$("#memberSubmitOrder").removeClass("disabled reg-button-disabled"),$("#finalOrderSubmit").removeClass("disabled reg-button-disabled")}else d.indexOf("2FARequired")>-1?($("#cvvErr").hide(),$("#submitOrderErr, #altPaymentErr").empty().hide(),formName=$("#checkCVV"),formBtn=$("#checkCVV").find(".use-address"),new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:formName,formBtn:formBtn,formId:"checkCVV",from:"confirmCvv",captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}})):(a.Close(),$("#submitOrderErr, #altPaymentErr").empty().hide(),e>0&&($("#altPaymentErr").attr({role:"alert","aria-atomic":"true",tabindex:"0"}),$("#altPaymentErr").append($('<em class="emphasis emphasis--alert"></em>').html(d)).show().focus()),$("#memberSubmitOrder").removeClass("disabled reg-button-disabled"),$("#finalOrderSubmit").removeClass("disabled reg-button-disabled"),"undefined"!=typeof c.service.response.specialCharInShipAddress&&null!=c.service.response.specialCharInShipAddress&&$("#orderSummary").load(window.location+"?editShipAddress=true #orderSummary",function(){$("#orderSummary").find("form").each(function(){BN.uXHR.Form.apply(this)}),BN.Items.Init(),$("#editShipBtnSubmit").click()}))}else{var f=b.find("#cvvErr");f.empty().hide(),a.Close(),consoleLog("Success! Redirecting page to success page thank you"),window.location=SITE_DOMAIN_URL+"/checkout/thank-you.jsp"}},function(){b.find("#cvvErr").append($('<em class="emphasis emphasis--alert"></em>').text("There was a problem with your actions. Please try again later.")),b.find("form#checkCVV").find("input[type=submit]").removeClass("disabled"),b.find("#cvvErr").show(),$("#orderSummary").find("#memberSubmitOrder").removeClass("disabled")})}function focusInGuestAdd(a){$("body").hasClass("anonymous-order-review")&&"true"==$("#useShippingAddress").attr("aria-checked")&&("emailAddress"==a.currentTarget.id?a.shiftKey||9!==a.keyCode||($("#addAddressSubmit").focus(),$("#addAddressSubmit").addClass("focus")):"addAddressSubmit"==a.currentTarget.id&&a.shiftKey&&9===a.keyCode&&($("#emailAddress").focus(),$("#emailAddress").addClass("focus")))}BN.Modal.Checkout={},BN.Modal.Checkout.Base=Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},initForm:function(a){var b=this,c=$(this.modal),d=c.find("form");c.find("select").selectBox();for(var e=0;e<d.length;e++){var f=$(d[e]);"payPalPayment"!=f.attr("id")&&(consoleLog("Attaching uXHR to form",f),BN.uXHR.Form.apply(f),consoleLog("Listening for Errors"),f.on("amplifiFormError",function(a,c,d,e,f){var g=f.items;consoleError("Unsuccessful Form Submission: Server's response indicated errors occurred"),consoleLog(g),BN.Validate.DisplayErrors(this,g),b.$spinner.remove()}).on("amplifiFormBeforeSubmit",function(){consoleLog("Calling displaySpinner"),b.$spinner&&b.$spinner.length>0&&b.$spinner.remove(),b.displaySpinner()}).on("amplifiFormSuccess",function(c,d){if(a===!1)return void consoleLog("Success!");var e=b.data,g=window.location.toString().split("#")[0];null!=d&&void 0!=d&&d instanceof Object&&d.redirectSuccessUrl&&""!=d.redirectSuccessUrl?g=d.redirectSuccessUrl:null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl&&(g=e.redirectSuccessUrl),f.hasClass("usesaved_cc")&&(g=g.split("?")[0]);var h=null,i=(h=f.find('input[name="modalRedirect"]')).length>0;if(i){consoleLog("Success! Redirecting modal to "+h.val());{var j=b.getContructorFromString(h.val());new j(null,null,null,b)}}else consoleLog("Success! Redirecting page to "+g),window.location=g}))}}},a}(),BN.Modal.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.AddBilling=BN.Modal.Checkout.AddBilling||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.AddBilling")};return a.prototype={tplName:"m-add-billing",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=this,e=$(this.modal),f=e.find("form");!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),d.initGenericView(),d.initForm(),f.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(f)?d.displaySpinner():d.hideSpinner()})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ValidateEmail=BN.Modal.Checkout.ValidateEmail||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.ValidateEmail"),this.data=b};return a.prototype={address:null,tplName:"m-validate-billing-email",initView:function(){var a=this,b=$(this.modal),c=b.find("form");$errors=b.find(".error-email-validation"),$button=$("#verifyEmailAddress"),b.find("#validateEmailCancel").on("click",function(b){b.preventDefault(),a.Close()}),consoleLog("Attaching success listener"),c.on("amplifiFormSuccess",function(){c.find("input[type=submit]").addClass("disabled"),$button.addClass("disabled"),BN.uXHR.getService("submit-order",{},function(b){if(0==b.service.success){{var d=b.service.response.items,e=d.length,f=$errors;f.find("em").length}f.empty();for(var g=0;e>g;g++)f.append($('<em class="emphasis emphasis--alert"></em>').html(d[g]));c.find("input[type=submit]").removeClass("disabled"),f.show(),$button.removeClass("disabled"),"undefined"!=typeof b.service.response.specialCharInShipAddress&&null!=b.service.response.specialCharInShipAddress&&(a.Close(),$("#orderSummary").load(window.location+"?editShipAddress=true #orderSummary",function(){$("#orderSummary").find("form").each(function(){BN.uXHR.Form.apply(this)}),BN.Items.Init(),$("#editShipBtnSubmit").click()}))}else $errors.empty().hide(),a.Close(),consoleLog("Success! Redirecting page to success page thank you"),window.location=SITE_DOMAIN_URL+"/checkout/thank-you.jsp"},function(){$errors.append($('<em class="emphasis emphasis--alert"></em>').html("There was a problem with your actions. Please try again later.")),c.find("input[type=submit]").removeClass("disabled"),$errors.show(),$button.removeClass("disabled")})}).on("amplifiFormError",function(){c.find("input[type=submit]").removeClass("disabled")}).on("amplifiCountryChange",function(){}).on("result.QAS",function(a,b){b||c.find("input[type=submit]").removeClass("disabled")}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(c)?c.find("input[type=submit]").addClass("disabled"):c.find("input[type=submit]").removeClass("disabled")}),this.initGenericView(),this.initForm(!1)}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.AddShipping=BN.Modal.Checkout.AddShipping||Extend(function(){var a=function(){this.defaultOptions.tplParams={editMode:"add"},consoleLog("Instantiating BN.Modal.Checkout.AddShipping")};return a.prototype={defaultOptions:{tplParams:{editMode:"add"}},tplName:"m-add-shipping",initView:function(){var a=this,b=this.data,c=$(this.modal),d=$(b.target),e=d.attr("href")||"",f=c.find("form");a.on("display",function(){$("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)})}),!b.redirectSuccessUrl&&d.length>-1&&""!=e&&"#"!=e&&("/"==e.substr(0,1)&&(e=SITE_DOMAIN_URL+e),consoleLog(e),b.redirectSuccessUrl=e),a.initGenericView(),a.initForm(),c.find(".link-with-arrow").on("click",function(){prevModal=a.flow().get("m-used-saved-address"),prevModal?a.flow().goTo("m-used-saved-address"):new BN.Modal.Checkout.UseSavedAddress(null,this,null,a)}),f.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(f)?a.displaySpinner():a.hideSpinner()})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ValidateBilling=BN.Modal.Checkout.ValidateBilling||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.ValidateBilling"),this.data=b};return a.prototype={address:null,tplName:"m-validate-address-billing",initView:function(){var a=this,b=this.data,c=$(this.modal),d=c.find("form");$errors=c.find(".error-msg"),$button=$("#verifyOrderAddress");var e="";$("#acceptTerms").length>0&&(e=$("#acceptTerms").is(":checked")),c.find("#addPaymentCancel").on("click",function(b){b.preventDefault(),a.Close()}),consoleLog("Attaching success listener"),d.on("amplifiFormSuccess",function(){d.find("input[type=submit]").addClass("disabled"),"true"==b.refreshpage?window.location.href=window.location.href:($button.addClass("disabled"),BN.uXHR.getService("submit-order",{rentalInCart:e},function(b){if(0==b.service.success){{var c=b.service.response.items,e=c.length,f=$errors;f.find("em").length}if(f.empty(),"undefined"!=typeof b.service.response.specialCharInShipAddress&&null!=b.service.response.specialCharInShipAddress)a.Close(),$("#orderSummary").load(window.location+"?editShipAddress=true #orderSummary",function(){$("#orderSummary").find("form").each(function(){BN.uXHR.Form.apply(this)}),BN.Items.Init(),$("#editShipBtnSubmit").click()});else if("The Security Code you entered is incorrect.</br>Please try again."!=c){for(var g=0;e>g;g++)f.append($('<em class="emphasis emphasis--alert"></em>').html(c[g]));d.find("input[type=submit]").removeClass("disabled"),f.show(),$button.removeClass("disabled")}else a.Close(),new BN.Modal.Checkout.ConfirmSecurityCode(null,{target:this},null,null)}else $errors.empty().hide(),a.Close(),consoleLog("Success! Redirecting page to success page thank you"),window.location=SITE_DOMAIN_URL+"/checkout/thank-you.jsp"},function(){$errors.append($('<em class="emphasis emphasis--alert"></em>').html("There was a problem with your actions. Please try again later.")),d.find("input[type=submit]").removeClass("disabled"),$errors.show(),$button.removeClass("disabled")}))}).on("amplifiFormError",function(){d.find("input[type=submit]").removeClass("disabled")}).on("amplifiCountryChange",function(){}).on("result.QAS",function(a,b){b||d.find("input[type=submit]").removeClass("disabled")}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(d)?d.find("input[type=submit]").addClass("disabled"):d.find("input[type=submit]").removeClass("disabled")}),this.initGenericView(),this.initForm(!1)}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ValidateShipping=BN.Modal.Checkout.ValidateShipping||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.ValidateShipping"),this.data=b};return a.prototype={address:null,tplName:"m-validate-address-shipping",initView:function(){var a=this,b=this.data,c=$(this.modal),d=c.find("form");$errors=c.find("#editShippingErrors"),$button=$("#verifyOrderAddress");var e="";$("#acceptTerms").length>0&&(e=$("#acceptTerms").is(":checked")),c.find("#addAddressCancel").on("click",function(b){b.preventDefault(),a.Close()}),consoleLog("Attaching success listener"),d.on("amplifiFormSuccess",function(){d.find("input[type=submit]").addClass("disabled"),"false"==b.validatebilling?(a.Close(),new BN.Modal.Checkout.ValidateBilling(null,b,null,null)):"true"==b.refreshpage?window.location.href=window.location.href:"true"==b.cvvrequired?(a.Close(),new BN.Modal.Checkout.ConfirmSecurityCode(null,{target:this},null,null)):($button.addClass("disabled"),BN.uXHR.getService("submit-order",{rentalInCart:e},function(b){if(0==b.service.success){{var c=b.service.response.items,e=c.length,f=$errors;f.find("p").length}if(f.empty(),"undefined"!=typeof b.service.response.specialCharInShipAddress&&null!=b.service.response.specialCharInShipAddress)a.Close(),$("#orderSummary").load(window.location+"?editShipAddress=true #orderSummary",function(){$("#orderSummary").find("form").each(function(){BN.uXHR.Form.apply(this)}),BN.Items.Init(),$("#editShipBtnSubmit").click()});else if("The Security Code you entered is incorrect.</br>Please try again."!=c){for(var g=0;e>g;g++)f.append($('<em class="emphasis emphasis--alert"></em>').html(c[g]));d.find("input[type=submit]").removeClass("disabled"),f.show(),$button.removeClass("disabled")}else a.Close(),new BN.Modal.Checkout.ConfirmSecurityCode(null,{target:this},null,null)}else $errors.empty().hide(),a.Close(),consoleLog("Success! Redirecting page to success page thank you"),window.location=SITE_DOMAIN_URL+"/checkout/thank-you.jsp"},function(){$errors.append($('<em class="emphasis emphasis--alert"></em>').html("There was a problem with your actions. Please try again later.")),d.find("input[type=submit]").removeClass("disabled"),$errors.show(),$button.removeClass("disabled")}))}).on("amplifiFormError",function(){d.find("input[type=submit]").removeClass("disabled")}).on("amplifiCountryChange",function(){}).on("result.QAS",function(a,b){b||d.find("input[type=submit]").removeClass("disabled")}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(d)?d.find("input[type=submit]").addClass("disabled"):d.find("input[type=submit]").removeClass("disabled")}),this.initGenericView(),this.initForm(!1)}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ConfirmSecurityCode=BN.Modal.Checkout.ConfirmSecurityCode||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.ConfirmSecurityCode")};return a.prototype={tplName:"m-confirm-security-code-ra",initView:function(){var a=this.data,b=$(a.target),c=(b.attr("href")||"",this),d=$(this.modal),e=d.find("form#checkCVV"),f=$("#cvvValidate").val(),g="";$("#acceptTerms").length>0&&(g=$("#acceptTerms").is(":checked")),b.parent().find(".mini-cart-spinner").remove(),e.on("amplifiFormBeforeSubmit",function(){d.find("form#checkCVV").find("#csv").parent().hasClass("invalid")&&d.find("form#checkCVV").find("#csv").parent().removeClass("invalid").addClass("valid")}),e.on("amplifiFormSuccess",function(a,b){consoleLog("confirm security code form submit",b),b.redirectSuccessUrl="";c.data;if(d.find("form#checkCVV").find("input[type=submit]").addClass("disabled"),$("#orderSummary").find("#memberSubmitOrder").addClass("disabled"),f&&$("#submitOrder").length)$("#submitOrder").on("amplifiFormError",function(){var a=d.find("#cvvErr");a.empty().hide(),c.Close()}),$("#submitOrder").submit();else{var e=b.eProtectId;if("undefined"==typeof e&&(e=""),"undefined"!=typeof captchaV3ApiKey&&"undefined"!=typeof grecaptcha)grecaptcha.ready(function(){grecaptcha.execute(captchaV3ApiKey,{action:"Checkout"}).then(function(a){var b={"g-recaptcha-response":a,action:"Checkout",rentalInCart:g,eProtectId:e};submitOrderAfterCVV(c,d,b)}).catch(function(){var a={"g-recaptcha-response":"",action:"",rentalInCart:g,eProtectId:e};submitOrderAfterCVV(c,d,a)})});else{var h={rentalInCart:g,eProtectId:e};submitOrderAfterCVV(c,d,h)}}}).on("amplifiFormError",function(a,b){formName=$("#checkCVV"),formBtn=$("#checkCVV").find(".use-address"),"2FAREQUIRED"==b.response.items[0].toUpperCase()&&($("#cvvErr").hide(),new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:formName,formBtn:formBtn,formId:"checkCVV",from:"confirmCvv",captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}}))}),this.initGenericView(),this.initForm(!1),this.on("display",function(){$(".confirm-security-code-tooltip").tooltip(),$("#orderSummary").find("#continue, #memberSubmitOrder").removeClass("disabled"),f&&b.hasClass("creditCardCVVErrorCls")&&(d.find("#cvvErr").append(b.html()).show(),d.find("form#checkCVV").find("#csv").parent().removeClass("valid").addClass("invalid"))})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.UseSavedCC=BN.Modal.Checkout.UseSavedCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.UseSavedCC")},b="m-use-saved-cc";$("body").hasClass("anonymous-order-review")&&(b="m-use-saved-cc-anonymous");var c={};return"true"==$("#isEgiftLogin").val()&&(c={tplParams:{isEgift:"true"}}),a.prototype={tplName:b,defaultOptions:c,initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=$(this.modal),e=d.find("form");!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),$("body").hasClass("nook-login-page")?(e.each(function(){BN.uXHR.Form.apply(this)}),e.on("amplifiFormSuccess",function(){redirectToNook()})):this.initForm(),this.on("display",function(){var a=this,b="true"==$("#masterpassUpgradedNewLogic").val();if(masterPassConfigure(b),BN.Items.Init(),updateNookForwardUrl(),$(".saved-shipping-address-button-container").height($(".saved-shipping-address-button-container:last").prev().height()),$(".modal-use-saved-card").length>1?($(".modal-use-saved-card .payPalButtonRenderer").last().addClass("payPalButtonRendererLast"+$(".modal-add-credit-card").length),initPaypalExpress(".modal-use-saved-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length)):initPaypalExpress(".modal-use-saved-card .payPalButtonRenderer"),modalObjToReset=a,"undefined"!=typeof s_setP){var c=$(this.modal).attr("data-modal-name"),d=$("body").hasClass("checkout-review")?"Checkout Review Guest":"Checkout Member",e=getAnalyticsEventCount();s_setP("digitalData.event["+e+"].eventInfo.eventName","Page View"),s_setP("digitalData.event["+e+"].eventInfo.eventAction","pageView"),s_setP("digitalData.event["+e+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+e+"].category.primaryCategory","Modals"),s_setP("digitalData.event["+e+"].attributes.page.pageInfo.previousPageName",d),s_setP("digitalData.event["+e+"].attributes.page.pageInfo.pageType","checkout"),s_setP("digitalData.event["+e+"].attributes.page.pageInfo.destinationURL",window.location.href+"/"+c),s_setP("digitalData.event["+e+"].attributes.page.pageInfo.referringURL",window.location.href),$("body").hasClass("anonymous-order-review")?s_setP("digitalData.event["+e+"].attributes.page.pageInfo.pageName","checkout:guest edit payment ~ modal"):s_setP("digitalData.event["+e+"].attributes.page.pageInfo.pageName","checkout:logged in edit payment ~ modal"),_satellite.track("onPageView")}})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.UseSavedBillingAddr=BN.Modal.Checkout.UseSavedBillingAddr||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.UseSavedBillingAddr")};return a.prototype={tplName:"m-use-saved-billing",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm(),this.on("display",function(){BN.Items.Init()})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.UseSavedAddress=BN.Modal.Checkout.UseSavedAddress||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.UseSavedAddress")};return a.prototype={tplName:"m-used-saved-address",initView:function(){var a=this,b=this.data,c=$(this.modal),d=$(b.target),e=d.attr("href")||"";!b.redirectSuccessUrl&&d.length>-1&&""!=e&&"#"!=e&&("/"==e.substr(0,1)&&(e=SITE_DOMAIN_URL+e),consoleLog(e),b.redirectSuccessUrl=e),this.initGenericView(),this.initForm(),this.on("display",function(){BN.Items.Init(),$(".saved-shipping-address-button-container").height($(".saved-shipping-address-button-container").prev().height())}),c.find(".add-shipping-address").on("click",function(){prevModal=a.flow().get("m-add-shipping"),prevModal?a.flow().goTo("m-add-shipping"):new BN.Modal.Checkout.AddShipping(null,this,null,a)})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout.UseSavedAddressForPostOrderEdit=BN.Modal.Checkout.UseSavedAddressForPostOrderEdit||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.UseSavedAddressForPostOrderEdit"),this.defaultOptions.tplParams={orderNumber:b["order-number"],postOrderEditRequest:"true"}};return a.prototype={tplName:"m-post-order-used-saved-address",initView:function(){var a=this;this.initGenericView(),this.initForm(!1),this.on("display",function(){BN.Items.Init(),$(".saved-shipping-address-button-container").height($(".saved-shipping-address-button-container").prev().last().height()),$(this.modal).find("form").on("amplifiFormSuccess",function(){return new BN.Modal.Checkout.PostOrderDeliveryOptions(null,a.data,null,a),!0})})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.EditShipping=BN.Modal.Checkout.EditShipping||Extend(function(){var a=function(a){consoleLog("Instantiating BN.Modal.Checkout.EditShipping"),consoleLog("Received address data:",a),consoleLog("Getting address ID..."),a&&a.data&&a.data.id&&(this.address=a),consoleLog("Retrieved Address ID: "+this.address.data.id),this.Display()};return a.prototype={address:null,tplName:"m-edit-shipping",defaultVal:null,defaultOptions:{autoDisplay:!1,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){var a=this,b=this.address,c=$(this.modal),d=c.find("form");$errors=c.find("#editShippingErrors"),a.on("display",function(){$("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)})}),c.find("#addAddressCancel").on("click",function(b){b.preventDefault(),a.Close()}),consoleLog("Attaching success listener"),d.on("amplifiFormSuccess",function(a,c){consoleLog("Updating address using values stored in editor",c),b.setValues(c.data),location.reload(!0)}).on("amplifiFormError",function(){a.hideSpinner()}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(d)?a.displaySpinner():a.hideSpinner()}).find("#firstName, #lastName").on("keyup",function(){handleSmartCharacters(this)}),consoleLog("Attempting to add values to editor"),b.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),this.__displayDom();var e=$("#state");e.val(a.address.getDataValue("addressRegion")),modalDisableUsTerritories(c),this.address&&this.address.data&&this.address.data.SpecialCharError&&"undefined"!=typeof this.address.data.SpecialCharError.value&&"true"==this.address.data.SpecialCharError.value&&d.checkValidity()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostUseSavedCC=BN.Modal.Checkout.PostUseSavedCC||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.PostUseSavedCC"),this.defaultOptions.tplParams={orderNumber:b["order-number"],orderId:b["order-number"],postOrderEditRequest:"true"}},b="m-post-use-saved-cc";return $("body").hasClass("anonymous-order-review")&&(b="m-post-use-saved-cc-anonymous"),a.prototype={defaultOptions:{tplParams:null},tplName:b,initView:function(){var a=this.data,b=$(a.target),c=this,d=($(this.modal),b.attr("href")||""),e=a["order-number"];!a.redirectSuccessUrl&&b.length>-1&&""!=d&&"#"!=d&&("/"==d.substr(0,1)&&(d=SITE_DOMAIN_URL+d),consoleLog(d),a.redirectSuccessUrl=d),this.on("display",function(){BN.Items.Init(),$(".saved-shipping-address-button-container").height($(".saved-shipping-address-button-container:last").prev().last().height()),$(this.modal).find("form").on("amplifiFormSuccess",function(a,b){if("true"===$("#CVVValidateForRemorse")[0].value)var d=b.data.cvvRequired;else var d=!1;if("undefined"!=typeof d&&d===!0)return new BN.Modal.Checkout.PostConfirmSecurityCode(null,c.data,null,c),!0;var e=Modal.prototype.openModals;for(var f in e){var g=e[f];g&&g.Close&&g.Close()}window.location.reload(!0)}),$(this.modal).find("form").on("amplifiFormError",function(a,b){var c=webContextRoot+"/account/orders/includes/order-cancel-all.jsp";"true"===b.cancelOrder&&$.ajax({type:"POST",url:c,datatype:"json",data:{orderId:e},success:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)},error:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)}})})}),this.initGenericView(),this.initForm(!1),this.closeEvents.all.push(function(){window.location.href.indexOf("/order-details")>-1&&$(".billing-link").prop("disabled",!1)})}},a}(),BN.Modal.Checkout.Base,"after"),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostAddCC=BN.Modal.Checkout.PostAddCC||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.PostAddCC"),this.defaultOptions.tplParams={orderNumber:b["order-number"],orderId:b["order-number"],postOrderEditRequest:"true"}},b="m-post-add-cc";return $("body").hasClass("anonymous-order-review")&&(b="m-post-add-cc-anonymous"),a.prototype={defaultOptions:{tplParams:null},tplName:b,initView:function(){var a=this.data,c=$(a.target),d=c.attr("href")||"",e=this,f=(this.payment,$(this.modal)),g=f.find("#payWCCLink").attr("href"),h=f.find("form"),i=a["order-number"];$(this.modal).find("form").on("amplifiFormError",function(a,b){var c=webContextRoot+"/account/orders/includes/order-cancel-all.jsp";"true"===b.cancelOrder&&$.ajax({type:"POST",url:c,datatype:"json",data:{orderId:i},success:function(){e.Close(),window.location.reload(!0)},error:function(){e.Close(),window.location.reload(!0)}});var d=b.response.items,f=$(this),g=f.find("input[type='submit']"),h=f.attr("id"),j=b.adiRecomendationCode;if(d.length>0)if("2FAREQUIRED"==d[0].toUpperCase())new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:f,formBtn:g,formId:h,captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}});else if(j&&"DENY"===j.toUpperCase()){var k=f.find("#addNewPaymentDetails");k&&k.length>0&&(k.prop("disabled",!0),k.addClass("adi-deny-button"))}}),!a.redirectSuccessUrl&&c.length>-1&&""!=d&&"#"!=d&&("/"==d.substr(0,1)&&(d=SITE_DOMAIN_URL+d),consoleLog(d),a.redirectSuccessUrl=d),setTimeout(function(){window.location.href=g,initPaymentTabs(f)},10),f.find("#addAddress a.link-with-arrow, #existingAddress a.link-with-arrow").on("click",function(a){a.preventDefault();var b=$(this).parents(".addressSection").first().attr("id"),c=f.find("#addAddress"),d=c.find("input, select"),g=f.find("#existingAddress"),h=f.find("#useNewAddress");if("addAddress"==b){c.hide();for(var i=0;i<d.length;i++){var j=$(d[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&(j.removeAttr("required"),$("#formSubmitValue").val("exsistAddress"))}g.show(),e.clearForm(c)}else{c.show();for(var i=0;i<d.length;i++){var j=$(d[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&(j.attr("required","required"),$("#formSubmitValue").val("addAddress"))}g.hide(),h.click()}e.RefreshPosition()}),f.find(".expand-cvv-container").hide(),f.find("#useShippingAddress").on("click",function(){$(this).prop("checked")?($("#addressInputs").addClass("no-display"),$("#emailAddress").closest("fieldset").css("margin-bottom","10px"),$("#addPaymentSavedAddress").find("input").not("#emailAddress").removeAttr("required")):($("#addressInputs").removeClass("no-display"),$("#emailAddress").closest("fieldset").css("margin-bottom","0"),$("#addPaymentSavedAddress").find("#country, #firstName, #lastName, #phoneNumber, #streetAddress, #city, #state, #zipCode").attr("required","required"))}),f.find(".expand-cvv").on("click",function(){f.find(".expand-cvv-container").toggle(),f.find(".expand-cvv").toggleClass("expandicon-change")}),this.initGenericView(),this.initForm(!0),this.on("display",function(){var a=this;$("body").hasClass("lt-ie9")&&initPaymentTabs(f),$("#useShippingAddress").on("change",function(){togglePaymentBillingAddressForm()}),$("[data-tabs]").tabs(),updateNookForwardUrl(),$("body").hasClass("nook-login-page")?$("select").selectBox():initPaymentTabs(f),$('li[role="presentation"]:last').on("click",function(){$(".modal-add-credit-card").length>1?($(".modal-add-credit-card .payPalButtonRenderer").last().addClass("payPalButtonRendererLast"+$(".modal-add-credit-card").length),$(".paypal-button-container").is(":visible")||initPaypalExpress(".modal-add-credit-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length),modalObjToReset=a):($(".paypal-button-container").is(":visible")||initPaypalExpress(".modal-add-credit-card .payPalButtonRenderer"),modalObjToReset=a)}),$(".add-cc-tooltip").tooltip(),$(".tooltip-icon-info").on("keypress",function(a){var b=a.which;13==b&&$(".tooltip-icon-info").click()}),h.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(h)?(consoleLog("in display spin"),e.displaySpinner()):(consoleLog("in hide "),e.hideSpinner())}),"m-post-add-cc"===b&&loadADIScript("paymentMethod")})}},a}(),BN.Modal.Checkout.Base,"after"),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.AddCC=BN.Modal.Checkout.AddCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.AddCC")},b="m-add-cc";$("body").hasClass("anonymous-order-review")&&(b="m-add-cc-anonymous");var c={};return"true"==$("#isEgiftLogin").val()&&(c={tplParams:{isEgift:"true"},useCache:!1}),a.prototype={tplName:b,defaultOptions:c,initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=this,e=(this.payment,$(this.modal)),f=e.find("#payWCCLink"),g=e.find("#payWPPLink"),h=e.find("form");if(f.on("keydown",function(a){13===a.keyCode&&setTimeout(function(){$(a.target).focus(),$(a.target).addClass("focus")},500)}),g.on("keydown",function(a){13===a.keyCode&&setTimeout(function(){$(a.target).focus(),$(a.target).addClass("focus")},500)}),f.on("click",function(){$(".add-credit-card-form").show(),$(".add-credit-card-form").attr("aria-hidden",!1),$(".other-payment-mode").hide(),$(".other-payment-mode").attr("aria-hidden",!0),resetModalTabbing(d,!1)}),g.on("click",function(){$(".add-credit-card-form").hide(),$(".add-credit-card-form").attr("aria-hidden",!0),$(".other-payment-mode").show(),$(".other-payment-mode").attr("aria-hidden",!1),resetModalTabbing(d,!0)}),!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),e.find("#addAddress a.link-with-arrow, #existingAddress a.link-with-arrow").on("click",function(a){a.preventDefault();var b=$(this).parents(".addressSection").first().attr("id"),c=e.find("#addAddress"),f=c.find("input, select"),g=e.find("#existingAddress"),h=e.find("#useNewAddress");if("addAddress"==b){c.hide();for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&(j.removeAttr("required"),$("#formSubmitValue").val("exsistAddress"))}g.show(),d.clearForm(c)}else{c.show();for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&"country"!=j.attr("id")&&(j.attr("required","required"),$("#formSubmitValue").val("addAddress"))}g.hide(),h.click()}d.RefreshPosition()}),e.find(".expand-cvv-container").hide(),e.find(".expand-cvv").on("click",function(){e.find(".expand-cvv-container").toggle(),e.find(".expand-cvv").toggleClass("expandicon-change")}),this.initGenericView(),$("body").hasClass("nook-login-page"))BN.uXHR.Form.apply(h),h.on("amplifiFormBeforeSubmit",function(){consoleLog("Calling displaySpinner in nooklogin addcc"),d.hideSpinner(),d.displaySpinner()}).on("amplifiFormError",function(){d.hideSpinner()}).on("amplifiFormSuccess",function(){redirectToNook()});else{this.initForm();var e=$(this.modal),h=$(this.modal).find("#addPaymentSavedAddress");
this.on("display",function(){var a=h.find("input[autofocus]");a.length&&a.focus()})}this.on("display",function(){var a=this,b="true"==$("#masterpassUpgradedNewLogic").val();masterPassConfigure(b),$("body").hasClass("lt-ie9")&&initPaymentTabs(),$("#addPaymentSavedAddress").find("#ccMonth~div ul").removeAttr("role"),$("#addPaymentSavedAddress").find("#ccYear~div ul").removeAttr("role"),$("#useShippingAddress").on("change",function(){togglePaymentBillingAddressForm()}),$("[data-tabs]").tabs(),updateNookForwardUrl(),$("body").hasClass("nook-login-page")?$("select").selectBox():initPaymentTabs(e),$('li[role="presentation"]:last').on("click",function(){$(".modal-add-credit-card").length>1?($(".modal-add-credit-card .payPalButtonRenderer").last().addClass("payPalButtonRendererLast"+$(".modal-add-credit-card").length),!$(".modal-add-credit-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length).children().length>0&&(initPaypalExpress(".modal-add-credit-card .payPalButtonRendererLast"+$(".modal-add-credit-card").length),modalObjToReset=a)):(!$(".modal-add-credit-card .payPalButtonRenderer").children().length>0&&initPaypalExpress(".modal-add-credit-card .payPalButtonRenderer"),modalObjToReset=a)}),$("#paymentOptions").find(".tab").removeAttr("aria-controls"),$(".add-cc-tooltip").tooltip(),$(".tooltip-icon-info").on("keypress",function(a){var b=a.which;13==b&&$(".tooltip-icon-info").click()}),$(".tooltip a").keydown(function(a){a.shiftKey&&9===a.keyCode||!a.shiftKey&&9===a.keyCode?($(this).focus(),$(this).addClass("focus")):13===a.keyCode&&$(this).click(),a.preventDefault(),a.stopPropagation()}),$("#emailAddress").on("keydown",function(a){focusInGuestAdd(a)}),$("#addAddressSubmit").on("keydown",function(a){focusInGuestAdd(a)}),h.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){$("aside#payPalShipingAddressError").hide(),BN.Validate.HasErrors(h)?(consoleLog("in display spin"),d.displaySpinner()):(consoleLog("in hide "),d.hideSpinner())});var c=$("form#addPaymentSavedAddress").find("#paymentBillingAddress");$("#addAddressSubmit").on("click",function(){$("#useShippingAddress").is(":checked")&&c.length>0&&c.clearForm(c)})})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostOrderEditShipping=BN.Modal.Checkout.PostOrderEditShipping||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.PostOrderEditShipping"),this.defaultOptions.tplParams={orderNumber:b["order-number"],shippingId:b["shipping-id"],postOrderEditRequest:"true"}};return a.prototype={tplName:"m-post-order-edit-shipping",initView:function(){var a=this,b=$(this.modal),c=b.find("#addAddress"),d=c.find("input[type=submit]");c.on("submit",function(){d.blur(),d.css("opacity","0.5"),consoleLog("in display spin"),a.displaySpinner()}).on("amplifiFormError",function(){consoleLog("hide on form error"),a.hideSpinner(),d.css("opacity","1")}).on("amplifiFormSuccess",function(){return new BN.Modal.Checkout.PostOrderDeliveryOptions(null,a.data,null,a),!0}),this.initGenericView(),this.initForm(!1),a.on("display",function(){modalDisableUsTerritories(b)}),this.closeEvents.all.push(function(){window.location.href.indexOf("/order-details")>-1&&$(".billing-link").prop("disabled",!1)})}},a}(),BN.Modal.Checkout.Base,"after"),BN.Modal.PrintMag=BN.Modal.PrintMag||{},BN.Modal.PrintMag.Base=BN.Modal.PrintMag.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.PrintMag.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},initFrameForm:function(a){var b=this;$(window).on("amplifiFrameFormSuccess",function(c,d){var e=b.data,f=window.location.toString().split("#")[0];return a===!1||e.redirect===!1?(loadDynamicHeaderElements(),void consoleLog("Success!")):(null!=d&&void 0!=d&&d instanceof Object&&d.redirectSuccessUrl&&""!=d.redirectSuccessUrl?f=d.redirectSuccessUrl:null!=d&&void 0!=d&&d instanceof Object&&d.redirect&&""!=d.redirect?f=d.redirect:null!=e&&void 0!=e&&e instanceof Object&&e.redirectSuccessUrl&&""!=e.redirectSuccessUrl&&(f=e.redirectSuccessUrl),consoleLog("Success! Redirecting page to "+f),void(window.location=f))})}},a}(),BN.Modal.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ExtendedWarrantyDetails=BN.Modal.Checkout.ExtendedWarrantyDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.ExtendedWarrantyDetails")};return a.prototype={tplName:"m-extended-warranty-details",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostOrderDeliveryOptions=BN.Modal.Checkout.PostOrderDeliveryOptions||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.PostOrderDeliveryOptions")};return a.prototype={tplName:"m-post-order-delivery-options",initView:function(){this.parentClass.prototype.initView.apply(this,arguments);var a=this,b=this.data,c=$(this.modal),d=b["order-number"];c.find(".btn-submit").on("click",function(){c.find('input.hidden[type="submit"]').click()}),c.find("form").on("amplifiFormSuccess",function(b,c){var d=c.data.cvvRequired;if(d===!0&&"undefined"!=typeof d)return new BN.Modal.Checkout.PostConfirmSecurityCode(null,a.data,null,a),!0;var e=Modal.prototype.openModals;for(var f in e){var g=e[f];g&&g.Close&&g.Close()}window.location.reload(!0)}),$(this.modal).find("form").on("amplifiFormError",function(a,b){var c=webContextRoot+"/account/orders/includes/order-cancel-all.jsp";"true"===b.cancelOrder&&$.ajax({type:"POST",url:c,datatype:"json",data:{orderId:d},success:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)},error:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)}})});var e=c.find(".delivery-method:checked");e.length<1&&c.find(".delivery-method:eq(0)").click(),this.initGenericView(),this.initForm(!1),this.closeEvents.all.push(function(){window.location.href.indexOf("/order-details")>-1&&$(".billing-link").prop("disabled",!1)})}},a}(),BN.Modal.Checkout.PostOrderEditShipping,"after"),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostConfirmSecurityCode=BN.Modal.Checkout.PostConfirmSecurityCode||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.PostConfirmSecurityCode"),this.defaultOptions.tplParams={orderNumber:b["order-number"],orderId:b["order-number"],postOrderEditRequest:"true"}};return a.prototype={tplName:"m-confirm-security-code-ra",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"",d=$(this.modal),e=a["order-number"];!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),d.find("#checkCVV").on("amplifiFormSuccess",function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}}),d.find("#checkCVV").on("amplifiFormError",function(a,b){var c=webContextRoot+"/account/orders/includes/order-cancel-all.jsp";"true"===b.cancelOrder&&$.ajax({type:"POST",url:c,datatype:"json",data:{orderId:e},success:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)},error:function(){var a=Modal.prototype.openModals;for(var b in a){var c=a[b];c&&c.Close&&c.Close()}window.location.reload(!0)}})}),d.find(".expand-cvv-container").hide(),d.find(".expand-cvv").on("click",function(){d.find(".expand-cvv-container").toggle(),d.find(".expand-cvv").toggleClass("expandicon-change")}),this.initGenericView(),this.initForm(!0),this.on("display",function(){$(".confirm-security-code-tooltip").tooltip()})}},a}(),BN.Modal.Checkout.Base,"after"),BN.Modal.Textbook=BN.Modal.PrintMag||{},BN.Modal.PrintMag.Terms=BN.Modal.PrintMag.Terms||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.PrintMag.Terms")};return a.prototype={tplName:"m-print-mag-terms",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.PrintMag.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.GiftWithPurchaseCart=BN.Modal.Checkout.GiftWithPurchaseCart||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Checkout.GiftWithPurchaseCart")};return a.prototype={tplName:"m-gift-with-purchase-cart",initView:function(){var a=this.data,b=$(this.modal);consoleLog("closeEvents for m-gift-with-purchase-cart modal = ",this.closeEvents),a&&(a.title&&"string"==typeof a.title&&b.find("#dialog-title").text(a.title),a.onClose&&this.closeEvents.all.push(a.onClose),!a.messages)}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PostOrderEditCC=BN.Modal.Checkout.PostOrderEditCC||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Checkout.PostOrderEditCC"),this.defaultOptions.tplParams={orderNumber:b["order-number"],orderId:b["order-number"],postOrderEditRequest:"true"}};return a.prototype={defaultOptions:{tplParams:null},tplName:"m-post-order-edit-cc",initView:function(){var a=this,b=a.data,c=$(this.modal),d=b["order-number"];c.find("form").on("amplifiFormSuccess",function(){a.Close()}),c.find("form").on("amplifiFormError",function(b,c){var e=webContextRoot+"/account/orders/includes/order-cancel-all.jsp";"true"===c.cancelOrder&&$.ajax({type:"POST",url:e,datatype:"json",data:{orderId:d},complete:function(){a.Close(),window.location.reload(!0)}})}),this.on("display",function(){$(".add-cc-tooltip").tooltip(),$(".tooltip-icon-info").on("keypress",function(a){var b=a.which;13==b&&$(".tooltip-icon-info").click()})}),c.find(".expand-cvv").on("click",function(){c.find(".expand-cvv-container").toggle(),c.find(".expand-cvv").toggleClass("expandicon-change")}),this.initGenericView(),this.initForm(!0)}},a}(),BN.Modal.Checkout.Base,"after"),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ItemEligibility=BN.Modal.Checkout.ItemEligibility||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.ItemEligibility")};return a.prototype={tplName:"m-item-eligibility",initView:function(){this.initGenericView()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.EGiftPurchaseEdit=BN.Modal.Checkout.EGiftPurchaseEdit||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.EditGiftDetails")};return a.prototype={tplName:"egift-purchase-edit",initView:function(){this.initGenericView(),this.initForm(),$modal=$(this.modal),$giftIcon=$modal.find(".icon-calendar"),$giftInput=$modal.find(".egift-date"),$availableDate=""==$(".cart-edit-egift-item").attr("data-available-date")?0:new Date($(".cart-edit-egift-item").attr("data-available-date")),this.on("display",function(){initializeTextAreaCounter($modal.find("textarea"),$modal.find(".limit-notifier")),$("[id^=giftWrapMessage]").attr("required","required");var a=$modal.find("textarea.gift-message").val(),b=a.length,c=$modal.find(".steel").text(),d=c.split("/")[1];b>0&&$modal.find(".limit-notifier").text(d-b),initEGiftYear()}),$giftIcon.on("click",function(){$giftInput.datepicker("show")}),$giftInput.datepicker({showOn:"button",buttonImage:"/static/img/sprites/calendar-up.png",buttonImageOnly:!0,minDate:$availableDate,maxDate:"+1Y",showOn:"both",onClose:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-up.png"),$(".modal__header").find("h2").attr("aria-hidden","false"),$(".buy-as-egift").parent().parent().attr("aria-hidden","false")},beforeShow:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-down.png"),$(".modal__header").find("h2").attr("aria-hidden","true"),$(".buy-as-egift").parent().parent().attr("aria-hidden","true"),setTimeout(function(){var a=$(".ui-datepicker-month").text(),b=$(".ui-datepicker-year").text();$(".ui-datepicker-calendar").find("td").each(function(){var c=$(this).find(".ui-state-default").text(),d=a+" "+c+", "+b;$(this).find(".ui-state-default").attr("aria-label",d)}),$(".ui-datepicker-prev").attr("href","#"),$(".ui-datepicker-next").attr("href","#"),$(".ui-datepicker-prev").hasClass("ui-state-disabled")?($("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):($("#ui-datepicker-div .ui-datepicker-prev").focus(),$("#ui-datepicker-div .ui-datepicker-prev").addClass("focus"))},100)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-prev").attr("href","#"),$(".ui-datepicker-next").attr("href","#"),$(".ui-datepicker-prev").hasClass("ui-state-disabled")?($("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):($("#ui-datepicker-div .ui-datepicker-prev").focus(),$("#ui-datepicker-div .ui-datepicker-prev").addClass("focus"))},100)}}).on("change",function(){var a=$giftInput.val().split("/");""!==a&&$giftInput.closest(".text-input").removeClass("invalid"),$modal.find("#eGiftMonth").val(a[0]),$modal.find("#eGiftDay").val(a[1]),$modal.find("#eGiftYear").val(a[2]),$(".text-input-with-calendar").focus(),$(".text-input-with-calendar").addClass("focus"),setTimeout(function(){$(".egift-recipient").focus()},100)}),$(document).on("keydown",function(a){9===a.which&&($(".ui-datepicker-calendar").hasClass("focus")&&(a.shiftKey||($(a.target).parent().next().hasClass("ui-datepicker-other-month")?(a.preventDefault(),$("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):0===$(a.target).parent().parent().next().length&&0===$(a.target).parent().next().length&&(a.preventDefault(),$("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")))),a.shiftKey&&($(a.target).hasClass("ui-datepicker-prev")||$(a.target).hasClass("ui-datepicker-next"))&&($(a.target).hasClass("ui-datepicker-next")?$(".ui-datepicker-prev").hasClass("ui-state-disabled")&&($giftInput.datepicker("hide"),$giftInput.parents(".row").prev().find("label").last().siblings("input").each(function(){"hidden"!==$(this).attr("type")&&$(this).focus()}),a.preventDefault()):$(a.target).hasClass("ui-datepicker-prev")&&($giftInput.datepicker("hide"),$giftInput.parents(".row").prev().find("label").last().siblings("input").each(function(){"hidden"!==$(this).attr("type")&&$(this).focus()}),a.preventDefault())))})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.MakeItAGift=BN.Modal.Checkout.MakeItAGift||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Login")};return a.prototype={tplName:"m-make-it-a-gift",initView:function(){{var a=this,b=this.data,c=$(b.target);c.attr("href")||""}this.on("display",function(){var b=$(this.modal),c=b.find("form"),d=$(".modal-gift-options textarea"),e=$(".giftingOptions input[type='checkbox']:not(:disabled), .giftingOptions textarea:not(:disabled)");BN.uXHR.Form.apply(c),c.on("amplifiFormSuccess",function(){location.reload(!0)}),d.length&&initializeTextAreaCounter(d,d.parent().find(".limit-notifier")),$("#giftItemRecieptCheck").on("change",function(){$(this).is(":checked")?($(".warning__notes").addClass("hidden"),$(".giftingOptions").removeClass("gift-optn-disabled"),e.removeAttr("disabled"),$(this).off("keydown")):($(".warning__notes").removeClass("hidden"),$(".giftingOptions").addClass("gift-optn-disabled"),e.attr("disabled","true"),$(this).on("keydown",function(a){9==a.keyCode&&a.shiftKey&&b.find(".icon-close-modal").focus().addClass("focus"),9!=a.keyCode||a.shiftKey||b.find(".btn-submit").focus().addClass("focus")}))}),$(".gift-msg-chck").on("change",function(){$(this).is(":checked")?($(".giftWrapMessage").attr("tabindex","0"),$(".gift-text-message").show("fast",function(){resetModalTabbing(a,!1)}),$(".giftWrapMessage").removeAttr("disabled")):($(".giftWrapMessage").attr("tabindex","-1"),$(".gift-text-message").hide("fast",function(){resetModalTabbing(a,!1)}),$(".giftWrapMessage").attr("disabled","true"))}),b.find(".btn-submit").on("keydown",function(a){$(".giftingOptions").hasClass("gift-optn-disabled")&&9==a.keyCode&&a.shiftKey&&$("#giftItemRecieptCheck").focus().addClass("focus")})})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PaypalAddBilling=BN.Modal.Checkout.PaypalAddBilling||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.PaypalAddBilling")};return a.prototype={tplName:"m-paypal-add-billing",initView:function(){var a=this.data,b=$(a.target),c=(a["view-type"]||"",b.attr("href")||""),d=this,e=$(this.modal),f=e.find("form");!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),a.initialErrors&&(BN.Validate.DisplayErrors(f,a.initialErrors),delete a.initialErrors),d.initGenericView(),d.initForm(),this.on("display",function(){$(".paypal-save-billing-link").on("click",function(){new BN.Modal.Checkout.PaypalUseSavedBillingAddr(null,{target:this},{useCache:!1,tplParams:{paymentgrouptypesavebilling:$(this).data("paymentgrouptypesavebilling")}})}),initializeTextAreaCounter($("textarea#wishlistDescription"),$(".limit-notifier")),$("#selectWishlist").change()}),f.on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(f)?d.displaySpinner():d.hideSpinner()})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.RentalTermsConditions=BN.Modal.Checkout.RentalTermsConditions||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.RentalTermsConditions")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},tplName:"m-rental-terms-conditions",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.SetDefaultCC=BN.Modal.Checkout.SetDefaultCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.SetDefaultCC")};return a.prototype={tplName:"m-set-default-payment",initView:function(){this.initGenericView(),this.initForm()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.CheckoutEditCCInformation=BN.Modal.Checkout.CheckoutEditCCInformation||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.CheckoutEditCCInformation")};return a.prototype={tplName:"m-edit-cc-information",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.EditBilling=BN.Modal.Checkout.EditBilling||Extend(function(){var a=function(a){consoleLog("Instantiating BN.Modal.Checkout.EditBilling"),consoleLog("Received address data:",a),consoleLog("Getting address ID..."),a&&a.data&&a.data.id&&(this.address=a),consoleLog("Retrieved Address ID: "+this.address.data.id),this.Display()};return a.prototype={address:null,tplName:"m-edit-billing",defaultVal:null,defaultOptions:{autoDisplay:!1,manualDisplayDom:!0,modalIsScrollable:!0},initView:function(){var a=this,b=this.address,c=$(this.modal),d=c.find("form");c.find("#addAddressCancel").on("click",function(b){b.preventDefault(),a.Close()}),consoleLog("Attaching success listener"),d.on("amplifiFormSuccess",function(a,c){consoleLog("Updating address using values stored in editor",c),b.setValues(c.data),window.location=window.location}).on("amplifiCountryChange",function(){}).on("result.QAS",function(){}).find('[type="submit"]').on("click",function(){BN.Validate.HasErrors(d)?a.displaySpinner():a.hideSpinner()}),consoleLog("Attempting to add values to editor"),b.fillEditor(this.modal),consoleLog("Initializing Generic View"),this.initGenericView(),consoleLog("Initializing Modal Form"),this.initForm(!1),this.__displayDom();var e=$("#state");e.val(a.address.getDataValue("addressRegion"))}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.DisableShipping=BN.Modal.Checkout.DisableShipping||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.DisableShipping")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},tplName:"m-disable-shipping",initView:function(){this.initGenericView(),this.initForm(!1),"undefined"!=typeof this.data&&null!=this.data&&"undefined"!=typeof this.data.onClose&&this.closeEvents.all.push(this.data.onClose)}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.AddDefaultCC=BN.Modal.Checkout.AddDefaultCC||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.AddDefaultCC")};return a.prototype={tplName:"m-add-default-payment",initView:function(){{var a=this,b=$(this.modal);b.find("form")}b.find("#addAddress .link-with-arrow , #existingAddress .link-with-arrow").on("click",function(c){c.preventDefault();var d=$(this).parents(".addressSection").attr("id"),e=b.find("#addAddress"),f=e.find("input, select"),g=b.find("#existingAddress"),h=b.find("#useNewAddress");if("addAddress"==d){e.hide(),e.attr("aria-hidden","true"),g.show(),g.attr("aria-hidden","false"),a.clearForm(e);for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&(j.removeAttr("required"),$("#formSubmitValue").val("exsistAddress"))}}else{e.show(),e.attr("aria-hidden","false"),g.hide(),g.attr("aria-hidden","true"),a.clearForm(g);for(var i=0;i<f.length;i++){var j=$(f[i]);"aptSuite"!=j.attr("id")&&"companyName"!=j.attr("id")&&"country"!=j.attr("id")&&(j.attr("required","required"),$("#formSubmitValue").val("addAddress"))}h.click()}}),this.initGenericView(),this.initForm(),this.on("display",function(){$("#addPaymentSavedAddress").find("#cardExpDate~div ul").removeAttr("role"),$("#addPaymentSavedAddress").find("#cardExpYear~div ul").removeAttr("role")})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.ValidateRewards=BN.Modal.Checkout.ValidateRewards||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.ValidateRewards")};return a.prototype={tplName:"m-checkout-rewards-validate-email",initView:function(){var a=$(this.modal),b=this;this.initGenericView(),this.initForm(!1),a.find(".icon-close-modal").on("click",function(){b.Close(),location.reload()}),this.on("display",function(){$("#ContinueCheckout").on("click",function(){b.Close(),location.reload()})})}},a}(),BN.Modal.Checkout.Base,!0),BN.Modal.Checkout=BN.Modal.Checkout||{},BN.Modal.Checkout.PaypalUseSavedBillingAddr=BN.Modal.Checkout.PaypalUseSavedBillingAddr||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Checkout.PaypalUseSavedBillingAddr")};return a.prototype={tplName:"m-paypal-use-saved-billing",initView:function(){{var a=this.data,b=$(a.target),c=b.attr("href")||"";$(this.modal)}!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm(),this.on("display",function(){BN.Items.Init(),$(".paypal-add-billing-link").on("click",function(){new BN.Modal.Checkout.PaypalAddBilling(null,{target:this},{useCache:!1,tplParams:{paymentgrouptypeaddbilling:$(this).data("paymentgrouptypeaddbilling")}})}),$(".saved-shipping-address-button-container").height($(".saved-shipping-address-button-container").prev().height())})}},a}(),BN.Modal.Checkout.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
function bindWishListForm(){BN.uXHR.Form.apply($("#quick-view-productDetail form[id^=addItemToWishlist1test]")),BN.uXHR.Form.apply($("#quick-view-productDetail form[id^=frmRemoveGiftItemtest]")),"true"==$("#quick-view-productDetail form[id^=addItemToWishlist1test]").siblings("label").attr("data-aria-selected")&&$("#quick-view-productDetail .pdp-wishlist #add-wishlist").html("Added to Wishlist"),$("#quick-view-productDetail [id^=label-score-]").on("click",function(){userWishlistAdd(this)}),$("#quick-view-productDetail [id^=guest-label-score-]").on("click",function(){guestWishlistAdd(this)}),$("#quick-view-productDetail .pdp-wishlist #add-wishlist").on("click",function(){$("#quick-view-productDetail [id^=guest-label-score-]").length>0?$("#quick-view-productDetail [id^=guest-label-score-]").click():$("#quick-view-productDetail [id^=label-score-]").length>0&&$("#quick-view-productDetail [id^=label-score-]").click()}),$("#quick-view-productDetail form[id^=addItemToWishlist1test]").on("amplifiFormError",function(){$(this).siblings("[id^=guest-label-score-]").removeClass("disabled"),$(this).siblings("[id*=label-score-]").removeClass("disabled"),addWishlistError(this)}).on("amplifiFormBeforeSubmit",function(){$(this).siblings("[id*=label-score-]").addClass("disabled")}).on("amplifiFormSuccess",function(a,b){$(this).siblings("[id^=guest-label-score-]").removeClass("disabled"),$(this).siblings("[id*=label-score-]").removeClass("disabled"),$("#quick-view-productDetail .pdp-wishlist #add-wishlist").html("Added to Wishlist"),addWishlistSuccess(this,b)}),$("#quick-view-productDetail form[id^=frmRemoveGiftItemtest]").on("amplifiFormError",function(){$(this).siblings("[id^=guest-label-score-]").removeClass("disabled"),$(this).siblings("[id*=label-score-]").removeClass("disabled"),removeWishlistError(this)}).on("amplifiFormBeforeSubmit",function(){$(this).siblings("[id*=label-score-]").addClass("disabled")}).on("amplifiFormSuccess",function(a,b){$(this).siblings("[id^=guest-label-score-]").removeClass("disabled"),$(this).siblings("[id*=label-score-]").removeClass("disabled"),$("#quick-view-productDetail .pdp-wishlist #add-wishlist").html("Add to Wishlist"),removeWishlistSuccess(this,b)}),$("#quick-view-productDetail .product-shelf-favorite").find("label").on("keydown",function(a){13==a.keyCode&&($(this).trigger("click"),$(this).focus())})}BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Base=BN.Modal.Browse.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/search/"}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.UsedGoodCondition=BN.Modal.Browse.UsedGoodCondition||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.UsedGoodCondition")};return a.prototype={tplName:"m-usedgood-condition",defaultOptions:{useCache:!1,tplDir:SITE_ROOT+"/modals/textbook/"},initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{};var moreTabClickedInAllFormatModal=!1;BN.Modal.Browse.Formats=BN.Modal.Browse.Formats||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Formats")};return a.prototype={tplName:"allFormats-ra",defaultOptions:{useCache:!1},initView:function(){var a=this,b=$dom=$(this.modal),c=$(this.data.target),d=(c.attr("id"),c.attr("data-formatsUrl")||this.userOptions.tplParams.formatsurl),e=$("body").hasClass("pdpPage"),f=(c.data("formats-edition")?c.data("formats-edition"):!1,c.attr("data-product-id")||c.attr("id")),g=c.data("work-id")||this.userOptions.tplParams.workId,h=c.attr("data-sku-id")||this.userOptions.tplParams.skuId,i=c.attr("data-digital-ean"),j=(c.attr("data-total-formats"),c.attr("data-ismarketplace"));"https:"===SITE_PROTOCOL&&-1!=d.indexOf("http:")&&(d=d.replace("http","https")),this.displaySpinner(),("undefined"==typeof this.productName||""==this.productName)&&this.getProductNameByURL(c.closest("#prodSummary-header").length>0?THIS_PATH:c.attr("data-pd-quickview-url")),b.find("#open-prod-details").attr("data-ismarketplace",j),this.on("display",function(){b.find("#pdpModalContent").load(d,function(){b.find(".tabgroup div.tab-contentshow").hide(),$("#"+$(this).attr("data-tabval")).show(),b.find("#otherAvailableFormatsContainer .actions form span").hide(),$("#product-all-formats").tabs(),a.$spinner.remove(),b.find("div.format-list-container").first().show(),b.find(".alt-format").hide(),("false"==e||0==e)&&(b.find("#qvTitleBar li:first").siblings().find("a#open-prod-details").show(),("true"==j||1==j)&&b.find("#qvTitleBar li:first").siblings().find("a.open-marketplace").show()),b.find(".tabgroup h3:first-child a").addClass("activeTab").attr({"aria-selected":"true"}),b.find(".tabgroup h3:first-child").next("section").show(),b.find('.tabgroup li[role="presentation"] a').on("click",function(a){a.preventDefault();var c=$("#allFormatsTabLimit").val();b.find(".tabgroup div.tab-contentshow").hide(),$("#"+$(this).attr("data-tabval")).show(),b.find(".tabgroup li a").each(function(){$(this).removeClass("activeTab").attr({"aria-selected":"false"})}),$(this).addClass("activeTab").attr({"aria-selected":"true"});var d=$(a.target);(d.hasClass("link-with-left-arrow")||d.children().hasClass("link-with-left-arrow"))&&(d=d.parents(".more-tab")),d.hasClass("more-tab")?"true"==d.attr("show-menu")?($('.tabgroup li[role="presentation"]').each(function(a){c>a?$(this).hide():a>c&&$(this).show()}),d.attr("show-menu",!1),d.removeClass("link-with-arrow"),d.find(".left-arrow-wrapper").show(),d.parent().next().find("a").click()):($('.tabgroup li[role="presentation"]').each(function(a){c>a?$(this).show():a>c&&$(this).hide()}),d.attr("show-menu",!0),d.addClass("link-with-arrow"),d.find(".left-arrow-wrapper").hide(),d.parent().prev().find("a").click()):d.hasClass("more-text")?"true"==d.parents(".more-tab").attr("show-menu")?($('.tabgroup li[role="presentation"]').each(function(a){c>a?$(this).hide():a>c&&$(this).show()}),d.parents(".more-tab").attr("show-menu",!1),d.parents(".more-tab").removeClass("link-with-arrow"),d.parents(".more-tab").find(".left-arrow-wrapper").show(),d.parents(".more-tab").parent().next().find("a").click()):($('.tabgroup li[role="presentation"]').each(function(a){c>a?$(this).show():a>c&&$(this).hide()}),d.parents(".more-tab").attr("show-menu",!0),d.parents(".more-tab").addClass("link-with-arrow"),d.parents(".more-tab").find(".left-arrow-wrapper").hide(),d.parents(".more-tab").parent().prev().find("a").click()):(b.find(".tabgroup div.tab-contentshow").hide(),$("#"+$(this).attr("data-tabval")).show(),b.find(".tabgroup li a").each(function(){$(this).removeClass("activeTab").attr({"aria-selected":"false"})}),$(this).addClass("activeTab").attr({"aria-selected":"true"}))}),$(".formats-accordion:first").attr("aria-expanded","true"),$(".formats-accordion").on("click",function(){$(".format-list-container").hide(),$(".formats-accordion").not(this).attr("aria-expanded","false"),"false"===$(this).attr("aria-expanded")?($("#"+$(this).attr("data-productId")).show(),$(this).attr("aria-expanded","true")):($("#"+$(this).attr("data-productId")).hide(),$(this).attr("aria-expanded","false"))}),$(".format-list-container").on("scroll",function(c){var d=$(c.currentTarget),e=$(this).find(".section-items"),f=e.attr("data-total-items"),j=e.attr("data-format-type");if(d[0].scrollHeight-d.scrollTop()==d.outerHeight()){var k=e.children().length,l=parseInt(e.children().last().attr("data-start")),m=parseInt(e.children().last().attr("data-end"));f>k&&(l+=10,m+=10,$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/all-format-list-content.jsp",type:"get",cache:!1,data:{skuId:h,workId:g,digitalEan:i,format:j,start:l,end:m},dataType:"html",beforeSend:function(){a.displaySpinner()}}).done(function(c){e.append(c),attachCartAction(!0),b.find("#otherAvailableFormatsContainer .actions form span").hide(),setTimeout(function(){a.$spinner.remove()},500)}))}}),attachCartAction(!0);var c=1;$($(".tab-list").children(":visible")).each(function(){$(this).find("a").attr("tabindex",c+1),c++}),$($(".format-list-container:visible").find(".section-items").children()).each(function(){$(this).find(":tabbable").each(function(){$(this).attr("tabindex",c+1),c++})}),$($(".tab-list").children()).each(function(){$(this).find("a").on("keydown",function(a){13===a.keyCode&&(moreTabClickedInAllFormatModal=$(a.target).hasClass("more-tab")?!0:!1,a.preventDefault(),a.stopPropagation(),$("body").attr("aria-hidden","true"),$("body").attr("tabindex","-1"),$(".modal__dialog .modal__content .modal__body").attr("aria-hidden","true"),$(".modal__dialog .modal__content .modal__body").attr("tabindex","-1"),$(a.target).click(),setTimeout(function(){var a=1;$($(".tab-list").children(":visible")).each(function(){$(this).find("a").attr("tabindex",a+1),a++}),$($(".tab-list").children(":hidden")).each(function(){$(this).find("a").removeAttr("tabindex")});var b=0;$($(".format-list-container:visible").find(".section-items").children()).each(function(){b++;$(this);$(this).find(":tabbable").each(function(){$(this).attr("tabindex",a+1),a++})}),$($(".format-list-container:hidden").find(".section-items").children()).each(function(){$(this).find("a, input, select").removeAttr("tabindex")}),moreTabClickedInAllFormatModal?$(".more-tab").focus():$("#product-all-formats ul.tab-list a[aria-selected='true']").focus(),$("body").removeAttr("aria-hidden"),$("body").removeAttr("tabindex"),$(".modal__dialog .modal__content .modal__body").removeAttr("aria-hidden"),$(".modal__dialog .modal__content .modal__body").removeAttr("tabindex")},500))})}),b.find(".icon-close-modal").keydown(function(a){a.shiftKey&&9==a.keyCode?($(".pdpAddToWishlistLink").focus(),a.stopPropagation(),a.preventDefault()):!e&&"true"!=e||a.shiftKey||9!=a.keyCode||(a.stopPropagation(),$("#productInfoTabs li a").removeAttr("tabindex"))})});var c=this.flow().get("quickview"),k=b.find("#open-prod-details"),l=a.flow().get("marketplace"),m=$(a.modal).find(".open-marketplace");l&&l.pureModal?(m.removeAttr("data-sku-id"),m.removeAttr("data-product-id"),m.removeAttr("data-modal-class"),m.removeAttr("data-formats-edition"),m.attr("data-crumb","marketplace"),m.each(function(){a.__initCrumbEvent(this)})):(m.attr("data-sku-id",h),m.attr("data-product-id",f),m.attr("data-work-id",g),m.attr("data-modal-class","BN.Modal.Browse.Marketplace"),m.attr("data-formats-edition","true"),m.attr("data-formatsUrl",d),m.attr("data-ismarketplace",j)),c&&c.pureModal?(this.__initCrumbEvent(k.attr("data-crumb","quickview").get(0)),$dom.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(c.modal)),$("#pdpModalContent").show()})):$(this.data.target).attr("data-pd-modal")&&$dom.find("#qvTitleBar").find("a#open-prod-details").attr({"data-modal-class":"BN.Modal.Browse.Quickview",href:$(this.data.target).attr("data-pd-modal"),"data-quickview-url":$(this.data.target).attr("data-pd-quickview-url"),"data-work-id":$(this.data.target).attr("data-work-id"),"data-sku-id":$(this.data.target).attr("data-sku-id"),"data-is-marketplace":$(this.data.target).attr("data-is-marketplace"),"data-modal":"%href%"}),a.initOpeners(),b.on("click",".close-modal",function(a){a.preventDefault();var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}),b.on("click",".potterMoreModal",function(b){b.preventDefault(),new BN.Modal.Browse.PDP.PottermoreBuy(null,{target:{id:$(this).attr("id"),href:$(this).attr("href")}},null,a)}),$(".icon-close-modal").focus()})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.GiftCardBalance=BN.Modal.Browse.GiftCardBalance||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.giftCardBalance")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"giftCard-balance",initView:function(){this.initGenericView(),this.initForm();{var a=this;$(this.modal),a.data.target}this.data.redirect=!1;var b=a.userOptions.tplParams.captchav3Enabled,c=a.userOptions.tplParams.giftCardNumber,d=a.userOptions.tplParams.gcInitialBalance,e=a.userOptions.tplParams.gcUsedBalance,f=a.userOptions.tplParams.giftCardRemainingBalance;if(!b){var g="https://www.google.com/recaptcha/api.js?onload=verifyCallbackToCaptcha&render=explicit",h=document.createElement("script");h.async=!0,h.type="text/javascript",h.src=g,$("#insertCaptchaScript").empty().append(h)}this.on("display",function(){intiateRecaptchaVthree("#checkGCBalance"),b||$("#checkGCBalance").on("amplifiFormSuccess",function(a,b){$(".recaptcha-div").addClass("strict-hidden"),$(".gc-balance-table").removeClass("strict-hidden"),$(".modal-check-balance .modal__header h2").addClass("gc-left-aligned-header"),$(".gc-balance-table table tr#gcNumber td:nth-child(3)").html(b.giftCardNumber),"true"===$("#enhancedBalanceInquiryEnabled").val()&&($(".gc-balance-table table tr#gcInitialBalance td:nth-child(3)").html("$"+b.gcInitialBalance),parseFloat(b.gcUsedBalance)>0&&$(".gc-balance-table table tr#gcUsedBalance td:nth-child(2)").html("&ndash;"),$(".gc-balance-table table tr#gcUsedBalance td:nth-child(3)").html("$"+b.gcUsedBalance)),$(".gc-balance-table table tr#gcRemBalance td:nth-child(3)").html("$"+b.giftCardRemainingBalance)}).on("amplifiFormError",function(b,c){if("2FAREQUIRED"!=c.response.items[0].toUpperCase()){var d=$("#balanceErr");a.Close(),d.html('<em class="emphasis emphasis--alert">'+c.response.items[0]+"</em>"),d.show(),d.attr("tabindex","0"),d.focus(),d.removeAttr("tabindex")}}),b&&($(".recaptcha-div").addClass("strict-hidden"),$(".gc-balance-table").removeClass("strict-hidden"),$(".modal-check-balance .modal__header h2").addClass("gc-left-aligned-header"),$(".gc-balance-table table tr#gcNumber td:nth-child(3)").html(c),"true"===$("#enhancedBalanceInquiryEnabled").val()&&($(".gc-balance-table table tr#gcInitialBalance td:nth-child(3)").html("$"+d),parseFloat(e)>0&&$(".gc-balance-table table tr#gcUsedBalance td:nth-child(2)").html("&ndash;"),$(".gc-balance-table table tr#gcUsedBalance td:nth-child(3)").html("$"+e)),$(".gc-balance-table table tr#gcRemBalance td:nth-child(3)").html("$"+f))}),this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b.find("[type=submit]")),b.find("[type=submit]").focus(),b.find("[type=submit]").addClass("focus")):consoleLog("can't return focus to the modal-opening element, as it could not be found")})}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.ISBN=BN.Modal.Browse.ISBN||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.ISBN")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"isbn-index"},a}(),BN.Modal.Base,!0),BN.Modal.Browse.GiftMessage=BN.Modal.Browse.GiftMessage||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.GiftMessage")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"gift-message",initView:function(){{var a=this,b=$(this.modal),c=a.data.target,d=$(c).data("messageid");$("#"+d).text()}b.find("#giftMessageModal").text($(c).next()[0].innerHTML)}},a}(),BN.Modal.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.BulkOrderSearch=BN.Modal.Browse.BulkOrderSearch||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.BulkOrderSearch")};return a.prototype={tplName:"bulk-order-search",defaultOptions:{useCache:!1},currentIndex:0,firstAdd:!1,initView:function(){{var a=this;$(this.modal),$(this.data.target)}this.on("display",function(){var b=$("#resultsMainContainer"),c=$("#frmBulkSearch");b.hide(),$("#bulkSearchFilterSelect").selectBox();var d=$("#frmBulkSearch .selectBox-dropdown-menu li a");if(d&&d.length>0)for(var e=0;e<d.length;e++)("Audiobooks"===d[e].innerText||"Newsstand"===d[e].innerText)&&(d[e].hidden=!0);var f=c.find(".selectBox-dropdown .selectBox-arrow"),g='<svg width="10" height="8" xmlns="http://www.w3.org/2000/svg" id="Layer_1" viewBox="0 0 10 6"><defs><style>.cls-1{fill:#21282d;}</style></defs><path class="cls-1" d="m5,4.05L.97.02.01.97l4.99,4.99L9.99.97,9.03.02l-4.03,4.03Z"/></svg>';f&&f.length>0&&(f.append(g),f.addClass("show-icon")),$("#bulkSearchButton").bind("click",function(){$("#bulkSearchSubmit").submit()}),BN.uXHR.Form.apply(c),c.on("amplifiFormSuccess",function(b,c){a.displayResults(c.redirectUrl)}).on("amplifiFormBeforeSubmit",function(){a.unready()}),""!=$("#txtBulkSrch").val()?c.find("#bulkSearchSubmit").click():$(".loading-indicator-holder").hide()})},unready:function(){this.$spinner&&this.$spinner.length>0&&this.$spinner.remove(),$(".loading-indicator-holder").show(),$("#resultsMainContainer").hide(),this.displaySpinner()},ready:function(){$("#resultsMainContainer").show(),$(".loading-indicator-holder").hide(),this.$spinner.remove()},addItem:function(){var a=$(this.data.target);that=this,0==that.currentIndex&&(that.currentIndex=a.attr("id").split("_")[1]),$("#resultsMainContainer").find(".add-isbn-info a").on("click",function(){var b=$(this);if("Added"!=b.html()){{a.parents("li:first")}if(that.firstDone){var c=$(".bulk-order-container section.quote-items");c.find("a.add-item").click(),that.currentIndex=parseInt(that.currentIndex)+1;var d=c.find("#search_"+that.currentIndex);that.fillValues(d,b)}else that.firstDone=!0,that.fillValues(a,b);b.html("Added").removeClass("btn").addClass("not-active")}})},displayResults:function(a){var b=this;$("#resultsMainContainer").load(a,function(){$(this).html($("#resultsListContainer").html()),b.initOpeners(),b.ready(),b.addItem(),b.paginate(),b.close()})},fillValues:function(a,b){var c=a.parents("li:first"),d=c.find("[id^='item_title']"),e=c.find("[id^='item_isbn']"),f=b.data("isbn-id"),g=b.data("title");a.hide(),a.siblings().show(),d.val(g),e.val(f)},paginate:function(){var a=this;$("#resultsMainContainer").find(".pagination li a").on("click",function(b){b.preventDefault();var c=$(this).attr("href");a.displayResults(c)})},close:function(){$("#sectionBulkSrch div.confirm .btn").on("click",function(){that.Close()})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Condition=BN.Modal.Browse.Condition||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Condition")};return a.prototype={tplName:"m-condition",defaultOptions:{useCache:!1,tplDir:SITE_ROOT+"/modals/marketplace/"},initView:function(){var a=this.data,b=($(this.modal),$(a.target)),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.on("display",function(){$(".icon-close-modal").focus()}),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Marketplace=BN.Modal.Browse.Marketplace||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Marketplace")};return a.prototype={tplName:"marketplace",suppressAutoTabindex:!0,listOptions:{condition:"All",sortBy:"pricel"},sorters:{rating:{desc:"Seller Rating"},bnPrice:{asc:"Price - Low to High",desc:"Price - High to Low"},condition:{condition:"Condition"}},filters:{condition:{},rating:{"5.0":"5 Stars","4.0-4.9":"4 Stars","3.0-3.9":"3 Stars","2.0-2.9":"2 Stars","0.0-1.9":"1 Star"}},lists:{},reviewsURL:null,firstReady:!0,defaultOptions:{useCache:!1},trimText:function(a,b){var c=a,d=b;if(c.length>d){var e=c.lastIndexOf(" ");if(-1===e)c=c.slice(0,d-3),c+="...";else if(e>-1){c=c.slice(0,d-3);var f=c.lastIndexOf(" ");c=c.slice(0,f),c+="..."}}return c},initToolTip:function(){var a=$("span[data-icon=plus-expand]");$(".expand-tooltip-container").hide(),a.on("click",function(){var a=$(this);a.parents("li").siblings().find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change"),a.prev(".expand-tooltip-container").toggle(),a.toggleClass("expandicon-change")})},closeToolTips:function(){$(".marketplace-tab h3 label").on("click",function(){$(this).parents(".tabgroup").find(".expand-tooltip-container").hide().end().find("span[data-icon=plus-expand]").removeClass("expandicon-change")})},readMore:function(){$(".seller-info .down-arrowhead").on("click",function(){var a=$(this),b=a.parent().find(".full-comments").text();a.parent().find("[data-prop=comments]").text(b),a.addClass("strict-hidden")})},initConditionsModal:function(){var a=$(".tab-select");a.on("click",function(){new BN.Modal.Browse.Condition(null,{target:this},null,null)})},initView:function(){var a=$(this.modal),b=this;return this.unready(),this.initGenericView(),("undefined"==typeof this.productName||""==this.productName)&&$(this.data.target).closest("#prodInfoContainer").length>0&&this.getProductNameByURL(THIS_PATH),this.on("display",function(){var b={streamID:this.data["work-id"],categoryID:"Products",containerID:"gigyaRating",ratingTemplate:a.find("data#gigyaRating").html(),onLoad:function(){var a=$("#gigyaRating .gig-rating-stars").attr("alt");$("#gigyaRating .gig-rating-stars").attr("aria-label","Rating "+a+" out of 5.0"),$("#gigyaRating .gig-rating-stars").removeAttr("title"),$("#gigyaRating .gig-rating-readReviewsLink").attr("href",$("#prodReviewInfo .gig-rating-readReviewsLink").attr("href")+"#reviews-header")},onReadReviewsClicked:function(){window.location=$("#prodReviewInfo .gig-rating-readReviewsLink").attr("href")+"#reviews-header"}};"undefined"!=typeof gigya&&gigya.comments.showRatingUI(b)}),BN.uXHR.getService("marketplace-items",{productId:this.data["product-id"]},function(){b.initContainerDom.apply(b,arguments)}),!0},unready:function(){if(0==this.modal.getElementsByClassName("spinner").length){var a="",b=$("input[name=spinnerPath]").val();b&&b.indexOf("null")<0&&b.indexOf("undefined")<0&&(a=b);var c=$('<div class="spinner mini-cart-spinner spinner__large"><span class="text--center">Please wait just a moment (or two) as we gather all available editions...</span><img src="'+a+'"></div>');this.$spinner&&this.$spinner.length>0&&this.$spinner.remove();var d=this.modal.getElementsByClassName("marketplace-tab");$(d).addClass("spinner-container").append(c)}},ready:function(){$(".icon-close-modal").focus(),$(this.modal).find(".mrkt-prod-name,.marketplace-tab").css({visibility:"visible"});var a=$(this.dom),b=$(this.modal).find('.tab[type="radio"]').first(),c=b.val();b.parent().attr("aria-selected",!0),$(this.modal).find("section[id="+c+"]").removeClass("hidden"),$(this.modal.getElementsByClassName("spinner")).remove(),$(this.dom).off("click","a",this.__anchorClick),$(this.dom).on("click","a",this.__anchorClick),$(this.dom).on("click",".tabListElement a",function(){$selectedTab=$(this).find('.tab[type="radio"]'),$selectedTabVal=$(this).find('.tab[type="radio"]').val(),a.find(".tabListElement a").attr("aria-selected",!1),$(this).attr("aria-selected",!0),a.find("[data-condition]").addClass("hidden"),$selectedTab.parent().attr("aria-selected",!0),a.find("section[id="+$selectedTabVal+"]").removeClass("hidden"),"New"==$selectedTabVal?$(".filter-condition-selectBox-dropdown-menu a[rel!='condition new']").addClass("disabled"):$(".filter-condition-selectBox-dropdown-menu a[rel!='condition new']").removeClass("disabled"),"Used"==$selectedTabVal?$(".filter-condition-selectBox-dropdown-menu a[rel='condition new']").addClass("disabled"):$(".filter-condition-selectBox-dropdown-menu a[rel='condition new']").removeClass("disabled"),"0"===$selectedTab.parent().find('data[value="conditionCount"]').text()&&$(".no-results-cont").removeClass("hidden"),"0"!==$selectedTab.parent().find('data[value="conditionCount"]').text()&&$(".no-results-cont").addClass("hidden")}),$(this.modal).find(".tab-select").each(function(){$(this).on("keydown",function(a){13==a.keyCode&&$(this).trigger("click")})}),$("#quickView").find(":tabbable:last").on("keydown",function(a){a.shiftKey||9!=a.keyCode||($(".icon-close-modal").focus(),a.preventDefault())}),$("#quickView").find(".icon-close-modal").on("keydown",function(a){a.shiftKey&&9==a.keyCode&&($("#quickView").find(":tabbable:last").focus(),a.preventDefault())}),$(this.modal).find("a.selectBox-dropdown").each(function(){var a=$(this),b=a.parent().parent(),c=a.parent(),d=b.find("label:first"),e=c.prev("select"),f=c.find(".selectBox-dropdown-menu"),g=a.find(".selectBox-label"),h=e.attr("id");g.attr("id",h+"-button-label"),f.attr({id:h+"-option-list",role:"listbox"}),a.attr({role:"combobox","aria-labelledby":h+"-button-label",href:"#"}),f.find("li").each(function(a){$(this).attr({id:h+"-option-"+a,role:"option"})}),""!==h&&void 0!=d.attr("for")&&d.attr({"for":h+"-replacement",id:h+"-label"}),a.attr({id:h+"-replacement","aria-expanded":"false","aria-selected":"false","aria-owns":f.attr("id")}).bind("keydown",function(b){switch(b.which){case 9:case 13:case 27:"true"==a.attr("aria-expanded")||f.not(":visible")?(a.attr("aria-expanded","false").attr("aria-selected","true").removeAttr("aria-activedescendant"),f.attr("aria-hidden","true")):(f.attr("aria-hidden","false"),a.attr("aria-expanded","true").attr("aria-activedescendant",c));break;case 37:case 38:case 39:case 40:"false"==a.attr("aria-expanded")&&(a.attr("aria-expanded","true"),f.attr("aria-hidden","false"));var c=f.find(".selectBox-selected:first").attr("id");a.attr("aria-activedescendant",c)}})})},__anchorClick:function(a){"#"==$(this).attr("href")&&a.preventDefault()},initContainerDom:function(a){this.servResp=a.service;var b=[],c="";"undefined"!=typeof a.service.items&&(a.service.items.forEach(function(a){b.push(a.ean)}),c=a.service.items[0].pean,"undefined"!=typeof s_setP&&"undefined"!=typeof digitalData.product[0].productInfo&&(s_setP("digitalData.product[0].productInfo.mEAN",b),s_setP("digitalData.product[0].productInfo.pEAN",c)));var d=this,e=$(this.modal),f=$(this.data.target).data("formats-edition")?$(this.data.target).data("formats-edition"):!1,g=this.servResp.product,h="",i="",j="",k="",l=$("body").hasClass("pdpPage")?!0:!1,m=["All","New","Used"],n=this.servResp.items,o=this.itemsByCond=this.separateByCondition(n),p=$(this.data.target).data("work-id")||"",q=($(this.data.target).attr("data-formatsurl"),$(this.data.target).attr("data-ismarketplace"));if(g&&g.hasOwnProperty("skus")){var r=g.skus;r.length>1?(h=r[0],j=h.displayName,k=h.contributor):(h=r,j=h[0].displayName,k=h[0].contributor)}if(h&&h.hasOwnProperty("edition")&&(i=""!=h.edition?"("+h.edition+")":""),d.reviewsURL=h.reviewsUrl,j.length<=50)var s=j+" "+i;else var s=j+" "+i+"<br>";e.find('[data-prop="productTitle"]').html(s),e.find("[data-template]").remove(),e.find('[data-prop="contributor"]').text(k),$(".author").removeClass("hidden");var t=this.flow().get("quickview"),u=e.find("#open-prod-details");if(l&&u.parent().remove(),f){$('<li class="qvLink"><a href="#" class="formatModal">All Formats & Editions</a></li>').insertAfter(e.find("ul.quick-view-nav li")[1]);var v=e.find(".formatModal");v.attr("data-ismarketplace",q),e.find("#qvTitleBar").on("click",".formatModal",function(a){a.preventDefault(),new BN.Modal.Browse.Formats(null,d.data,null,d)})}if(t&&t.pureModal)this.__initCrumbEvent(u.attr("data-crumb","quickview").get(0)),e.find("#qvTitleBar").on("click","a#open-prod-details",function(a){a.preventDefault(),showProductDetails($(t.modal)),$("#pdpModalContent").show()}),e.on("click",".close-modal",function(a){a.preventDefault(),d.Close(),t.Close()});else if(window.location.toString().indexOf(h.pdpUrl)>-1)u.on("click",function(){d.Close()});else{g&&g.id&&u.attr("data-product-id",g.id),h&&h.pdpUrl&&u.attr("data-quickview-url",h.pdpUrl),u.attr("data-work-id",p),u.attr("data-modal-class","BN.Modal.Browse.Quickview"),this.initOpeners(u.parent().get(0));var w=e.find("#qvTitleBar #showAllFormats");g&&g.id&&w.attr("data-product-id",g.id),h&&h.pdpUrl&&w.attr("data-quickview-url",h.pdpUrl),w.attr("data-pdp-view","seeAllFormats"),w.attr("data-modal-class","BN.Modal.Browse.Quickview"),d.initOpeners(w.parent().get(0))}for(this.unready(),x=0;x<m.length;x++){var y=m[x];o.hasOwnProperty(y)&&this.initTab(y)}$("#tabListHead li").first().remove(),this.initToolTip(),$('[data-toggle="tooltip"]').tooltip(),this.initSorter(),this.initFilters(),this.initConditionsModal(),this.closeToolTips(),this.readMore(),e.find("#AllSection").click(),this.ready(),this.removeTabIndex(),$("#marketplace-modal-id").tabs(),$("#qvTitleBar").find("a.icon-close-modal").focus()},initLoopingModalFocus:function(){{var a=$(this.modal);a.find(".marketplace-tab"),a.find(this.tabbableSelector)}$(this.dom).find('.tab[type="radio"]').on("click",function(){$selectedTab=this.val(),$(this.dom).find("section[id="+$selectedTab+"]").removeClass("hidden")})},initFilters:function(){var a=this;a.initFilter("rating"),a.initFilter("condition");var b=$(this.modal).find("select.filter");b.on("change",function(){var c=$(b[0]).find(":selected").val(),d=$(b[1]).find(":selected").val(),e=c.split(/\s+/),f=d.split(/\s+/);a.filterItems(e[1],f[1])})},initFilter:function(a){var b=this,c=$(this.modal).find(".select-section .filter-"+a);c.empty(),c.append($("<option selected>All Sellers</option>").attr("value",a+" reset")),"condition"==a&&b.arrangeConditionFilter();var d=this.filters[a];for(var e in d){var f=d[e];title="object"==typeof sortDir?f.title:f,c.append($("<option/>").attr("value",a+" "+e).text(title))}c.selectBox()},arrangeConditionFilter:function(){var a=this.filters.condition,b=["new","likenew","verygood","good","acceptable","refurbished","used"];this.filters.condition={};for(var c in b){var d=b[c];a.hasOwnProperty(d)&&(this.filters.condition[d]=a[d])}},filterItems:function(a,b){var c=this.lists,a="reset"==a?"reset":a,b="reset"==b?"reset":this.filters.condition[b],d=[{name:"rating",val:a},{name:"condition",val:b}];for(var e in c){for(var f=c[e],g=$("#"+e+"Section"),h=f.listDom,i=f.items,j=i.filter(function(a){var b=function(b){var c=b.name,d=b.val,e=d.split("-");return"reset"==d?!0:"undefined"!=typeof a.item[c]?e.length>1?a.item[c]>=e[0]&&a.item[c]<=e[1]:a.item[c]==d:void 0};return a.dom[0].style.display="none",b(d[0])&&b(d[1])}),k=0;k<j.length;k++){h.parent().hasClass("hidden")||$(".no-results-cont").addClass("hidden");var l=j[k];l.dom[0].style.display="block",h.append(l.dom)}h.parent().hasClass("hidden")||0!==j.length||$(".no-results-cont").removeClass("hidden"),g.siblings('data[value="conditionCount"]').text(j.length),h.append(h.find("div.clear:empty"))}return!0},initSorter:function(){var a=this,b=this.sorters,c=$(this.modal).find(".sorter");c.empty();for(var d in b){var e=b[d];for(var f in e){var g=e[f];title="object"==typeof g?g.title:g,c.append($("<option/>").attr("value",d+" "+f).text(title))}}c.on("change",function(){var b=$(".marketplace-tab");b&&b.scrollTop()>0&&b.animate({scrollTop:0},"fast");var c=this.value.split(/\s+/);a.sortItems(c[0],c[1])}),c.val("bnPrice asc").change(),c.selectBox()},sortItems:function(a,b){var c=this.lists,d=this.sorters[a][b];if("condition"==b){var e=["New","Like New","Very Good","Good","Acceptable","Used","Refurbished"];d=function(b){return b.sort(function(b,c){{var d=b.item[a],f=c.item[a];e.indexOf(d),e.indexOf(f)}return f>d?-1:d>f?1:0}),b.reverse(),b}}else"object"!=typeof d&&(d=function(c){return c.sort(function(b,c){var d=b.item[a],e=c.item[a],f=parseFloat(d),g=parseFloat(e);return d==f&&(d=f),e==g&&(e=g),e>d?-1:d>e?1:0}),"desc"==b&&c.reverse(),c});for(var f in c){for(var g=c[f],h=g.listDom,i=g.items,j=i.length,k=d(g.items),l=0;j>l;l++){var m=k[l];h.append(m.dom)}h.append(h.find("div.clear:empty"))}return!0},separateByCondition:function(a){var b={All:a||[]};b.Used=[];for(var c=0;c<b.All.length;c++){var d=b.All[c],e=d.condition;void 0!=b[e]?b[e].push(d):b[e]=[d],"New"!=e&&(void 0!=b[e]?b.Used.indexOf(d)<0&&b.Used.push(d):b.Used=[d])}return b},initTab:function(a){var b=(a+"Section").replace(/\s/gi,""),c=this.itemsByCond[a],d=$(this.modal),e=$(this.tpl()),f=d.find(".tabgroup"),g=$("<div/>"),h=e.find('[data-template="tabset"]').clone(),i=d.find("#tabListHead"),j=$(i.children()[0]),k=j.clone();
return h.attr("data-template",null),k.attr("data-template",null),g.append(h),g.children().filter("section").attr("data-condition",a).attr("id",a).attr("class","hidden"),k.find('.tab[type="radio"]').attr("id",b).attr("value",a),k.find('data[value="condition"]').text(a),k.find('data[value="conditionCount"]').text(c.length),i.append(k),this.initTabItems(c,g,a),f.append(g.children()),f.append(f.find("div.clear:empty")),this},initTabItems:function(a,b,c){var d=this,e=$(this.tpl()),f=b.find("section"),g=f.find(".section-items"),h=e.find(".product-module:first").clone(),i=a.length,j=this.lists[c]={name:c,listDom:g,items:[]};g.empty();for(var k=0;i>k;k++){var l=a[k],m=a[k].ean,n=h.clone();j.items.push({dom:n,ean:m,item:l}),n.find("[data-prop]").each(function(){var a=$(this),b=a.attr("data-prop");if(void 0!=l[b])if("bnPrice"==b){var c=parseFloat(l[b]),e=c.toFixed(2);a.html("$"+e||" ")}else if("comments"==b){var f=l.comments,g=d.trimText(f,94);f.length>94?(a.html(g||" "),a.next("span").html(f),a.parent().find("a.down-arrowhead").removeClass("strict-hidden")):a.html(f)}else if("undefined"!=typeof s_setP&&"digitalData"===b){var h=JSON.stringify(l[b]);h&&attachDataToButton(h,a)}else"digitalData"!==b&&a.html(l[b]||" ")}),n.find("data[value]").each(function(){var a=$(this).attr("value");if(void 0!=l[a])if("bnPrice"==a){var b=parseFloat(l[a]),c=b.toFixed(2);$(this).html("$"+c||" ")}else $(this).html(l[a]||" ")});var o=c;o+="-"+k;var p='<ul class="ship-method-list">',q="<script type='text/tooltip' id='shipping-tooltip-"+o+"' data-tooltip-content>";q+="<a href='#' data-dismiss='tooltip' class='' role='button' aria-label='Close'></a>";for(method in l.shipMethods){var r=l.shipMethods[method].shipDaysLow||"",s=l.shipMethods[method].shipDaysHigh||"",t=r&&s?"("+r+"-"+s+" business days)":"",u="<li>"+l.shipMethods[method].displayName+" "+t+"</li>";p+=u}p+="</ul>",q+=p+"</script>";var v="#shipping-tooltip-"+o;n.find(".tooltip-icon-info").attr("data-content",v),n.find(".tooltip-icon-info").attr("data-target","body"),n.find(".tooltip-icon-info").addClass("shipping-options-tooltip"),n.find(".tooltip-icon-info").parent().addClass("shippingOptns-"+o),n.find(".shipingOptions .tooltip-icon-info").append(q),n.find('[data-prop="sellerName"]').attr("href",l.sellerUrl),n.find('[data-prop="feedbackNum"]').attr("href",l.sellerReviewsUrl);var w=l.rating,x=w.split("."),y=n.find(".gig-rating-stars");y.attr("aria-label","Rating "+w+" out of 5.0"),y.attr("alt",w),y.empty();for(var z=1;5>=z;z++)y.append(z>x[0]?z-1==x[0]&&x[0]>0&&x[1]>4?$("<span/>").attr("class","star star--half"):$("<span/>").attr("class","star star--empty"):$("<span/>").attr("class","star star--full"));n.find(".btn-addtocart").attr("data-ean",m).on("click",function(a){a.preventDefault(),d.displaySpinner(),BN.uXHR.getService("add-marketplace-to-cart",{mean:$(this).attr("data-ean"),productId:d.data["product-id"],skuId:d.data["sku-id"]},function(b){if(0==b.service.success){{var c=b.service.response.items,e=c.length,f=$(d.modal).find("#marketplaceError");f.find("em").length}f.empty();for(var g=0;e>g;g++)f.append($('<em class="emphasis emphasis--alert" />').text(c[g]));f.show()}else{var f=$(d.modal).find("#marketplaceError");f.empty().hide(),new BN.Modal.Browse.PDP.AddToBag(null,{onClose:function(){$("body").hasClass("shopping-bag")&&(window.location.href=window.location.href)},messages:[{type:"success",message:"The item has successfully been added to your cart!"}]},{tplParams:{ean:b.service.ean,eanQty:b.service.eanQty,eanPrice:b.service.eanPrice}}),loadHeaderElement($("#bagContentsContainer"),webContextRoot+"/includes/shopping-bag.jsp",!0,!0),$(document).trigger("analytics-market-add",[a])}d.$spinner.remove()},function(){$(d.modal).find("#marketplaceError").append($('<em class="emphasis emphasis--alert" />').text("There was a problem adding your item to cart. Please try again later.")),d.$spinner.remove()})});var A=l.condition,B=A.replace(/\s/g,"").toLowerCase();B in this.filters.condition||(this.filters.condition[B]=A),g.append(n)}return this}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Quickview=BN.Modal.Browse.Quickview||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.Quickview")};return a.prototype={tplName:"quickview",suppressAutoTabindex:!0,defaultOptions:{useCache:!1},prodUrl:"",trimText:function(a,b){var c=a.trim(),d=b;if(c.length>d){var e=c.lastIndexOf(" ");if(-1===e)c=c.slice(0,d-3),c+="&nbsp;...";else if(e>-1){c=c.slice(0,d);var f=c.lastIndexOf(" ");c=c.slice(0,f),c+="&nbsp;..."}}return c},initView:function(){var a=this,b=$(this.modal),c=$(this.data.target).attr("data-product-id")||$(this.data.target).attr("id"),d=$(this.data.target).attr("data-sku-id"),e=($(this.data.target).data("pdp-view"),$(this.data.target).data("work-id")),f=($(this.data.target).attr("data-ismarketplace"),$(this.data.target).attr("data-sku-type")),g=$(this.data.target).attr("data-product-name"),h=$(this.data.target).attr("data-price");a.prodUrl=$(this.data.target).attr("data-quickview-url");var i=a.prodUrl;a.disableReview=$(this.data.target).attr("disableReview");var j=a.disableReview;a.prodUrl+=a.prodUrl.indexOf("?")>=0?"&quickview=true":"?quickview=true",this.displaySpinner(),b.find("[data-product-id]").attr("data-product-id",c),this.getProductNameByURL(a.prodUrl),this.data["work-id"]=""+e,"undefined"==typeof gigya&&$.ajax({url:SITE_ROOT+"/includes/loadGigya.jsp"}).done(function(a){$("head").append(a)}),this.on("display",function(){setTimeout(function(){"true"==j&&$(".customer-reviews-section").addClass("d-none")},1e3),$(this.modal).find("#pdpModalContent").load(a.prodUrl+" #quick-view-productDetail",function(){$(".quickview-holder").remove(),$(".product--image").on("init",function(){$(".product--image").find(".product-image-slide").matchHeight(),a.hideSpinner()});var c=$(".product--image").find(" img").last();$(c).on("load",function(){$(".product--image").slick({dots:!1,infinite:!1,slidesToShow:1,slidesToScroll:1,arrows:!1,draggable:!1,adaptiveHeight:!1})}),$(".product-thumb:first").addClass("focus-qv"),$(".product-thumb").on("click",function(){$(".product-thumb").removeClass("focus-qv"),$(this).addClass("focus-qv");var a=$(this).data(a),b=$(".product--image");b.length>0&&b.slick("slickGoTo",a.thumbIndex)});const j=-1!==a.prodUrl.indexOf("?quickview")?a.prodUrl.split("?quickview")[0]:a.prodUrl.split("&quickview")[0];$("#pdpModalContent a.view-product-details, #pdpModalContent a.qv-modal-img, #pdpModalContent a.qv-modal-title").attr("href",j),b.find(".format-chiklet-slide").slick({slidesToShow:3,slidesToScroll:3,adaptiveHeight:!1,infinite:!1}),slideIndex=parseInt(b.find(".format-chiklets-slider").find(".selected-format-chiclet").attr("data-slick-index")),slideIndex>0&&b.find(".format-chiklets-slider").slick("slickGoTo",slideIndex),b.on("click",".close-modal",function(a){a.preventDefault();var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}),a.initOpeners(),a.initFormatChiclet(a),$(".modal-quickview .pdp-commerce-format").matchHeight();var k=b.find(".format-content").text().length,l=b.find(".format-content").text();k>255&&b.find(".format-content").html("<p>"+a.trimText(l,255)+"</p>"),b.find("#ratingsDisplay:not([data-preorder=true])").attr("id","modalRatingsDisplay");var m=a.prodUrl.split("?ean=")[1].split("&")[0];document.querySelector("#quickViewRatingsDisplay").setAttribute("data-bv-product-id",m),premiumRewardsEligible_ajax(m,"pdp"),b.find("#quick-view-productDetail ul.options li").each(function(){""==$(this).html().trim()&&$(this).remove()}),b.find("a.all-formats").parent("p").hide(),b.find(".ip-form").find(".btn--commerce-secondary").removeAttr("disabled").removeClass("disabled"),initInstantPurchaseSignIn(),$(document).off("click","#quick-view-productDetail .btn-instant-purchase"),openLoginModalNew("#quick-view-productDetail .btn-instant-purchase",{preventDefault:"conditionally",successCallback:function(){$(this).attr("class");$(".sign-in-instant-purchase").is(":visible")&&($(".btn-instant-purchase").removeClass("strict-hidden"),$(".sign-in-instant-purchase").addClass("strict-hidden"),$(this).click()),a.displaySpinner()},runSuccessCallbackOnce:!0,keepParentModalOpen:!0}),b.find(".tabgroup section:not(first-child)").css("display","none");{var n=$("#quick-view-productDetail input[name=rental-options]:checked");$("#quick-view-productDetail input[name=rental-options]").not(n)}$(".multi-product-select").children().each(function(a,b){$(b).find("input[type=radio]").attr("checked")||$(b).addClass("grdnt-fade-white")}),$("input[name=rental-options]","#quick-view-productDetail").on("click",function(){var a=$(this),b=$("#quick-view-productDetail input[name=rental-options]"),c=b.not(a),d=a.parents("li"),e=b.parents(".subscriptions-container");d.is(":first-child")?e.children("li:first-child").removeClass("top-border"):e.children("li:first-child").addClass("top-border"),d.removeClass("grdnt-fade-white"),d.siblings().addClass("grdnt-fade-white"),c.removeAttr("checked"),c.parents("label").siblings().slideUp("fast"),c.parents("form").siblings().slideUp("fast"),c.siblings(".price").removeClass("no-display"),a.parents("label").siblings().not("select").slideDown("fast"),a.parents("form").find("#rentalRates").slideDown("fast"),a.parents("form").siblings().slideDown("fast"),a.siblings(".price").addClass("no-display"),$(".selectBox-container").css("overflow","visible")}),$("#quick-view-productDetail #rentalRates").on("change",function(){var a=$("option:selected",this).attr("data-rental-rate"),c=$("option:selected",this).attr("data-rental-return-date"),d=$("option:selected",this).attr("data-rental-discount"),e=b.find(".rental-price .current-price"),f=b.find(".return-date"),g=b.find(".rental-price .discount-amount-value");e.text(a),f.text(c),g.text(d)}),attachCartAction(!0),$("#quick-view-productDetail .prim-image a").attr("href",a.prodUrl),$("#quick-view-productDetail .prim-image a").on("click",function(){window.location.href=$(this).attr("href")});var o=!1;if($("#quick-view-productDetail p.nook-devices-apps a").on("click",function(a){a.preventDefault(),b.find("#quick-view-productDetail .expand-cvv-container").toggle(),0==o?($("#quick-view-productDetail .nook-devices-apps .show img").attr("src","/static/img/sprites/tooltip-active.png"),$(this).addClass("open"),o=!0):($("#quick-view-productDetail .nook-devices-apps .show img").attr("src","/static/img/sprites/plus-expand.png"),$(this).removeClass("open"),o=!1)}),$("[id^=startFreeTrial]").on("click",function(){startFreeTrialBtnanalytics()}),$("[id^=getSubscriptionBtn]").on("click",function(){getSubscriptionBtnanalytics()}),$("[data-tooltip-trigger]").length>0&&showTooltip(!0),$(".btn-goToEpisodes").length){var p=$("<div></div>");$.ajax({url:"/cartridges/ProductDetailContent/ProductDetailTypes/includes/episodes-list.jsp",cache:!1,type:"post",data:{eans:$("#dataEpisodes").attr("data-eans")}}).done(function(a){p.html(a),$("#lowestPriceEpisodeButton").text(p.find("#lowestPriceEpisode").attr("data-lowpriceepisode")),p.remove()})}a.addTabIndex(),a.initTabIndex(),a.initFocusImmediately();var q=!1,r=$("#quick-view-productDetail form.ip-form");BN.uXHR.Form.apply(r),r.on("submit",function(){a.hideSpinner(),a.displaySpinner()}).on("amplifiFormSuccess",function(){}).on("amplifiFormBeforeSerialize",function(){r.find(".is-add-to-cart-ajax").remove(),r.find('input[name="clientProfile"]').remove(),r.append('<input type="hidden" name="isAjax" value="true" class="is-add-to-cart-ajax" />'),r.prepend('<input type="hidden" name="clientProfile" value="'+checkDeviceType()+'">')}).on("amplifiFormError",function(b,c){a.hideSpinner(),"undefined"!=typeof c.response.data&&""!=c.response.data.instantPurchaseError&&sessionStorage.setItem("isCvvRequiredPdp",JSON.stringify(c.response.data));var d=$("form.ip-form .btn-instant-purchase");d.length&&d.hasClass("disabled")&&d.removeClass("disabled");var e=$("#btnInstPurTextbook");e.length&&e.hasClass("disabled")&&"true"!==$("#textBookDisabled").val()&&e.removeClass("disabled");var f=$("#btnInstPureMag");f.length&&f.hasClass("disabled")&&f.removeClass("disabled");var g=c.response.data.errors;if($.each(g,function(a,b){return b.indexOf("COVID-19")>-1?(q=!0,!1):void 0}),q){var h=r.closest(".modal");h.hide(),new BN.Modal.Checkout.DisableShipping(null,{onClose:function(){h.show()}},{tplParams:""},null)}else if($("#pdpErrors").is(":visible")&&"The Security Code you entered is incorrect.Please try again or contact Customer Service for assistance."==$("#pdpErrors").text()){$("#pdpErrors").hide();var i=JSON.parse(sessionStorage.getItem("isCvvRequiredPdp")),j={tplParams:c.response.data.tplParams};new BN.Modal.Browse.PDP.InstantPurchase(null,i,j),sessionStorage.removeItem("isCvvRequiredPdp")}else if("2FAREQUIRED"==c.response.items[0].toUpperCase())new BN.Modal.Account.TwoStepVerification(null,{target:this},{useCache:!1,tplParams:{formName:$(this),formBtn:"",formId:"instant-purchase",captchav3Enabled:"undefined"!=typeof captchaV3ApiKey}});else if(!c.response.data.instantPurchaseError&&c.response.data.errors.length>0)$(".checkoutId").val(""),BN.Validate.DisplayErrors($(".ip-form"),c.response.data.errors,null,null,null,c);else{var j={tplParams:c.response.data.tplParams};new BN.Modal.Browse.PDP.InstantPurchase(null,c.response.data,j)}});if($(".audiobook-play-button").on("click",function(){var a=[];a["primary-category"]=$(this).attr("data-primary-category"),a["product-type"]=$(this).attr("data-product-type"),a["sub-category"]=$(this).attr("data-sub-category"),a["base-price"]=$(this).attr("data-base-price"),a["product-name"]=$(this).attr("data-product-name"),a["product-id"]=$(this).attr("data-product-id"),a["audiobook-id"]=$(this).attr("data-audiobook-id"),a["product-url"]=$(this).attr("data-product-url"),a.sku=$(this).attr("data-sku"),a.ratings=$(this).attr("data-book-ratings"),a.reviews=$(this).attr("data-reviews"),a.availability=$(this).attr("data-availability"),onAudiobookSamplePlayAnalytics(a);var b=$(this).siblings('[id^="plpAudio"]').attr("id"),c=document.getElementById(b);$(this).siblings(".pause-overlay").removeClass("d-none"),$(this).closest(".audiobook-play-button-2").hasClass("d-none")||($(".audiobook-play-button-2").addClass("d-none"),$(".audiobook-pause-button").removeClass("d-none")),$(this).addClass("d-none"),$(this).parent().find(".sample-playing").removeClass("d-none").text("Sample Playing"),c.play()}),$(".audiobook-play-button").length){if("undefined"!=typeof s_setP){{getAnalyticsEventCount()}s_setP("digitalData.page.attributes.hasAudiobookSample","true")}}else if("undefined"!=typeof s_setP){{getAnalyticsEventCount()}s_setP("digitalData.page.attributes.hasAudiobookSample","false")}$(".audiobook-pause-button").on("click",function(){var a=$(this).parent().siblings('[id^="plpAudio"]').attr("id"),b=document.getElementById(a);$(this).addClass("d-none"),$(this).siblings(".audiobook-play-button-2").removeClass("d-none"),$(this).parent().find(".sample-playing").removeClass("d-none").text("Sample Paused"),b.pause()}),$(".audiobook-play-button-2").on("click",function(){var a=$(this).parent().siblings('[id^="plpAudio"]').attr("id"),b=document.getElementById(a);$(this).addClass("d-none"),$(this).siblings(".audiobook-pause-button").removeClass("d-none"),$(this).siblings(".sample-playing").text("Sample Playing"),b.play()}),$(".close-overlay").on("click",function(){var a=$(this).parent().siblings('[id^="plpAudio"]').attr("id"),b=document.getElementById(a);b.pause(),b.currentTime=0,$(this).parent().addClass("d-none"),$(this).siblings(".audiobook-play-button-2").addClass("d-none"),$(this).siblings(".sample-playing").addClass("d-none").text(""),$(this).siblings(".audiobook-pause-button").removeClass("d-none"),$(this).parent().siblings(".audiobook-play-button").removeClass("d-none")}),$("input[id^=creditPurchaseAB], input[id^=preOrderAB]").on("click",function(){b.hide();var c;const d=-1!==a.prodUrl.indexOf("?quickview")?a.prodUrl.split("?quickview")[0]:a.prodUrl.split("&quickview")[0];var e=a.prodUrl.split("?ean=")[1].split("&")[0],f=$("#subscriptionPlan").val(),g=$("#totalAvailableCredits").val(),h=$("#nextBillDate").val(),i=$("#abFormat").val(),j=$("#newSubscriptionPlan").val(),k=$("#newSubscriptionPrice").val(),l=$("#currentDate").val(),m=$(this).parents().find("#productName").val(),n=d,o=$(this).parents().find("#pImageUrl").val(),p=$(this).parents().closest(".prod-img-details-sec").find("#preorderAvailableDate").val(),q=$(this).parents().find("#authorURL").val(),r=$(this).parents().find("#author").val(),s=$(this).parents().find("#productId").val(),t=e;if(c=$(this).attr("id")=="creditPurchaseAB_"+t?"buyNow":"preOrder",0==g){if(a.Close(),new BN.Modal.Account.PurchaseNotCompleted(null,{target:this},{useCache:!1,tplParams:{subscriptionPlan:f,totalAvailableCredits:g,nextBillDate:h,newSubscriptionPlan:j,newSubscriptionPrice:k,currentDate:l}}),"undefined"!=typeof s_setP){var u=getAnalyticsEventCount();s_setP("digitalData.event["+u+"].eventInfo.eventAction","onModalView")}}else a.Close(),new BN.Modal.Account.ConfirmCreditPurchase(null,{target:this},{useCache:!1,tplParams:{buttonText:c,subscriptionPlan:f,totalAvailableCredits:g,nextBillDate:h,pImageUrl:o,productName:m,pdpUrl:n,preorderAvailableDate:p,ABFormat:i,authorURL:q,author:r,skuId:t,productId:s}})}),bindWishListForm(),"undefined"!=typeof s_setP&&(setTimeout(function(){var a=0,b=parseFloat($("#quickViewRatingsDisplay").find(".bv_avgRating_component_container").length?$("#quickViewRatingsDisplay").find(".bv_avgRating_component_container").text():0),a=parseInt($("#quickViewRatingsDisplay").find(".bv_avgRating_component_container").length?$("#quickViewRatingsDisplay").find(".bv_numReviews_component_container").text().replace("(","").replace(")",""):0);trackQVAnalytics(d,e,f,g,h,i,b,a)},600),b.find("form.pdp-form").on("amplifiFormSuccess",function(){var b=[];b.productName=g,b.skuType=f,b.price=h,b.skuId=d,b.productUrl=i,b.workId=e,b.viewType="QUICKVIEW",dataAnalyticsAddToCart(b),a.Close()})),b.find("form.pdp-form").on("amplifiFormSuccess",function(){"/checkout/"===location.pathname&&location.reload()})}),$(window).on("resize",function(){var a=$(this);if(a.width()<=900){var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}})})},displaySpinner:function(){const a=$("input[name=spinnerPath]").val(),b=this.modal.getElementsByClassName("modal-quickview");$spinner=$('<div class="spinner mini-cart-spinner spinner__large"><img src="'+a+'"></div>'),$spinner&&$spinner.length>0&&$spinner.remove(),$(b).addClass("spinner-container").append($spinner)},hideSpinner:function(){$(".spinner__large").remove()},initFormatChiclet:function(a){function b(){var a=$(".textbook-format-chiklets-slider").find(".selected-format-chiclet"),b=a.find(".format-name").text().trim(),c=(a.data("content"),$("#btnAddTextbook")),d=$("#btnInstPurTextbook"),e=!1;switch(b){case"Buy New":initBuyNewTBook();break;case"Buy Used":e="1001"!==$("#usedAvailablilityStatus").val()&&"2002"!==$("#usedAvailablilityStatus").val()||"true"===$("#usedMBSStatus").val();break;case"Rent":e="1001"!==$("#rentalAvailabilityStatus").val()}if("Buy New"!=b&&($(".shipping-unavl-status--buy-new").addClass("strict-hidden"),d.removeClass("disabled").removeAttr("disabled"),"true"===$("#textBookDisabled").val()&&"true"===$("#usedMBSStatus").val()&&d.addClass("disabled").attr("disabled","true"),e?($(".purchase-button-out-of-stock-container").addClass("strict-hidden"),$(".purchase-button-container").removeClass("strict-hidden"),c.show(),d.show()):(c.hide(),d.hide(),$(".purchase-button-container, .purchase-button-out-of-stock-container").attr("style","border:none !important"),$(".purchase-button-container").addClass("strict-hidden"),$(".purchase-button-out-of-stock-container, #neverForSaleProduct").removeClass("strict-hidden")),"Rent"===b&&d.hide()),$(".pdp-text-books .purchase-button-container button:visible").length>0){var f=$(".pdp-text-books .purchase-button-container").nextAll(":visible:first");f.hasClass("mp-link--cont")&&$(".mp-link--cont").removeClass("bd-t-disabled-gray pt-ss")}else $(".mp-link--cont").addClass("bd-t-disabled-gray pt-ss")}function c(){var a=$(".textbook-format-chiklets-slider").find(".selected-format-chiclet"),b="true"===$("#usedMBSStatus").val()?!0:!1,c="true"===$("#newMBSStatus").val()?!0:!1;$(".textbook-outsource-badge").length>0&&("buy-new-price-content"===a.attr("data-content")&&c?$(".textbook-outsource-badge").removeClass("hidden"):"buy-used-price-content"===a.attr("data-content")&&b?$(".textbook-outsource-badge").removeClass("hidden"):$(".textbook-outsource-badge").addClass("hidden"))}function d(a,b){var c=$(a[0]),d=c.parent().find(".selected-format-chiclet"),e=(d.text(),d.data("content")),f=$("."+e).find(".current-price").text().replace("$","");if(""==f&&(f=d.find(".format-price strong").text()),"eMag"===b){{$($("."+e).find(".current-price").siblings().closest("span")[0]).text()}$("."+e).find(".current-price").html("<sup>$</sup>"+f),$("."+e).show(250)}}const e=$(".format-chiklets-slider").data("carousel");void 0!=e&&$(a.modal).find(".format-chiklets-slider").slick({slidesToShow:e.slidesToShow,infinite:e.infinite,slidesToScroll:e.slidesToScroll,adaptiveHeight:e.adaptiveHeight,accessibility:!1});$("#pctaValue").val();if($(a.modal).find(".format-content").removeClass(" bd-b-disabled-gray"),"textbook"===$("#skuType").val()){var f="textBook";switch($(a.modal).find(".pdp-refresh--buyoptns").hide(),h=$(".pdp-commerce-format"),$("#pctaValue").val()){case"n":i=$(".textbook-format-chiklets-slider").find('[data-content="buy-new-price-content"]');break;case"u":i=$(".textbook-format-chiklets-slider").find('[data-content="buy-used-price-content"]');break;case"r":i=$(".textbook-format-chiklets-slider").find('[data-content="rent-price-content"]');break;default:i=$(h[0])}$("ul.used-condition").hide(),$(".noteMain").hide();var g=i.data("content");i.addClass("selected-format-chiclet"),$(".price-content").removeClass("hidden"),$("."+g).show(),b(),c(),h.each(function(){$(this).on("click",function(){var a=$(this).data("content"),d=$(this).parent(),e=d.find(".selected-format-chiclet"),g=e.data("content");a!==g&&("buy-new-price-content"===a||"buy-used-price-content"===a&&($("ul.used-condition").hide(),$(".noteMain").hide()),e.removeClass("selected-format-chiclet"),$(this).addClass("selected-format-chiclet"),$("."+g).find('input[type="radio"][name="rental-options"]').attr("checked",!1),$("."+a).find('input[type="radio"][name="rental-options"]').attr("checked",!0),$("."+g).hide(),$("."+a).show(),"textBook"===f&&b()),c()})})}else if("eMagazine"===$("#skuType").val()){$(".format-chiklets-slider .slick-list").removeAttr("aria-live");var h=$(".chiclet-purchase-option"),f="eMag";if($(document).on("click","#btnAddeMag",function(){var a=$(".emag-format-chiklets-slider").find(".selected-format-chiclet"),b=a.data("content");$("."+b).find("input[type=submit].btn-addtocart").trigger("click")}),$(document).on("click","#btnInstPureMag",function(){var a=$(".emag-format-chiklets-slider").find(".selected-format-chiclet"),b=a.data("content");$("."+b).find("input[type=submit].btn-instant-purchase").trigger("click")}),h.each(function(){$(this).on("click",function(){var a=$(this).data("content"),b=$(this).parent(),c=b.find(".selected-format-chiclet"),e=c.data("content");a!==e&&(c.removeClass("selected-format-chiclet"),$(this).addClass("selected-format-chiclet"),$("."+e).find('input[type="radio"][name="rental-options"]').attr("checked",!1),$("."+a).find('input[type="radio"][name="rental-options"]').attr("checked",!0),$("."+e).hide(),$("."+a).show(250),d(h,f))})}),h.length>0){var i=$(h[0]),g=i.data("content");i.addClass("selected-format-chiclet"),$(".price-content").removeClass("hidden"),$("."+g).show(250),$(".purchase-button-container").hasClass("strict-hidden")&&$(".purchase-button-container").removeClass("strict-hidden")}}$(".format-chiklets-slider.slick-slider .format-chiklet").on("click",function(b){if(b.preventDefault(),"textbook"!==$("#skuType").val()&&"eMagazine"!==$("#skuType").val()){a.displaySpinner();var c=$(this).attr("href");c+=c.indexOf("?")>=0?"&quickview=true":"?quickview=true",a.prodUrl=c,a.trigger("display")}})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.recDisplay=BN.Modal.Browse.recDisplay||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.recDisplay.Base")};return a.prototype={tplName:"recDisplay",suppressAutoTabindex:!0,initView:function(){var a=this;this.initGenericView();var b=this.userOptions.tplParams.Ntt,c=this.userOptions.tplParams.scrollPosition;this.on("display",function(){getRecommendationBooks_ajax(b);var d=$(this.modal);d.find("input.edit-search").on("input",function(){""!==this.value?$(this).siblings(".btn-go").addClass("active"):$(this).siblings(".btn-go").removeClass("active")}),d.find(".edit-search-link, .edit-search-link-error").on("click keyup",function(a){if("click"===a.type||13===a.keyCode){var b=$(".no-results-modal").hasClass("hidden")?".search-term":".search-term-error",c=$(".no-results-modal").hasClass("hidden")?"#searchTitle":"#searchTitleErr",d=$(this).parents(".edit-search").siblings(".showing-result").find(b).text();$(c).val(d),$(".fav-finder-sad-face").addClass("invisible"),$(this).parent().siblings(".edit-search-go").removeClass("strict-hidden"),$(this).parent(".edit-search").addClass("hidden"),$(c).focus()}}),d.find(".edit-search-go .btn-go").on("click",function(){var a=$(this).siblings('input[type="text"]').val();$(this).parents(".edit-search-go").addClass("strict-hidden"),$(this).parents(".edit-search-go").siblings(".edit-search").removeClass("hidden"),d.find(".loader-placeholder").removeClass("hidden"),d.find(".recommended-search-item").addClass("strict-hidden"),d.find(".product-shelf-image img").removeClass("show-image"),d.find(":tabbable:last").off("keydown"),getRecommendationBooks_ajax(a)}),d.find("#searchTitle, #searchTitleErr").on("keydown",function(a){if(13===a.keyCode){var b=$(this).val();$(this).parents(".edit-search-go").addClass("strict-hidden"),$(this).parents(".edit-search-go").siblings(".edit-search").removeClass("hidden"),d.find(".loader-placeholder").removeClass("hidden"),d.find(".recommended-search-item").addClass("strict-hidden"),d.find(":tabbable:last").off("keydown"),getRecommendationBooks_ajax(b)}else""!==$(this).val()?$(this).siblings(".btn-go").addClass("active"):$(this).siblings(".btn-go").removeClass("active")}),d.find(".recommended-search-products").on("click keyup",function(b){if(13===b.keyCode||"click"===b.type){var d=$(".showing-result").find(".search-term").text(),e={skuId:$(this).find(".product-shelf-image").data("skuId"),imgPath:$(this).find("img").attr("src"),imgAlt:$(this).find("img").attr("alt"),pdpURL:$(this).find(".product-shelf-image").data("pdpUrl")};getRecommendationOfSelectedBook_ajax(e),a.Close(),$(window).scrollTop(c),$("#reccommendsearch").val(d)}}),d.find(":tabbable:first").on("keydown",function(a){9==a.keyCode&&a.shiftKey&&(a.preventDefault(),d.find(":tabbable:last").focus())})})}},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.Isbndef=BN.Modal.Browse.Isbndef||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Account.Isbndef")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/"},tplName:"m-isbn-definition-details"},a}(),BN.Modal.Browse.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
function checkPottermorePassthru(a,b){var c=window.open("about:blank","_blank");$.ajax({type:"POST",dataType:"json",url:"/util/setPottermorePassthru.jsp",data:{pottermoreFlag:a}}).done(function(){c&&(c.location.href=b)}).fail(function(){}).always(function(){})}BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Base=BN.Modal.Browse.PDP.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Base")};return a.prototype={},a}(),BN.Modal.Browse.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.ExtendedWarrantyDetails=BN.Modal.Browse.PDP.ExtendedWarrantyDetails||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.ExtendedWarrantyDetails")};return a.prototype={tplName:"m-extended-warranty-details",initView:function(){var a=this.data,b=$(a.target),c=b.attr("href")||"";!a.redirectSuccessUrl&&b.length>-1&&""!=c&&"#"!=c&&("/"==c.substr(0,1)&&(c=SITE_DOMAIN_URL+c),consoleLog(c),a.redirectSuccessUrl=c),this.on("display",function(){attachCartAction(!1)}),this.initGenericView(),this.initForm()}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LendMe=BN.Modal.Browse.PDP.LendMe||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LendMe")};return a.prototype={tplName:"lendme"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.BuyEGift=BN.Modal.Browse.PDP.BuyEGift||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.BuyEGift")};return a.prototype={tplName:"egift-purchase",initView:function(){this.initGenericView(),this.initForm(),this.on("display",function(){initializeTextAreaCounter($("textarea#egiftWrapMessage"),$(".limit-notifier")),initEGiftYear(),$giftDeliveryDate=$modal.find(".gift-delivery-date").offset(),$giftDeliveryDateWidth=$modal.find(".gift-delivery-date").width(),$("#egiftWrapMessage").attr("required","required")}),$modal=$(this.modal),$giftIcon=$modal.find(".icon-calendar"),$giftInput=$modal.find("#eGiftDate"),$availableDate=""==$(".buy-as-egift").attr("data-available-date")?0:new Date($(".buy-as-egift").attr("data-available-date")),$giftScrollDiv=$modal.find(".modal-personalize-your-egift"),$giftScrollDiv.on("scroll",function(){if($giftDeliveryDate=$modal.find(".gift-delivery-date").offset(),window.innerWidth<=900){var a=$giftDeliveryDate.top+41+"px",b=$giftDeliveryDate.left+"px";$("#ui-datepicker-div").css({right:b,left:"auto",top:a})}else{var a=$giftDeliveryDate.top-10+"px",b=$giftDeliveryDate.left+$giftDeliveryDateWidth+1+"px";$("#ui-datepicker-div").css({left:b,right:"auto",top:a})}}),$(window).on("resize",function(){if($giftDeliveryDate=$modal.find(".gift-delivery-date").offset(),window.innerWidth<=900){var a=$giftDeliveryDate.top+41+"px",b=$giftDeliveryDate.left+"px";$("#ui-datepicker-div").css({right:b,left:"auto",top:a})}else{var a=$giftDeliveryDate.top-10+"px",b=$giftDeliveryDate.left+$giftDeliveryDateWidth+1+"px";$("#ui-datepicker-div").css({left:b,right:"auto",top:a})}}),$giftIcon.on("click",function(){if($giftInput.datepicker("show"),window.innerWidth<=900){var a=$giftDeliveryDate.top+41+"px",b=$giftDeliveryDate.left+"px";$("#ui-datepicker-div").css({right:b,left:"auto",top:a})}else{var a=$giftDeliveryDate.top-10+"px",b=$giftDeliveryDate.left+$giftDeliveryDateWidth+1+"px";$("#ui-datepicker-div").css({left:b,right:"auto",top:a})}}),$giftInput.datepicker({showOn:"button",buttonImage:"/static/img/sprites/calendar-up.png",buttonImageOnly:!0,minDate:$availableDate,maxDate:"+1Y",showOn:"both",onClose:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-up.png"),$(".modal__header").find("h2").attr("aria-hidden","false"),$(".buy-as-egift").parent().parent().attr("aria-hidden","false")},beforeShow:function(){var a=$giftInput.siblings(".ui-datepicker-trigger");a.attr("src","/static/img/sprites/calendar-down.png"),$(".modal__header").find("h2").attr("aria-hidden","true"),$(".buy-as-egift").parent().parent().attr("aria-hidden","true"),setTimeout(function(){if(window.innerWidth<=900){var a=$giftDeliveryDate.top+41+"px",b=$giftDeliveryDate.left+"px";$("#ui-datepicker-div").css({right:b,left:"auto",top:a})}else{var a=$giftDeliveryDate.top-10+"px",b=$giftDeliveryDate.left+$giftDeliveryDateWidth+1+"px";$("#ui-datepicker-div").css({left:b,right:"auto",top:a})}var c=$(".ui-datepicker-month").text(),d=$(".ui-datepicker-year").text();$(".ui-datepicker-calendar").find("td").each(function(){var a=$(this).find(".ui-state-default").text(),b=c+" "+a+", "+d;$(this).find(".ui-state-default").attr("aria-label",b)}),$(".ui-datepicker-prev").attr("href","#"),$(".ui-datepicker-next").attr("href","#"),$(".ui-datepicker-prev").hasClass("ui-state-disabled")?($("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):($("#ui-datepicker-div .ui-datepicker-prev").focus(),$("#ui-datepicker-div .ui-datepicker-prev").addClass("focus"))},100)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-prev").attr("href","#"),$(".ui-datepicker-next").attr("href","#"),$(".ui-datepicker-prev").hasClass("ui-state-disabled")?($("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):($("#ui-datepicker-div .ui-datepicker-prev").focus(),$("#ui-datepicker-div .ui-datepicker-prev").addClass("focus"))},100)}}).on("change",function(){var a=$giftInput.val().split("/");""!==a&&$giftInput.closest(".text-input").removeClass("invalid"),$modal.find("#eGiftMonth").val(a[0]),$modal.find("#eGiftDay").val(a[1]),$modal.find("#eGiftYear").val(a[2]),$(".text-input-with-calendar").focus(),$(".text-input-with-calendar").addClass("focus"),setTimeout(function(){$("#egiftWrapMessage").focus(),$("#egiftWrapMessage").addClass("focus"),$("#egiftWrapMessage").trigger("click")},100)}),$(document).on("keydown",function(a){9===a.which&&($(".ui-datepicker-calendar").hasClass("focus")&&(a.shiftKey||($(a.target).parent().next().hasClass("ui-datepicker-other-month")?(a.preventDefault(),$("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")):0===$(a.target).parent().parent().next().length&&0===$(a.target).parent().next().length&&(a.preventDefault(),$("#ui-datepicker-div .ui-datepicker-next").focus(),$("#ui-datepicker-div .ui-datepicker-next").addClass("focus")))),a.shiftKey&&($(a.target).hasClass("ui-datepicker-prev")||$(a.target).hasClass("ui-datepicker-next"))&&($(a.target).hasClass("ui-datepicker-next")?$(".ui-datepicker-prev").hasClass("ui-state-disabled")&&($giftInput.datepicker("hide"),$giftInput.parents(".row").prev().find("label").last().siblings("input").each(function(){"hidden"!==$(this).attr("type")&&$(this).focus()}),a.preventDefault()):$(a.target).hasClass("ui-datepicker-prev")&&($giftInput.datepicker("hide"),$giftInput.parents(".row").prev().find("label").last().siblings("input").each(function(){"hidden"!==$(this).attr("type")&&$(this).focus()}),a.preventDefault())))})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.CvvCode=BN.Modal.Browse.PDP.CvvCode||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.CvvCode")};return a.prototype={tplName:"cvvcode",defaultOptions:{tplDir:SITE_ROOT+"/modals/",tplExt:".jsp",css:!1,modalIsScrollable:!1,position:{center:!1,anchor:["target","bottom left"]},posBuffer:{anchor:{bottom:20,left:50}},overlayClose:"this",hideParent:!1,stackOverlay:!0},invisibleOverlay:!0,initView:function(){var a=($(this.modal),$(this.data.target));a.attr("data-icon","tooltip-active"),this.closeEvents.all.push(function(){a.attr("data-icon","plus-expand")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Duplicatesample=BN.Modal.Browse.PDP.Duplicatesample||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Duplicatesample")};return a.prototype={tplName:"m-duplicatesample",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){var a=this;this.on("display",function(){$("#buySampleAsGift").click(function(){a.Close(),$(".buy-as-egift").click()})}),this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b.find("a#getFreeNookSample")),b.find("a#getFreeNookSample").focus()):consoleLog("can't return focus to the modal-opening element, as it could not be found"),$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.eMagFreeTrial=BN.Modal.Browse.PDP.eMagFreeTrial||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.eMagFreeTrial")};return a.prototype={tplName:"e-mag-trial"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.eMagSubscription=BN.Modal.Browse.PDP.eMagSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.eMagSubscription")};return a.prototype={tplName:"e-mag-subscr"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.AddToBag=BN.Modal.Browse.PDP.AddToBag||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.AddToBag")};return a.prototype={tplName:"m-add-to-bag-ra",initView:function(){var a=this,b=this.data,c=$(this.modal);if(consoleLog("closeEvents for AddToBag modal = ",this.closeEvents),a.on("display",function(){$("#continueShopping").on("click",function(){-1!==window.location.pathname.indexOf("account/wishlist")&&($("#wlNotAddedError").addClass("d-none"),location.reload()),$("#addToCartSuccessModalOpenFrom").length>0&&$("#addToCartSuccessModalOpenFrom").val("pdp"),closeAllModals()}),$("#pdp-small-miniCart").on("click",function(){a.Close(),$("#miniCart").css("display","block"),RhfMiniCartShowCart()})}),b&&(b.title&&"string"==typeof b.title&&c.find("#dialog-title").text(b.title),b.onClose&&this.closeEvents.all.push(b.onClose),b.messages)){var d=Modal.prototype.openModals;if(d)for(var e in d){var f=d[e];f&&f.Close&&f.Close()}}}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.GiftWithPurchasePdp=BN.Modal.Browse.PDP.GiftWithPurchasePdp||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.GiftWithPurchase")};return a.prototype={tplName:"m-gift-with-purchase-pdp",initView:function(){{var a=this.data;$(this.modal)}consoleLog("closeEvents for GiftWithPurchase modal = ",this.closeEvents),a.onClose&&this.closeEvents.all.push(a.onClose),this.initGenericView()}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.HowTextbookRentalsWork=BN.Modal.Browse.PDP.HowTextbookRentalsWork||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.HowTextbookRentalsWork")};return a.prototype={tplName:"how-textbook-rentals-work"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.ImageViewer=BN.Modal.Browse.PDP.ImageViewer||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.ImageViewer")};return a.prototype={tplName:"liquid-pixel-viewer.jsp",defaultOptions:{useCache:!1},initView:function(){var a=$(this.modal),b=[],c=0;this.on("display",function(){function d(){$("#pdpZoomerImage img").attr("src",b[c])}$("[data-modal-name =liquid-pixel-viewer] .modal__header a").focus();var e=$(".modal__content.modal--854-wide");e.addClass("pdpZoomerImage-viewport"),e.find(".icon-close-modal").addClass("close-fixed"),$(".product-thumbs img").each(function(){var a=$(this).attr("src"),c=a.substring(0,a.lastIndexOf("_")+1),d=a.substring(a.lastIndexOf("_")+1,a.length),e="s600x595",f=d.split(/\./)[1],g=c+e+"."+f,h=g.split(",").find(function(a){return a.indexOf("size")>-1});if(h){var i=h.substr(7,3),j=2*parseInt(h.substr(7,3));j.toString();var k=h.replace(i,j),l=h;h=k;var m=g.replace(l,h);b.push(m)}else b.push(g)});var f=$("#prodImage .slick-current img").attr("src"),g=f.substring(0,f.lastIndexOf("_")+1),h=f.substring(f.lastIndexOf("_")+1,f.length),i="s600x595",j=h.split(/\./)[1],k=g+i+"."+j;if($("<img>",{src:f}).prependTo("#pdpZoomerImage"),$("#pdpZoomerImage img").addClass("pdpZoomerImage-marginbtm"),b.length>0){for(var l=0;l<b.length;l+=1)b[l]==k&&(c=l);$("#prevImage").on("click keydown",function(a){("click"==a.type||13==a.keyCode)&&(c--,0>c&&(c=b.length-1),d(c))}),$("#nextImage").on("click keydown",function(a){("click"==a.type||13==a.keyCode)&&(c++,c==b.length&&(c=0),d(c))}),a.on("keydown",function(a){39==a.keyCode&&$("#nextImage").focus().click(),37==a.keyCode&&$("#prevImage").focus().click()})}else $("#prevImage").addClass("hidden"),$("#nextImage").addClass("hidden");$(window).on("resize",function(){var a=$(this);if(a.width()<=900){var b=Modal.prototype.openModals;for(var c in b){var d=b[c];d&&d.Close&&d.Close()}}})})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.InstantPurchase=BN.Modal.Browse.PDP.InstantPurchase||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.InstantPurchase")};return a.prototype={tplName:"instant-purchase",defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/",useCache:!1},initView:function(){var a=this,b=$(this.modal),c=this.data.instantPurchaseError,d="data.error-state",e=d+'[value="'+c+'"]',f=b.find("#requireCVV"),g="";if($("#contentDivId").length>0&&(g=$("#contentDivId").val(),containerDivId="#"+g),b.find(e).length>0?b.find(d).not(e).remove():b.find(d).not(d+'[value="generic-error"]').remove(),"invalidAddress"==c){var h=b.find("#other-errors").find("ul");$.each(this.data.errors,function(a,b){h.append("<li>"+b+"</li>")}),h.closest("#other-errors").removeClass("hidden")}b.find("#ccCode").length>0&&$(".formCVVCode").attr("minLength",b.find("#ccCode").attr("maxLength")),b.find("#ccCode").on("keyup keydown keypress focusin focusout",function(){$(".formCVVCode").attr("minLength",b.find("#ccCode").attr("maxLength"))}),b.find(".btn-instant-purchase").on("click",function(c){c.preventDefault(),c.stopPropagation(),$(f).hide(),$(".formCVVCode").val(b.find("#ccCode").val()),$(this).addClass("disabled");var d=$("form.ip-form .btn-instant-purchase");d.length&&d.addClass("disabled");var e=$("#btnInstPurTextbook");e.length&&e.addClass("disabled");var h=$("#btnInstPureMag");h.length&&h.addClass("disabled");var j=$("input.formCVVCode").attr("data-skuid")||a.data.instantPurchaseSkuId,k=$("input.formCVVCode").val(),l=$("input.formCVVCode").attr("minLength"),m=$('input[value="'+j+'"]').closest("form"),n=$('[data-modal-name="quickview"]').length>0,o=n?m.parents("#quick-view-productDetail").find(".btn-instant-purchase"):""!=g?m.parents(".PageContent").find(containerDivId).find(".btn-instant-purchase"):m.parents(".PageContent").find(".btn-instant-purchase"),p=/^\d+$/;if(k.length<l||!p.test(k))return $(this).removeClass("disabled"),d.length&&d.hasClass("disabled")&&d.removeClass("disabled"),e.length&&e.hasClass("disabled")&&e.removeClass("disabled"),h.length&&h.hasClass("disabled")&&h.removeClass("disabled"),$(f).html('<em class="emphasis emphasis--alert">The security code that you entered is not valid.  Please check your code and try again.</em>'),$(f).show(),void $("input.formCVVCode").val("");if(a.flow().get(0).Close(),$(".sign-in-instant-purchase").is(":visible")&&($(".sign-in-instant-purchase").hide(),o.removeClass("hidden")),e.length||h.length)for(i=0;i<o.length;i++)$(o[i].closest(".purchase-options-item")).hasClass("grdnt-fade-white")||o[i].click();else o.filter(":visible").click()}),this.on("display",function(){$(".security-code-tooltip").tooltip()}),b.find(".expand-cvv").on("click",function(){b.find(".expand-cvv-container").toggle(),b.find(".expand-cvv").toggleClass("expandicon-change")}),$(".pdp-errors").removeClass("display-error").empty(),this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b),b.focus()):(consoleLog("can't return focus to the modal-opening element, as it could not be found so setting focus directly"),""!=g&&(g="#"+g+" "),$(g+".ip-form .btn-instant-purchase").focus()),$(".formatSelect").find("a.selectBox-dropdown").removeClass("focus")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LearnBuyRent=BN.Modal.Browse.PDP.LearnBuyRent||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LearnBuyRent")};return a.prototype={tplName:"m-learn-buy-rent",defaultOptions:{tplDir:SITE_ROOT+"/modals/"}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Audio=BN.Modal.Browse.PDP.Audio||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Audio")};return a.prototype={tplName:"audio-player-ra",initView:function(){function a(a,b){$("<source />").attr("src",b).appendTo(a)}var b=this.data,c=$(this.modal),d=$(b.target),e=d.attr("href")||"",f=c.find("#dialog-title"),g=d.text(),h=$("<audio />",{name:"audioClipFrame",id:"audioClipFrame",autoPlay:"autoplay",controls:"controls"});a(h,e),f.html(g?g:"&nbsp;"),c.find(".embed-container").html(h)}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.LexileMeasures=BN.Modal.Browse.PDP.LexileMeasures||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.LexileMeasures")};return a.prototype={tplName:"m-lexile-measures",defaultOptions:{tplDir:SITE_ROOT+"/modals/"}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Bloomreach=BN.Modal.Bloomreach||{},BN.Modal.Bloomreach.Base=BN.Modal.Bloomreach.Base||Extend(function(){var a=function(a,b){this.target=b.target,this.templateName=a,consoleLog("Instantiating BN.Modal.Bloomreach.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/bloomreach/"},tplName:this.templateName,initView:function(){var a=this.data,b=$(this.modal),c="bn-sf-widget-merchant-popup",d=b.find("#bloomReachDetailsModal"),e=this.target.getAttribute("data-pdpurl"),f=this.target.getAttribute("data-imgurl"),g=this.target.getAttribute("data-synopsis"),h=(this.target.getAttribute("data-ean"),this.target.getAttribute("data-title")),i=g.length>250?g.slice(0,247)+"...":g;if(a){var j='<a href="'+e+'" title="'+h+'" onclick="set_cookie(\''+c+"-img-explore-more-"+e+"_na_image');\">";j+=f?'<img src="https://'+f+'" alt="'+h+'" title="'+h+'" class="lp-lazy full-shadow" data-bottom-align="">':'<img src="//prodimage.images-bn.com/mimages/0000000000000_p0_v0_s192x300.jpg" width="95" alt="'+h+'" title="'+h+'" class="lp-lazy full-shadow" data-bottom-align="">',j+="</a>",d.find("."+c+"-img").html(j);var k='<a href="'+e+'" title="'+h+'" onclick="set_cookie(\''+c+"-title-explore-more-"+e+"_na_text');\">"+h+"</a>",l='<a href="'+e+'" title="'+h+'" onclick="set_cookie(\''+c+"-link-explore-more-"+e+"_na_link');\">View Full Product Details</a>";d.find("."+c+"-title").html(k),d.find("."+c+"-desc").html(i),d.find("."+c+"-view").html(l)}}},a}(),BN.Modal.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.PottermoreBuy=BN.Modal.Browse.PDP.PottermoreBuy||Extend(function(){var a=function(a,b){consoleLog("Instantiating BN.Modal.Browse.PDP.PottermoreBuy"),this.options.tplParams={pottermoreUrl:encodeURIComponent($(b.target).attr("href")),pottermoreEan:$(b.target).attr("id")},this.Display()};return a.prototype={defaultOptions:{autoDisplay:!1,tplDir:SITE_ROOT+"/modals/nook/"},tplName:"pottermore_buy_window"},a}(),BN.Modal.Browse.PDP.Base,"before"),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Promise=BN.Modal.Browse.PDP.Promise||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.Promise")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/checkout/"},tplName:"delivery-promise"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.RentalTOU=BN.Modal.Browse.PDP.RentalTOU||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.RentalTOU")};return a.prototype={tplName:"rental-terms-of-use"},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.Reserve=BN.Modal.Browse.PDP.Reserve||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Reserve")};return $(document).on("click",'[data-modal-class="BN.Modal.Browse.PDP.Reserve"]',function(){$(".modal-pick-up-in-store").removeAttr("aria-labelledby"),$(".modal-pick-up-in-store").attr("aria-hidden","true"),$(".modal-pick-up-in-store h2").removeAttr("id")}),a.prototype={tplName:"puis",initView:function(){var a=$(this.modal),b=this,c=this.flow().get("quickview"),d=Date.now(),e=$('[id^="skuSelection"]').find('[name^="/"][name*="catalogRefIds"]').val(),f=$(this.data.target).parents().find('[name="zip"]').val();if(e=void 0===e||""==e?getQueryParameterByName("ean"):e,$("body.account.wishlist").length>0)var g=$(this.parent.data.target).closest(".row").find(".bag-info"),e=g.find('[name="wishlistForm"] [name^="/"][name*="catalogRefIds"]').val();this.displaySpinner(),BN.uXHR.getService("puis",{time:d,ean:e,zipcode:f},function(c){a.find("iframe").attr("src",c.service.endpointUrl),b.hideSpinner(),modalObjToReset=b,resetModalTabbing(modalObjToReset,!0)}),this.initPostMessageListener(),this.closeEvents.all.push(function(){b.removePostMessageListener()}),c&&c.hide()},initPostMessageListener:function(){var a=this;this.postMessageListener=function(b){var c=b.originalEvent.data;if("closeModal"===c&&a.Close(),c&&c.type&&c.revenue&&c.quantity&&"reserveInStoreSuccess"===c.type){var d=c.revenue,e=c.quantity;"undefined"!=typeof s_setP&&trackReserveInStore(d,e)}},$(window).on("message",this.postMessageListener)},removePostMessageListener:function(){$(window).off("message",this.postMessageListener)},postMessageListener:function(){}},a}(),BN.Modal.Base),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.ReserveTT=BN.Modal.Browse.PDP.ReserveTT||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.ReserveTT"),this.originClass.apply(this,arguments)};return a.prototype={tplName:"puis-tooltip",defaultOptions:{css:!1,modalIsScrollable:!0,position:{center:!1,anchor:["target","bottom center"]},posBuffer:{anchor:20},hideParent:!1},invisibleOverlay:!0,initView:function(){{var a=this,b=$(this.modal),c=this.parent;c&&"BN.Modal.Browse.Quickview"===c.data["modal-class"]?!0:!1}b.find("form").on("submit",function(b){b.preventDefault(),a.displaySpinner()}),this.on("display",function(){this.addTabIndex(),this.initTabIndex(),(""!=data["modal-postalcode"]||"undefined"!=data["modal-postalcode"])&&b.find(".inp-marg").val(data["modal-postalcode"]),b.css("position","fixed"),b.find("a[data-close]").attr("data-close","this"),$(".icon-close-modal").focus()}),this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b),b.focus()):consoleLog("can't return focus to the modal-opening element, as it could not be found"),$("body").removeClass("modal-open"),$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")})}},a}(),BN.Modal.Base,!1),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Sampleadded=BN.Modal.Browse.PDP.Sampleadded||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Sampleadded")};return a.prototype={tplName:"m-sampleadded",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){{var a=this,b=($(this.modal),this.parent);b&&"BN.Modal.Browse.Quickview"===b.data["modal-class"]?!0:!1}this.closeEvents.all.push(function(){var b;a.data&&a.data.target?(b=$(a.data.target),consoleLog("returning focus to ",b.find("a#getFreeNookSample")),b.find("a#getFreeNookSample").focus()):consoleLog("can't return focus to the modal-opening element, as it could not be found"),$(".account-settings-sidebar .account-menu .menu-list .account-menu-item").removeClass("focus")})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse=BN.Modal.Browse||{},BN.Modal.Browse.PDP.TextbookRentalFAQ=BN.Modal.Browse.PDP.TextbookRentalFAQ||Extend(function(){var a=function(a,b){this.data=b,consoleLog("Instantiating BN.Modal.Browse.PDP.TextbookRentalFAQ")};return a.prototype={tplName:"rentals-faq",initView:function(){this.on("display",function(){$(".icon-close-modal").focus()})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Ultraviolet=BN.Modal.Browse.PDP.Ultraviolet||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Ultraviolet")};return a.prototype={tplName:"m-ultraviolet",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.UpgradeSubscription=BN.Modal.Browse.PDP.UpgradeSubscription||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.UpgradeSubscription")};return a.prototype={tplName:"e-mag-how",initView:function(){this.on("display",function(){$(".icon-close-modal").focus()})}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.UltravioletSignIn=BN.Modal.Browse.PDP.UltravioletSignIn||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Ultraviolet")};return a.prototype={tplName:"m-uv-signin-form",defaultOptions:{tplDir:SITE_ROOT+"/modals/"},initView:function(){}},a}(),BN.Modal.Browse.PDP.Base,!0),BN.Modal.Browse.PDP=BN.Modal.Browse.PDP||{},BN.Modal.Browse.PDP.Video=BN.Modal.Browse.PDP.Video||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Browse.PDP.Video")};return a.prototype={tplName:"video-player-ra",_isHTML5VideoSupported:function(){var a=!1,b=document.createElement("video");return b&&"function"==typeof b.canPlayType&&(a=!0),a},_isVideoCodecSupported:function(){var a=!1,b=document.createElement("video");return b&&"function"==typeof b.canPlayType&&(b.canPlayType('video/mp4; codecs="avc1.42E01E"')||b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'))&&(a=!0),a},_tokenizeTemplate:function(a,b){var c=a,d=null,e=null;for(d in b)b.hasOwnProperty(d)&&(e=new RegExp("%"+d+"%","g"),c=c.replace(e,b[d]));return c},_flashEmbedKitDigitalPlayer:function(a){var b=a.stem,c=a.assetId,d="",e="",f="&autoPlay=true&revision=1&scaleMODE=letterbox&width="+a.width+"&height="+a.height,g="";return b?(d="/mediasuite_3732/AppShell_lu8l0r86.swf",g=b+c,e="mediaURL="+g+f):(d="/mediasuite_3732/AppShell_lu8l0r86.swf",e="mediaSuiteURL=https://player.multicastmedia.com/ws/get_asset_project/asset/"+c+"/stream/api_f4d84551-2e85-103a-a1ba-00e08655b9fc/apiv_3.5/gft_0/"+c+".xml"+f+"&getEmbed=https://mediasuite.multicastmedia.com/ws/get_appstudio_embed/v1/vodproject/project_uuid/kvv27swx.xml&src=https://api.mediasuite.multicastmedia.com/templates/AppStudio/CustomPlayer/3/7/3732/lu8l0r86/lu8l0r86.json&",g="https://player.piksel.tech/singleAssetPlayer.php?api=62a92236-269b-11e3-b5cd-005056865f49&aid="+c+"&player_uuid=rzz16131&de-html-default=true&de-delivery-type=pd&de-autoplay=true&de-responsive=true&de-width="+a.width+"&de-height="+a.height),this._tokenizeTemplate(a.objtemplate,{WIDTH:a.width,HEIGHT:a.height,PLAYERID:d,FLASHVARS:e,VIDEOURL:g})},_html5VideoPlayerTag:function(a){var b="",c="",d=a.stem;return d&&(c=d+a.assetId,b=this._tokenizeTemplate(a.html5template,{WIDTH:a.width,HEIGHT:a.height,VIDEOURL:decodeURIComponent(c)})),b},_kitDigitalPlayerIframe:function(a){var b="",c="",d="",e="&autoPlay=true&revision=1&scaleMODE=letterbox&width="+a.width+"&height="+a.height;return urlEscapeFn=encodeURIComponent,assetId=a.assetId,stem=a.stem,stem?c="mediaUrl="+(stem+assetId)+e:(d="https://player.multicastmedia.com/ws/get_asset_project/asset/"+assetId+"/stream/api_f4d84551-2e85-103a-a1ba-00e08655b9fc/apiv_3.5/gft_0/"+assetId+".xml",c="mediaSuiteURL="+urlEscapeFn(d)+e+"&getEmbed="+urlEscapeFn("https://mediasuite.multicastmedia.com/ws/get_appstudio_embed/v1/vodproject/project_uuid/kvv27swx.xml")+"&widgetId=lu8l0r86&widgetHost=www.appstudio.piksel.tech&src="+urlEscapeFn("https://player.multicastmedia.com/ws/get_appstudio_player_json/callback/KickUtils.scriptLoadCallbacks[0]/lu8l0r86.json")),b='<iframe src="https://www.appstudio.piksel.tech/kickFlash/js/compiler/mediasuite/iframe.html?affiliateSiteId=mediasuite_73&'+c+"&referralUrl="+urlEscapeFn(window.location.href)+'" height="'+a.height+'" width="'+a.width+'" frameborder="0" scrolling="no"style="border:none;overflow:hidden;width:'+a.width+"px;height:"+a.height+'px"></iframe>'},initView:function(){var a=$(this.modal),b=a.find("#dialog-title"),c=$(this.data.target).attr("data-media-title"),d=this._isHTML5VideoSupported(),e=this._isVideoCodecSupported(),f={"default-default":{width:"600",height:"300",source:"default",padx:20,pady:20,objtemplate:'<iframe class="video-player" .frame border="0" scrolling="no" title="Video Player" align="middle" src="%VIDEOURL%" height="%HEIGHT%" width="%WIDTH%" allowtransparency="true" allowfullscreen></iframe>',html5template:'<video id="videoplayer" width="500" height="%HEIGHT%" controls preload="none" aria-label="video"><!-- MP4 must be first for iPad! --><source src="%VIDEOURL%" type="video/mp4" /><!-- WebKit video --></video>'},"ooyala-default":{width:"800",height:"534",padx:20,pady:14,source:"ooyala",objtemplate:"https://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"},"ooyala-wide":{width:"800",height:"534",padx:14,pady:98,source:"ooyala",objtemplate:"https://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"},"ooyala-tall":{width:"336",height:"575",padx:14,pady:98,source:"ooyala",objtemplate:"https://player.ooyala.com/player.js?playerId=ooplayerdiv&playerContainerId=ooplayer%ASSETID%&width=%WIDTH%&height=%HEIGHT%&embedCode=%ASSETID%&version=2",pcode:"43Y3Y6G5cQeLfnCyD655LkR7eFC9"}},g=$(this.data.target).attr("data-media-stem"),h=$(this.data.target).attr("data-asset-id"),i=$(this.data.target).attr("data-asset-source"),j=$(this.data.target).attr("data-asset-skin"),k="",i=null===i||""===i?"default":i,j=null!==j&&""!==j?j:"default",l=null!==j&&""!==j?i+"-"+j:i;g=encodeURIComponent(g).replace(/'/g,"%27").replace(/"/g,"%22");var m={};m.assetId=h,m.source=f[l].source,m.stem=g,m.css_prefix=l,m.padx=f[l].padx,m.pady=f[l].pady,m.width=f[l].width,m.height=f[l].height,m.skin=j,m.objtemplate=f[l].objtemplate,m.html5template=f[l].html5template,m.pcode=f[l].pcode,this.on("display",function(){b.html(c?c:"&nbsp;"),d&&e?m.stem?(k=this._html5VideoPlayerTag(m),$(".modal__content").removeClass("modal--854-wide"),$(".modal__content").addClass("stem-video-width"),$(".modal__dialog").addClass("video-modal-dialog")):k=this._flashEmbedKitDigitalPlayer(FlashDetect.versionAtLeast(10,0,0)?m:m):k=FlashDetect.versionAtLeast(10,0,0)?this._flashEmbedKitDigitalPlayer(m):'<h2>This player requires either Flash or HTML5.</h2><p>Please download <a href="https://get.adobe.com/flashplayer/" alt="Adobe Flash Player" target="_blank">Flash Player</a> or upgrade your browser to support HTML5 H.264 videos.</p>',a.find(".embed-container").append(k);var f=$("#videoplayer"),g=0,h=c||"No title";"undefined"!=typeof s_setP&&($("#videoplayer").on("ended",function(){trackVideo("endVideo",h)}),$("#videoplayer").on("play",function(){1>g&&trackVideo("startVideo",h),g++})),f.play()})}},a}(),BN.Modal.Browse.PDP.Base,!0);;/*! BARNES-BUILDER 2024-02-21 */
BN.Modal.Newsletter=BN.Modal.Newsletter||{},BN.Modal.Newsletter.Base=BN.Modal.Newsletter.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.Newsletter.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/newsletter/"},tplName:"newsletter",initView:function(){var a=this.data,b=this,c=$(this.modal),d=c.find("form");a.description&&"string"==typeof a.description&&c.find("h2").html(a.description),a.footerNote&&"string"==typeof a.footerNote&&c.find(".newsletter-modal__footnote").html(a.footerNote),BN.Validate.Listen(d),BN.uXHR.Form.apply(d),d.on("amplifiFormSuccess",function(){new BN.Modal.NewsletterSuccess.Base(null,{successMsg:a.successMsg},null,null),$(document).trigger("analytics-email-signup"),b.Close()}).on("amplifiFormError",function(a,b,c,e,f){var g=f.items;BN.Validate.DisplayErrors(this,g),d.find("input[type=text]").addClass("user-error")}).on("amplifiFormBeforeSubmit",function(){d.find("input[type=text]").removeClass("user-error")})}},a}(),BN.Modal.Base,!0),BN.Modal.NewsletterSuccess=BN.Modal.NewsletterSuccess||{},BN.Modal.NewsletterSuccess.Base=BN.Modal.NewsletterSuccess.Base||Extend(function(){var a=function(){consoleLog("Instantiating BN.Modal.NewsletterSuccess.Base")};return a.prototype={defaultOptions:{tplDir:SITE_ROOT+"/modals/newsletter/"},tplName:"thank-you",initView:function(){var a=this.data,b=$(this.modal);a.successMsg&&"string"==typeof a.successMsg&&b.find("h2").html(a.successMsg)}},a}(),BN.Modal.Base,!0);