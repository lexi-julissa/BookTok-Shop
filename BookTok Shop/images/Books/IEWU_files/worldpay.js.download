/*! BARNES-BUILDER 2024-02-21 */
function callEprotect(){"object"!=typeof new eProtect&&alert("Sorry! An error occurred while processing your credit card. Please try again or call Customer Service at 1-201-559-3882.")}function setEprotectResponseFields(a){var b=$("#paymentFormContainerId").val(),c="";b&&(c="#"+b+" "),$(".checkoutId").length>0&&a.checkoutId&&$(".checkoutId").val(a.checkoutId),$(c+"#paypageRegistrationId").length>0&&$(c+"#paypageRegistrationId").val(a.paypageRegistrationId),$("#barclayPaypageRegId").length>0&&$("#barclayPaypageRegId").val(a.paypageRegistrationId)}function submitAfterEprotect(a){setEprotectResponseFields(a);var b=$("#paymentFormContainerId").val(),c=$("#newCardNumber").length>0?"newCardNumber":"ccNumber",d=$("#hiddenCardNumber").val(),e=getFullCardType(a.type),f=$("#barclayCardNumber").val();b?($("#"+b+" #"+c).val(d),$("#"+b+" #creditCardType").val(e)):$("#barclayCardNumber").length>0?($("#barclayCardNumber").val(d),$("#barclayCardType").val(e)):($("#"+c).val(d),$("#creditCardType").val(e));var g=window.location.pathname;"/account/manage/payment/new.jsp"==g?$("#saveNewPayment").click():"/account/manage/memberships/edit-membership-details.jsp"==g?$(".membership-renew #memberSubmitBtn").click():"/checkout/payment.jsp"==g||"/checkout/guest-checkout.jsp"==g?$("#barclayCardNumber").length>0&&""!=f?$("#saveBarclayPayment").click():$(".guest-payment #continue").click():"/checkout/checkout.jsp"==g?$("#barclayCardNumber").length>0&&""!=f?$("#saveBarclayPayment").click():"registeredAddPayment"==b?$("#addBillingAddressSubmitBtn").click():$("#"+b+" #addAddressSubmit").click():"/account/audiobook/purchase-audiobook-subscription.jsp"==g?$("form[id^=audiobookForm]:visible").find("input[type=submit]").click():"/account/audiobook/reactivate-audiobook-subscription.jsp"==g?$("form[id^=audiobookForm]:visible").find("input[type=submit]").click():$("#audiobookForm--new").length>0&&($(".modal-purchase-subscription").length>0||$(".reactivate-subscription").length>0)?$("form[id^=audiobookForm]:visible").find("input[type=submit]").click():$("#audiobookForm--new").length>0&&$(".modal-add-credit-card").length>0?$("form[id^=audiobookForm]:visible").find("input[type=submit]").click():$(".modal-add-credit-card").length>0?$("form[id^=addPaymentSavedAddress]:visible").find("input[type=submit]").click():$("#addPremiumMembershipProgramme").length>0?$("#saveNewPayment").click():$("#addAddressSubmit").click()}function submitAfterEprotectCvv(a){setEprotectResponseFields(a);var b=$("#paymentFormContainerId").val(),c=$("#hiddenSecurityCode").val(),d="";b&&(d="#"+b+" ");var e=$(d+"#csv").length>0?"csv":"ccCode";$(d+"#"+e).val(c),$("#confirmSecurityCodeHiddenBtn").length>0?$("#confirmSecurityCodeHiddenBtn").click():$("#addPremiumMembershipProgramme").length>0&&($("#radio_1").is(":checked")&&($("#nameOnCard").val(""),$("#csv_new").val(c)),$("#saveNewPayment").click())}function timeoutOnEprotect(){var a="We are experiencing technical difficulties. Please try again later or call 555-555-1212.";displayError(a)}function onErrorAfterEprotect(a){setEprotectResponseFields(a);var b="";return"871"==a.response?b="Sorry! We were unable to process your credit card. Please enter a valid card number and try again.":"872"==a.response?b="Sorry! The card number entered is too short. Please enter a valid card number and try again.":"873"==a.response?b="Sorry! The card number entered is too long. Please enter a valid card number and try again.":"874"==a.response?b="Sorry! The card number entered includes invalid characters. Please enter a valid card number and try again.":"875"==a.response?b="Sorry! An error occurred while processing your credit card. Please try again or call Customer Service at 1-201-559-3882.":"876"==a.response?b="Sorry! We were unable to process your credit card. Please enter a valid card number and try again.":"881"==a.response?b="Sorry! The security code entered includes invalid characters. Please enter a valid security code and try again.":"882"==a.response?b="Sorry! The security code entered is too short. Please enter a valid security code and try again.":"883"==a.response?b="Sorry! The security code entered is too long. Please enter a valid security code and try again.":"889"==a.response&&(b="Sorry! An error occurred while processing your credit card. Please try again or call Customer Service at 1-201-559-3882."),displayError(b),!1}function getDisplayErrorId(){var a=$("#barclayCardNumber"),b=[];if(window.location.href.indexOf("/account/manage/payment/new")>-1)b[0]="#addPaymentErr",b[1]="html, body";else if(window.location.href.indexOf("/checkout/payment")>-1)b[0]="#card-error",b[1]="html, body";else if(window.location.href.indexOf("/checkout/checkout.jsp")>-1||window.location.href.indexOf("/account/orders/order-details")>-1){var c=$("#paymentFormContainerId").val();if("checkCVV"==c){var d=$("#"+c).attr("data-messaging");b[0]=d,b[1]="#modalContainer"}else{var e=$("#"+c).find("form#addPaymentSavedAddress")[0];e||(e=$("#"+c+" .add-credit-card-form").find("form#addPaymentSavedAddress")[0]);var d=e.getAttribute("data-messaging");b[0]="#"+c+" "+d,b[1]="#"+c}}else if(window.location.href.indexOf("account/manage/memberships/automatic-renewal-settings")>-1)b[0]="#renewalErrorBlock",b[1]="html, body";else if($("#addPremiumMembershipProgramme").length>0||$(".manage-membership-account").length>0)b[0]="#editMembershipErrorBlock",b[1]="html, body";else if($("[id^=audiobookForm]").length>0)b[0]="#audiobookError",b[1]="html, body";else if(window.location.href.indexOf("/checkout/guest-checkout")>-1){var e=$("#checkoutForm")[0];a.length>0&&""!=a.val()&&(e=$("#barclayPaymentForm")[0]);var d=e.getAttribute("data-messaging");b[0]=d,b[1]="html, body"}else window.location.href.indexOf("/w/")>-1||window.location.href.indexOf("/")>-1||window.location.href.indexOf("/s/")>-1||window.location.href.indexOf("/checkout/")>-1?(b[0]="#requireCVV",b[1]="#modalContainer"):(b[0]="#mAddCCErr",b[1]=".modal-add-credit-card");return b}function displayError(a){if(""!=a){var b=getDisplayErrorId();$(b[0]).show(),$(b[0]).html('<em class="emphasis emphasis--alert">'+a+"</em>"),$(b[0]).length>0&&$(b[1]).animate({scrollTop:$(b[0]).offset().top},1e3)}}function getFullCardType(a){var b=a.toUpperCase();switch(b){case"VI":return"visa";case"MC":return"masterCard";case"AX":return"americanExpress";case"DI":return"discover";case"DC":return"dinersClub";case"JC":return"jcb";default:return""}}$(document).ready(function(){$(document).on("click","#addNewPaymentDetails",function(){if(($("#firstName").length&&$("#lastName").length)>0)var a=checkValidMemberName($("#firstName").val()),b=checkValidMemberName($("#lastName").val());var c=$("#newCardNumber").length>0?"newCardNumber":"ccNumber",d=$(this).parents()[4],e=d.id;if(e){var f=$("#"+e+" #"+c),g=$("#"+e+" #csv");if($("form[id^=audiobookForm]").length>0)var h=$("form[id^=audiobookForm]:visible").find("#csv").val();else var h=g.val();var i={value:h}}else var f=$("#"+c),g=$($(".instant-purchase-new-cvv").hasClass("user-success")?".instant-purchase-new-cvv":"#csv"),i=$(".instant-purchase-new-cvv").hasClass("user-success")?{value:g.val()}:document.getElementById("csv");var j=f.val();$("#hiddenCardNumber").val(j),$("#paymentFormContainerId").val(e);var k={accountNum:{value:j},cvv2:i,paypageRegistrationId:document.getElementById("paypageRegistrationId"),bin:document.getElementById("response$bin")};if(setEprotectResponseFields({response:"",message:""}),""==j){var l="Card Number field cannot be left blank";f.focus();var m=window.location.pathname;"/checkout/payment.jsp"==m||"/checkout/guest-checkout.jsp"==m?$(".guest-payment #continue").click():"/checkout/checkout.jsp"==m?"registeredAddPayment"==e?$("#addBillingAddressSubmitBtn").click():$("#"+e+" #addAddressSubmit").click():"/membership/"==m?$(".saveNewPaymentAddress").click():displayError(l)}else if(i&&""==i.value){var l="Security Code field cannot be left blank";g.focus();var m=window.location.pathname;"/checkout/payment.jsp"==m||"/checkout/guest-checkout.jsp"==m?$(".guest-payment #continue").click():"/checkout/checkout.jsp"==m?"registeredAddPayment"==e?$("#addBillingAddressSubmitBtn").click():$("#"+e+" #addAddressSubmit").click():displayError(l)}else if(void 0===a||a&&b)$.ajax({url:"/includes/worldpay-hidden-fields.jsp",method:"GET",dataType:"html",async:!1,beforeSend:function(){console.log("Before")},success:function(a){$(".WPCommonHiddenFields").html(a);var b={paypageId:document.getElementById("request$paypageId").value,reportGroup:document.getElementById("request$reportGroup").value,orderId:document.getElementById("request$orderId").value,id:document.getElementById("request$merchantTxnId").value,url:document.getElementById("request$eProtectUrl").value};(new eProtect).sendToEprotect(b,k,submitAfterEprotect,onErrorAfterEprotect,timeoutOnEprotect,15e3)}});else{if(0==a&&1==b)var l="First name includes invalid character";else if(1==a&&0==b)var l="Last name includes invalid character";else var l="First name and last name includes invalid character";displayError(l)}return!1}),$(document).on("click","#barclayPaymentDetails",function(){var a=$("#barclayCardNumber"),b=document.getElementById("cvv"),c=a.val();$("#hiddenCardNumber").val(c);var d={accountNum:{value:c},cvv2:b,paypageRegistrationId:document.getElementById("barclayPaypageRegId"),bin:document.getElementById("response$bin")};if(setEprotectResponseFields({response:"",message:""}),""==c){var e="Barclay Card Number cannot be null";displayError(e)}else $.ajax({url:"/includes/worldpay-hidden-fields.jsp",method:"GET",dataType:"html",async:!1,beforeSend:function(){console.log("Barclay Before Form Submit")},success:function(a){$(".WPCommonHiddenFields").html(a);var b={paypageId:document.getElementById("request$paypageId").value,reportGroup:document.getElementById("request$reportGroup").value,orderId:document.getElementById("request$orderId").value,id:document.getElementById("request$merchantTxnId").value,url:document.getElementById("request$eProtectUrl").value};(new eProtect).sendToEprotect(b,d,submitAfterEprotect,onErrorAfterEprotect,timeoutOnEprotect,15e3)}});return!1}),$(document).on("keyup",".cvv-modal-security-code #csv",function(a){13==a.keyCode&&(a.preventDefault(),$("#confirmSecurityCodeDisplayBtn").click())}),$(document).on("click","#confirmSecurityCodeDisplayBtn",function(){var a=$("#isWPApiAlreadyCalled").val(),b=$(this).closest("form")[0];if(void 0!=b&&b.length>0){var c=$("#csv").length>1?"csv":$(".instant-purchase-saved-cvv.user-success").attr("id");if("undefined"!=typeof c)var d=$("#"+b.id+" #"+c).val();else var d=$("#"+b.id+" #csv").val();$("#paymentFormContainerId").val(b.id)}else var d=$("#ccCode").val();$("#hiddenSecurityCode").val(d);var e={cvv2:{value:d}};if(setEprotectResponseFields({response:"",message:""}),d)$.ajax({url:"/includes/worldpay-hidden-fields.jsp",method:"GET",dataType:"html",async:!1,beforeSend:function(){console.log("Before")},success:function(b){$(".WPCommonHiddenFields").html(b);var c={paypageId:document.getElementById("request$paypageId").value,reportGroup:document.getElementById("request$reportGroup").value,orderId:document.getElementById("request$orderId").value,id:document.getElementById("request$merchantTxnId").value,checkoutIdMode:!0,url:document.getElementById("request$eProtectUrl").value};"false"==a||void 0==a?(new eProtect).sendToEprotect(c,e,submitAfterEprotectCvv,onErrorAfterEprotect,timeoutOnEprotect,15e3):$("#confirmSecurityCodeHiddenBtn").click()}});else{var f="Security Code field cannot be left blank";displayError(f)}return!1})});